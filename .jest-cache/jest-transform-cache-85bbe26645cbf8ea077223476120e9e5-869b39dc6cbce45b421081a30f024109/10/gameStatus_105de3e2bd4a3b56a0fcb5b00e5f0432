19f1e34b0648e6c29e7115a4f7359f6b
/**
 * @file Game status utilities for chess endgame training
 * @module utils/chess/gameStatus
 *
 * @description
 * Utilities for determining game state information including whose turn it is,
 * training objectives (win/draw/defend), and automatic objective detection
 * based on material balance. Provides localized (German) display strings
 * for UI integration.
 *
 * @remarks
 * Key features:
 * - Turn detection from FEN with German localization
 * - Automatic objective inference from material balance
 * - Support for manual objective override
 * - Visual indicators (emojis) for turn display
 * - Heuristic-based position evaluation
 *
 * The objective detection uses simple but effective heuristics based on
 * material counting and common endgame patterns.
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "getGameStatus", {
    enumerable: true,
    get: function() {
        return getGameStatus;
    }
});
const _chess = require("chess.js");
function getGameStatus(fen, goalFromData) {
    const chess = new _chess.Chess();
    try {
        chess.load(fen);
    } catch (error) {
        // Fallback for invalid FEN
        return {
            sideToMove: "white",
            sideToMoveDisplay: "WeiÃŸ am Zug",
            objective: "win",
            objectiveDisplay: "Ziel: Gewinn",
            icon: "ðŸŸ¢"
        };
    }
    const turn = chess.turn();
    const sideToMove = turn === "w" ? "white" : "black";
    // Display based on turn
    const sideToMoveDisplay = turn === "w" ? "WeiÃŸ am Zug" : "Schwarz am Zug";
    const icon = turn === "w" ? "ðŸŸ¢" : "âš«";
    // Objective detection
    const objective = goalFromData || detectObjective(fen);
    const objectiveDisplay = getObjectiveDisplay(objective);
    return {
        sideToMove,
        sideToMoveDisplay,
        objective,
        objectiveDisplay,
        icon
    };
}
/**
 * Auto-detect objective from position characteristics
 *
 * @function detectObjective
 * @private
 * @param {string} fen - FEN string to analyze
 * @returns {'win' | 'draw' | 'defend'} Detected objective
 *
 * @description
 * Uses heuristic rules to infer the most likely training objective
 * based on material balance and endgame characteristics. The algorithm
 * prioritizes common endgame patterns and material imbalances.
 *
 * @remarks
 * Heuristic rules applied:
 * 1. Material advantage â‰¥3 points â†’ 'win'
 * 2. Pawn endgame with extra pawn â†’ 'win'
 * 3. K+P vs K â†’ 'win'
 * 4. Equal material â†’ 'draw'
 * 5. Default â†’ 'win' (for learning purposes)
 *
 * Material values: Pawn=1, Knight/Bishop=3, Rook=5, Queen=9
 *
 * @example
 * ```typescript
 * // K+P vs K - typically winning
 * detectObjective('8/8/8/8/8/8/P7/K6k w - - 0 1'); // 'win'
 *
 * // Equal material - typically drawing
 * detectObjective('8/8/8/8/8/8/p7/K6k w - - 0 1'); // 'draw'
 * ```
 */ function detectObjective(fen) {
    const chess = new _chess.Chess();
    chess.load(fen);
    // Count material
    const board = chess.board();
    let whiteMaterial = 0;
    let blackMaterial = 0;
    let whiteHasPawns = false;
    let blackHasPawns = false;
    /**
   * Standard piece values for material calculation
   * @private
   */ const pieceValues = {
        p: 1,
        n: 3,
        b: 3,
        r: 5,
        q: 9,
        k: 0
    };
    for (const row of board){
        for (const square of row){
            if (square) {
                const value = pieceValues[square.type];
                if (square.color === "w") {
                    whiteMaterial += value;
                    if (square.type === "p") whiteHasPawns = true;
                } else {
                    blackMaterial += value;
                    if (square.type === "p") blackHasPawns = true;
                }
            }
        }
    }
    // Heuristic rules for objective detection
    const materialDiff = whiteMaterial - blackMaterial;
    // Strong material advantage usually means winning
    if (Math.abs(materialDiff) >= 3) {
        return "win";
    }
    // Pawn endgames with extra pawn often winning
    if (whiteHasPawns && blackHasPawns && Math.abs(materialDiff) >= 1) {
        return "win";
    }
    // King + Pawn vs King is usually winning
    if (whiteMaterial === 1 && blackMaterial === 0 || whiteMaterial === 0 && blackMaterial === 1) {
        return "win";
    }
    // Equal material often draw
    if (materialDiff === 0) {
        return "draw";
    }
    // Default to win for learning purposes
    return "win";
}
/**
 * Get display text for objective
 *
 * @function getObjectiveDisplay
 * @private
 * @param {'win' | 'draw' | 'defend'} objective - Training objective
 * @returns {string} Localized objective text in German
 *
 * @description
 * Converts internal objective codes to user-friendly German text
 * for display in the training interface.
 *
 * @example
 * ```typescript
 * getObjectiveDisplay('win');    // 'Ziel: Gewinn'
 * getObjectiveDisplay('draw');   // 'Ziel: Remis'
 * getObjectiveDisplay('defend'); // 'Ziel: Verteidigen'
 * ```
 *
 * @remarks
 * German translations:
 * - win â†’ "Gewinn" (victory)
 * - draw â†’ "Remis" (draw)
 * - defend â†’ "Verteidigen" (defend)
 */ function getObjectiveDisplay(objective) {
    switch(objective){
        case "win":
            return "Ziel: Gewinn";
        case "draw":
            return "Ziel: Remis";
        case "defend":
            return "Ziel: Verteidigen";
        default:
            return "Ziel: Gewinn";
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL3RoZWh1L2Nvb2xQcm9qZWN0cy9FbmRnYW1lVHJhaW5lci10cmFpbmluZy1ib2FyZC1jb21wbGV0ZS9zcmMvc2hhcmVkL3V0aWxzL2NoZXNzL2dhbWVTdGF0dXMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBHYW1lIHN0YXR1cyB1dGlsaXRpZXMgZm9yIGNoZXNzIGVuZGdhbWUgdHJhaW5pbmdcbiAqIEBtb2R1bGUgdXRpbHMvY2hlc3MvZ2FtZVN0YXR1c1xuICpcbiAqIEBkZXNjcmlwdGlvblxuICogVXRpbGl0aWVzIGZvciBkZXRlcm1pbmluZyBnYW1lIHN0YXRlIGluZm9ybWF0aW9uIGluY2x1ZGluZyB3aG9zZSB0dXJuIGl0IGlzLFxuICogdHJhaW5pbmcgb2JqZWN0aXZlcyAod2luL2RyYXcvZGVmZW5kKSwgYW5kIGF1dG9tYXRpYyBvYmplY3RpdmUgZGV0ZWN0aW9uXG4gKiBiYXNlZCBvbiBtYXRlcmlhbCBiYWxhbmNlLiBQcm92aWRlcyBsb2NhbGl6ZWQgKEdlcm1hbikgZGlzcGxheSBzdHJpbmdzXG4gKiBmb3IgVUkgaW50ZWdyYXRpb24uXG4gKlxuICogQHJlbWFya3NcbiAqIEtleSBmZWF0dXJlczpcbiAqIC0gVHVybiBkZXRlY3Rpb24gZnJvbSBGRU4gd2l0aCBHZXJtYW4gbG9jYWxpemF0aW9uXG4gKiAtIEF1dG9tYXRpYyBvYmplY3RpdmUgaW5mZXJlbmNlIGZyb20gbWF0ZXJpYWwgYmFsYW5jZVxuICogLSBTdXBwb3J0IGZvciBtYW51YWwgb2JqZWN0aXZlIG92ZXJyaWRlXG4gKiAtIFZpc3VhbCBpbmRpY2F0b3JzIChlbW9qaXMpIGZvciB0dXJuIGRpc3BsYXlcbiAqIC0gSGV1cmlzdGljLWJhc2VkIHBvc2l0aW9uIGV2YWx1YXRpb25cbiAqXG4gKiBUaGUgb2JqZWN0aXZlIGRldGVjdGlvbiB1c2VzIHNpbXBsZSBidXQgZWZmZWN0aXZlIGhldXJpc3RpY3MgYmFzZWQgb25cbiAqIG1hdGVyaWFsIGNvdW50aW5nIGFuZCBjb21tb24gZW5kZ2FtZSBwYXR0ZXJucy5cbiAqL1xuXG5pbXBvcnQgeyBDaGVzcyB9IGZyb20gXCJjaGVzcy5qc1wiO1xuXG4vKipcbiAqIENvbXBsZXRlIGdhbWUgc3RhdHVzIGluZm9ybWF0aW9uXG4gKlxuICogQGludGVyZmFjZSBHYW1lU3RhdHVzXG4gKiBAZGVzY3JpcHRpb25cbiAqIENvbXByZWhlbnNpdmUgc3RhdHVzIG9iamVjdCBjb250YWluaW5nIHR1cm4gaW5mb3JtYXRpb24gYW5kIHRyYWluaW5nXG4gKiBvYmplY3RpdmVzIGZvciB0aGUgY3VycmVudCBwb3NpdGlvbi5cbiAqXG4gKiBAcHJvcGVydHkgeyd3aGl0ZScgfCAnYmxhY2snfSBzaWRlVG9Nb3ZlIC0gV2hpY2ggc2lkZSBoYXMgdGhlIG1vdmVcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBzaWRlVG9Nb3ZlRGlzcGxheSAtIExvY2FsaXplZCB0dXJuIGRpc3BsYXkgKEdlcm1hbilcbiAqIEBwcm9wZXJ0eSB7J3dpbicgfCAnZHJhdycgfCAnZGVmZW5kJ30gb2JqZWN0aXZlIC0gVHJhaW5pbmcgZ29hbCBmb3IgdGhlIHBvc2l0aW9uXG4gKiBAcHJvcGVydHkge3N0cmluZ30gb2JqZWN0aXZlRGlzcGxheSAtIExvY2FsaXplZCBvYmplY3RpdmUgdGV4dCAoR2VybWFuKVxuICogQHByb3BlcnR5IHtzdHJpbmd9IGljb24gLSBWaXN1YWwgaW5kaWNhdG9yIGVtb2ppIGZvciB0aGUgc2lkZSB0byBtb3ZlXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgR2FtZVN0YXR1cyB7XG4gIHNpZGVUb01vdmU6IFwid2hpdGVcIiB8IFwiYmxhY2tcIjtcbiAgc2lkZVRvTW92ZURpc3BsYXk6IHN0cmluZztcbiAgb2JqZWN0aXZlOiBcIndpblwiIHwgXCJkcmF3XCIgfCBcImRlZmVuZFwiO1xuICBvYmplY3RpdmVEaXNwbGF5OiBzdHJpbmc7XG4gIGljb246IHN0cmluZztcbn1cblxuLyoqXG4gKiBHZXQgY3VycmVudCBnYW1lIHN0YXR1cyBmcm9tIEZFTlxuICpcbiAqIEBmdW5jdGlvbiBnZXRHYW1lU3RhdHVzXG4gKiBAcGFyYW0ge3N0cmluZ30gZmVuIC0gRkVOIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIGN1cnJlbnQgcG9zaXRpb25cbiAqIEBwYXJhbSB7J3dpbicgfCAnZHJhdycgfCAnZGVmZW5kJ30gW2dvYWxGcm9tRGF0YV0gLSBPcHRpb25hbCBtYW51YWwgb2JqZWN0aXZlIG92ZXJyaWRlXG4gKiBAcmV0dXJucyB7R2FtZVN0YXR1c30gQ29tcGxldGUgc3RhdHVzIGluZm9ybWF0aW9uIGZvciB0aGUgcG9zaXRpb25cbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIEFuYWx5emVzIGEgY2hlc3MgcG9zaXRpb24gdG8gZGV0ZXJtaW5lIHR1cm4gaW5mb3JtYXRpb24gYW5kIHRyYWluaW5nXG4gKiBvYmplY3RpdmVzLiBTdXBwb3J0cyBib3RoIGF1dG9tYXRpYyBvYmplY3RpdmUgZGV0ZWN0aW9uIHRocm91Z2ggbWF0ZXJpYWxcbiAqIGFuYWx5c2lzIGFuZCBtYW51YWwgb3ZlcnJpZGUgZm9yIHNwZWNpZmljIHRyYWluaW5nIHNjZW5hcmlvcy5cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgdHlwZXNjcmlwdFxuICogLy8gQXV0b21hdGljIG9iamVjdGl2ZSBkZXRlY3Rpb25cbiAqIGNvbnN0IHN0YXR1cyA9IGdldEdhbWVTdGF0dXMoJ3JuYnFrYm5yL3BwcHBwcHBwLzgvOC84LzgvUFBQUFBQUFAvUk5CUUtCTlIgdyBLUWtxIC0gMCAxJyk7XG4gKiAvLyB7IHNpZGVUb01vdmU6ICd3aGl0ZScsIHNpZGVUb01vdmVEaXNwbGF5OiAnV2Vpw58gYW0gWnVnJywgLi4uIH1cbiAqXG4gKiAvLyBNYW51YWwgb2JqZWN0aXZlIG92ZXJyaWRlXG4gKiBjb25zdCBzdGF0dXMgPSBnZXRHYW1lU3RhdHVzKCc4LzgvOC84LzgvOC84L0s2ayB3IC0gLSAwIDEnLCAnZHJhdycpO1xuICogLy8geyAuLi4sIG9iamVjdGl2ZTogJ2RyYXcnLCBvYmplY3RpdmVEaXNwbGF5OiAnWmllbDogUmVtaXMnIH1cbiAqIGBgYFxuICpcbiAqIEByZW1hcmtzXG4gKiBGYWxscyBiYWNrIHRvIHNhZmUgZGVmYXVsdHMgaWYgRkVOIGlzIGludmFsaWQuIFRoZSBhdXRvbWF0aWMgb2JqZWN0aXZlXG4gKiBkZXRlY3Rpb24gdXNlcyBkZXRlY3RPYmplY3RpdmUoKSB3aGljaCBhcHBsaWVzIGhldXJpc3RpY3MgYmFzZWQgb25cbiAqIG1hdGVyaWFsIGJhbGFuY2UgYW5kIGVuZGdhbWUgcGF0dGVybnMuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRHYW1lU3RhdHVzKFxuICBmZW46IHN0cmluZyxcbiAgZ29hbEZyb21EYXRhPzogXCJ3aW5cIiB8IFwiZHJhd1wiIHwgXCJkZWZlbmRcIixcbik6IEdhbWVTdGF0dXMge1xuICBjb25zdCBjaGVzcyA9IG5ldyBDaGVzcygpO1xuXG4gIHRyeSB7XG4gICAgY2hlc3MubG9hZChmZW4pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIC8vIEZhbGxiYWNrIGZvciBpbnZhbGlkIEZFTlxuICAgIHJldHVybiB7XG4gICAgICBzaWRlVG9Nb3ZlOiBcIndoaXRlXCIsXG4gICAgICBzaWRlVG9Nb3ZlRGlzcGxheTogXCJXZWnDnyBhbSBadWdcIixcbiAgICAgIG9iamVjdGl2ZTogXCJ3aW5cIixcbiAgICAgIG9iamVjdGl2ZURpc3BsYXk6IFwiWmllbDogR2V3aW5uXCIsXG4gICAgICBpY29uOiBcIvCfn6JcIixcbiAgICB9O1xuICB9XG5cbiAgY29uc3QgdHVybiA9IGNoZXNzLnR1cm4oKTtcbiAgY29uc3Qgc2lkZVRvTW92ZSA9IHR1cm4gPT09IFwid1wiID8gXCJ3aGl0ZVwiIDogXCJibGFja1wiO1xuXG4gIC8vIERpc3BsYXkgYmFzZWQgb24gdHVyblxuICBjb25zdCBzaWRlVG9Nb3ZlRGlzcGxheSA9IHR1cm4gPT09IFwid1wiID8gXCJXZWnDnyBhbSBadWdcIiA6IFwiU2Nod2FyeiBhbSBadWdcIjtcblxuICBjb25zdCBpY29uID0gdHVybiA9PT0gXCJ3XCIgPyBcIvCfn6JcIiA6IFwi4pqrXCI7XG5cbiAgLy8gT2JqZWN0aXZlIGRldGVjdGlvblxuICBjb25zdCBvYmplY3RpdmUgPSBnb2FsRnJvbURhdGEgfHwgZGV0ZWN0T2JqZWN0aXZlKGZlbik7XG4gIGNvbnN0IG9iamVjdGl2ZURpc3BsYXkgPSBnZXRPYmplY3RpdmVEaXNwbGF5KG9iamVjdGl2ZSk7XG5cbiAgcmV0dXJuIHtcbiAgICBzaWRlVG9Nb3ZlLFxuICAgIHNpZGVUb01vdmVEaXNwbGF5LFxuICAgIG9iamVjdGl2ZSxcbiAgICBvYmplY3RpdmVEaXNwbGF5LFxuICAgIGljb24sXG4gIH07XG59XG5cbi8qKlxuICogQXV0by1kZXRlY3Qgb2JqZWN0aXZlIGZyb20gcG9zaXRpb24gY2hhcmFjdGVyaXN0aWNzXG4gKlxuICogQGZ1bmN0aW9uIGRldGVjdE9iamVjdGl2ZVxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7c3RyaW5nfSBmZW4gLSBGRU4gc3RyaW5nIHRvIGFuYWx5emVcbiAqIEByZXR1cm5zIHsnd2luJyB8ICdkcmF3JyB8ICdkZWZlbmQnfSBEZXRlY3RlZCBvYmplY3RpdmVcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIFVzZXMgaGV1cmlzdGljIHJ1bGVzIHRvIGluZmVyIHRoZSBtb3N0IGxpa2VseSB0cmFpbmluZyBvYmplY3RpdmVcbiAqIGJhc2VkIG9uIG1hdGVyaWFsIGJhbGFuY2UgYW5kIGVuZGdhbWUgY2hhcmFjdGVyaXN0aWNzLiBUaGUgYWxnb3JpdGhtXG4gKiBwcmlvcml0aXplcyBjb21tb24gZW5kZ2FtZSBwYXR0ZXJucyBhbmQgbWF0ZXJpYWwgaW1iYWxhbmNlcy5cbiAqXG4gKiBAcmVtYXJrc1xuICogSGV1cmlzdGljIHJ1bGVzIGFwcGxpZWQ6XG4gKiAxLiBNYXRlcmlhbCBhZHZhbnRhZ2Ug4omlMyBwb2ludHMg4oaSICd3aW4nXG4gKiAyLiBQYXduIGVuZGdhbWUgd2l0aCBleHRyYSBwYXduIOKGkiAnd2luJ1xuICogMy4gSytQIHZzIEsg4oaSICd3aW4nXG4gKiA0LiBFcXVhbCBtYXRlcmlhbCDihpIgJ2RyYXcnXG4gKiA1LiBEZWZhdWx0IOKGkiAnd2luJyAoZm9yIGxlYXJuaW5nIHB1cnBvc2VzKVxuICpcbiAqIE1hdGVyaWFsIHZhbHVlczogUGF3bj0xLCBLbmlnaHQvQmlzaG9wPTMsIFJvb2s9NSwgUXVlZW49OVxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGB0eXBlc2NyaXB0XG4gKiAvLyBLK1AgdnMgSyAtIHR5cGljYWxseSB3aW5uaW5nXG4gKiBkZXRlY3RPYmplY3RpdmUoJzgvOC84LzgvOC84L1A3L0s2ayB3IC0gLSAwIDEnKTsgLy8gJ3dpbidcbiAqXG4gKiAvLyBFcXVhbCBtYXRlcmlhbCAtIHR5cGljYWxseSBkcmF3aW5nXG4gKiBkZXRlY3RPYmplY3RpdmUoJzgvOC84LzgvOC84L3A3L0s2ayB3IC0gLSAwIDEnKTsgLy8gJ2RyYXcnXG4gKiBgYGBcbiAqL1xuZnVuY3Rpb24gZGV0ZWN0T2JqZWN0aXZlKGZlbjogc3RyaW5nKTogXCJ3aW5cIiB8IFwiZHJhd1wiIHwgXCJkZWZlbmRcIiB7XG4gIGNvbnN0IGNoZXNzID0gbmV3IENoZXNzKCk7XG4gIGNoZXNzLmxvYWQoZmVuKTtcblxuICAvLyBDb3VudCBtYXRlcmlhbFxuICBjb25zdCBib2FyZCA9IGNoZXNzLmJvYXJkKCk7XG4gIGxldCB3aGl0ZU1hdGVyaWFsID0gMDtcbiAgbGV0IGJsYWNrTWF0ZXJpYWwgPSAwO1xuICBsZXQgd2hpdGVIYXNQYXducyA9IGZhbHNlO1xuICBsZXQgYmxhY2tIYXNQYXducyA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBTdGFuZGFyZCBwaWVjZSB2YWx1ZXMgZm9yIG1hdGVyaWFsIGNhbGN1bGF0aW9uXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBjb25zdCBwaWVjZVZhbHVlcyA9IHsgcDogMSwgbjogMywgYjogMywgcjogNSwgcTogOSwgazogMCB9O1xuXG4gIGZvciAoY29uc3Qgcm93IG9mIGJvYXJkKSB7XG4gICAgZm9yIChjb25zdCBzcXVhcmUgb2Ygcm93KSB7XG4gICAgICBpZiAoc3F1YXJlKSB7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gcGllY2VWYWx1ZXNbc3F1YXJlLnR5cGVdO1xuICAgICAgICBpZiAoc3F1YXJlLmNvbG9yID09PSBcIndcIikge1xuICAgICAgICAgIHdoaXRlTWF0ZXJpYWwgKz0gdmFsdWU7XG4gICAgICAgICAgaWYgKHNxdWFyZS50eXBlID09PSBcInBcIikgd2hpdGVIYXNQYXducyA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYmxhY2tNYXRlcmlhbCArPSB2YWx1ZTtcbiAgICAgICAgICBpZiAoc3F1YXJlLnR5cGUgPT09IFwicFwiKSBibGFja0hhc1Bhd25zID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIEhldXJpc3RpYyBydWxlcyBmb3Igb2JqZWN0aXZlIGRldGVjdGlvblxuICBjb25zdCBtYXRlcmlhbERpZmYgPSB3aGl0ZU1hdGVyaWFsIC0gYmxhY2tNYXRlcmlhbDtcblxuICAvLyBTdHJvbmcgbWF0ZXJpYWwgYWR2YW50YWdlIHVzdWFsbHkgbWVhbnMgd2lubmluZ1xuICBpZiAoTWF0aC5hYnMobWF0ZXJpYWxEaWZmKSA+PSAzKSB7XG4gICAgcmV0dXJuIFwid2luXCI7XG4gIH1cblxuICAvLyBQYXduIGVuZGdhbWVzIHdpdGggZXh0cmEgcGF3biBvZnRlbiB3aW5uaW5nXG4gIGlmICh3aGl0ZUhhc1Bhd25zICYmIGJsYWNrSGFzUGF3bnMgJiYgTWF0aC5hYnMobWF0ZXJpYWxEaWZmKSA+PSAxKSB7XG4gICAgcmV0dXJuIFwid2luXCI7XG4gIH1cblxuICAvLyBLaW5nICsgUGF3biB2cyBLaW5nIGlzIHVzdWFsbHkgd2lubmluZ1xuICBpZiAoXG4gICAgKHdoaXRlTWF0ZXJpYWwgPT09IDEgJiYgYmxhY2tNYXRlcmlhbCA9PT0gMCkgfHxcbiAgICAod2hpdGVNYXRlcmlhbCA9PT0gMCAmJiBibGFja01hdGVyaWFsID09PSAxKVxuICApIHtcbiAgICByZXR1cm4gXCJ3aW5cIjtcbiAgfVxuXG4gIC8vIEVxdWFsIG1hdGVyaWFsIG9mdGVuIGRyYXdcbiAgaWYgKG1hdGVyaWFsRGlmZiA9PT0gMCkge1xuICAgIHJldHVybiBcImRyYXdcIjtcbiAgfVxuXG4gIC8vIERlZmF1bHQgdG8gd2luIGZvciBsZWFybmluZyBwdXJwb3Nlc1xuICByZXR1cm4gXCJ3aW5cIjtcbn1cblxuLyoqXG4gKiBHZXQgZGlzcGxheSB0ZXh0IGZvciBvYmplY3RpdmVcbiAqXG4gKiBAZnVuY3Rpb24gZ2V0T2JqZWN0aXZlRGlzcGxheVxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7J3dpbicgfCAnZHJhdycgfCAnZGVmZW5kJ30gb2JqZWN0aXZlIC0gVHJhaW5pbmcgb2JqZWN0aXZlXG4gKiBAcmV0dXJucyB7c3RyaW5nfSBMb2NhbGl6ZWQgb2JqZWN0aXZlIHRleHQgaW4gR2VybWFuXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBDb252ZXJ0cyBpbnRlcm5hbCBvYmplY3RpdmUgY29kZXMgdG8gdXNlci1mcmllbmRseSBHZXJtYW4gdGV4dFxuICogZm9yIGRpc3BsYXkgaW4gdGhlIHRyYWluaW5nIGludGVyZmFjZS5cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgdHlwZXNjcmlwdFxuICogZ2V0T2JqZWN0aXZlRGlzcGxheSgnd2luJyk7ICAgIC8vICdaaWVsOiBHZXdpbm4nXG4gKiBnZXRPYmplY3RpdmVEaXNwbGF5KCdkcmF3Jyk7ICAgLy8gJ1ppZWw6IFJlbWlzJ1xuICogZ2V0T2JqZWN0aXZlRGlzcGxheSgnZGVmZW5kJyk7IC8vICdaaWVsOiBWZXJ0ZWlkaWdlbidcbiAqIGBgYFxuICpcbiAqIEByZW1hcmtzXG4gKiBHZXJtYW4gdHJhbnNsYXRpb25zOlxuICogLSB3aW4g4oaSIFwiR2V3aW5uXCIgKHZpY3RvcnkpXG4gKiAtIGRyYXcg4oaSIFwiUmVtaXNcIiAoZHJhdylcbiAqIC0gZGVmZW5kIOKGkiBcIlZlcnRlaWRpZ2VuXCIgKGRlZmVuZClcbiAqL1xuZnVuY3Rpb24gZ2V0T2JqZWN0aXZlRGlzcGxheShvYmplY3RpdmU6IFwid2luXCIgfCBcImRyYXdcIiB8IFwiZGVmZW5kXCIpOiBzdHJpbmcge1xuICBzd2l0Y2ggKG9iamVjdGl2ZSkge1xuICAgIGNhc2UgXCJ3aW5cIjpcbiAgICAgIHJldHVybiBcIlppZWw6IEdld2lublwiO1xuICAgIGNhc2UgXCJkcmF3XCI6XG4gICAgICByZXR1cm4gXCJaaWVsOiBSZW1pc1wiO1xuICAgIGNhc2UgXCJkZWZlbmRcIjpcbiAgICAgIHJldHVybiBcIlppZWw6IFZlcnRlaWRpZ2VuXCI7XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBcIlppZWw6IEdld2lublwiO1xuICB9XG59XG4iXSwibmFtZXMiOlsiZ2V0R2FtZVN0YXR1cyIsImZlbiIsImdvYWxGcm9tRGF0YSIsImNoZXNzIiwiQ2hlc3MiLCJsb2FkIiwiZXJyb3IiLCJzaWRlVG9Nb3ZlIiwic2lkZVRvTW92ZURpc3BsYXkiLCJvYmplY3RpdmUiLCJvYmplY3RpdmVEaXNwbGF5IiwiaWNvbiIsInR1cm4iLCJkZXRlY3RPYmplY3RpdmUiLCJnZXRPYmplY3RpdmVEaXNwbGF5IiwiYm9hcmQiLCJ3aGl0ZU1hdGVyaWFsIiwiYmxhY2tNYXRlcmlhbCIsIndoaXRlSGFzUGF3bnMiLCJibGFja0hhc1Bhd25zIiwicGllY2VWYWx1ZXMiLCJwIiwibiIsImIiLCJyIiwicSIsImsiLCJyb3ciLCJzcXVhcmUiLCJ2YWx1ZSIsInR5cGUiLCJjb2xvciIsIm1hdGVyaWFsRGlmZiIsIk1hdGgiLCJhYnMiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztDQW9CQzs7OzsrQkF1RGVBOzs7ZUFBQUE7Ozt1QkFyRE07QUFxRGYsU0FBU0EsY0FDZEMsR0FBVyxFQUNYQyxZQUF3QztJQUV4QyxNQUFNQyxRQUFRLElBQUlDLFlBQUs7SUFFdkIsSUFBSTtRQUNGRCxNQUFNRSxJQUFJLENBQUNKO0lBQ2IsRUFBRSxPQUFPSyxPQUFPO1FBQ2QsMkJBQTJCO1FBQzNCLE9BQU87WUFDTEMsWUFBWTtZQUNaQyxtQkFBbUI7WUFDbkJDLFdBQVc7WUFDWEMsa0JBQWtCO1lBQ2xCQyxNQUFNO1FBQ1I7SUFDRjtJQUVBLE1BQU1DLE9BQU9ULE1BQU1TLElBQUk7SUFDdkIsTUFBTUwsYUFBYUssU0FBUyxNQUFNLFVBQVU7SUFFNUMsd0JBQXdCO0lBQ3hCLE1BQU1KLG9CQUFvQkksU0FBUyxNQUFNLGdCQUFnQjtJQUV6RCxNQUFNRCxPQUFPQyxTQUFTLE1BQU0sT0FBTztJQUVuQyxzQkFBc0I7SUFDdEIsTUFBTUgsWUFBWVAsZ0JBQWdCVyxnQkFBZ0JaO0lBQ2xELE1BQU1TLG1CQUFtQkksb0JBQW9CTDtJQUU3QyxPQUFPO1FBQ0xGO1FBQ0FDO1FBQ0FDO1FBQ0FDO1FBQ0FDO0lBQ0Y7QUFDRjtBQUVBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0NBK0JDLEdBQ0QsU0FBU0UsZ0JBQWdCWixHQUFXO0lBQ2xDLE1BQU1FLFFBQVEsSUFBSUMsWUFBSztJQUN2QkQsTUFBTUUsSUFBSSxDQUFDSjtJQUVYLGlCQUFpQjtJQUNqQixNQUFNYyxRQUFRWixNQUFNWSxLQUFLO0lBQ3pCLElBQUlDLGdCQUFnQjtJQUNwQixJQUFJQyxnQkFBZ0I7SUFDcEIsSUFBSUMsZ0JBQWdCO0lBQ3BCLElBQUlDLGdCQUFnQjtJQUVwQjs7O0dBR0MsR0FDRCxNQUFNQyxjQUFjO1FBQUVDLEdBQUc7UUFBR0MsR0FBRztRQUFHQyxHQUFHO1FBQUdDLEdBQUc7UUFBR0MsR0FBRztRQUFHQyxHQUFHO0lBQUU7SUFFekQsS0FBSyxNQUFNQyxPQUFPWixNQUFPO1FBQ3ZCLEtBQUssTUFBTWEsVUFBVUQsSUFBSztZQUN4QixJQUFJQyxRQUFRO2dCQUNWLE1BQU1DLFFBQVFULFdBQVcsQ0FBQ1EsT0FBT0UsSUFBSSxDQUFDO2dCQUN0QyxJQUFJRixPQUFPRyxLQUFLLEtBQUssS0FBSztvQkFDeEJmLGlCQUFpQmE7b0JBQ2pCLElBQUlELE9BQU9FLElBQUksS0FBSyxLQUFLWixnQkFBZ0I7Z0JBQzNDLE9BQU87b0JBQ0xELGlCQUFpQlk7b0JBQ2pCLElBQUlELE9BQU9FLElBQUksS0FBSyxLQUFLWCxnQkFBZ0I7Z0JBQzNDO1lBQ0Y7UUFDRjtJQUNGO0lBRUEsMENBQTBDO0lBQzFDLE1BQU1hLGVBQWVoQixnQkFBZ0JDO0lBRXJDLGtEQUFrRDtJQUNsRCxJQUFJZ0IsS0FBS0MsR0FBRyxDQUFDRixpQkFBaUIsR0FBRztRQUMvQixPQUFPO0lBQ1Q7SUFFQSw4Q0FBOEM7SUFDOUMsSUFBSWQsaUJBQWlCQyxpQkFBaUJjLEtBQUtDLEdBQUcsQ0FBQ0YsaUJBQWlCLEdBQUc7UUFDakUsT0FBTztJQUNUO0lBRUEseUNBQXlDO0lBQ3pDLElBQ0UsQUFBQ2hCLGtCQUFrQixLQUFLQyxrQkFBa0IsS0FDekNELGtCQUFrQixLQUFLQyxrQkFBa0IsR0FDMUM7UUFDQSxPQUFPO0lBQ1Q7SUFFQSw0QkFBNEI7SUFDNUIsSUFBSWUsaUJBQWlCLEdBQUc7UUFDdEIsT0FBTztJQUNUO0lBRUEsdUNBQXVDO0lBQ3ZDLE9BQU87QUFDVDtBQUVBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Q0F3QkMsR0FDRCxTQUFTbEIsb0JBQW9CTCxTQUFvQztJQUMvRCxPQUFRQTtRQUNOLEtBQUs7WUFDSCxPQUFPO1FBQ1QsS0FBSztZQUNILE9BQU87UUFDVCxLQUFLO1lBQ0gsT0FBTztRQUNUO1lBQ0UsT0FBTztJQUNYO0FBQ0YifQ==