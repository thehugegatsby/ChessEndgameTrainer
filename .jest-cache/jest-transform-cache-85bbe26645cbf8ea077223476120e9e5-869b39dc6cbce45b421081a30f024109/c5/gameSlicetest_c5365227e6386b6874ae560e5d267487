58822e1ffdf703c066a308453652bf57
/**
 * @file Tests for GameSlice with nested store structure
 * @module tests/unit/store/slices/gameSlice.nested
 */ "use strict";
// Mock ChessService
jest.mock("@shared/services/ChessService", ()=>({
        chessService: {
            reset: jest.fn(),
            initialize: jest.fn().mockReturnValue(true),
            loadPosition: jest.fn(),
            getFen: jest.fn().mockReturnValue("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"),
            getPgn: jest.fn().mockReturnValue(""),
            getHistory: jest.fn().mockReturnValue([]),
            turn: jest.fn().mockReturnValue("w"),
            isGameOver: jest.fn().mockReturnValue(false),
            isCheck: jest.fn().mockReturnValue(false),
            isCheckmate: jest.fn().mockReturnValue(false),
            isDraw: jest.fn().mockReturnValue(false),
            isStalemate: jest.fn().mockReturnValue(false),
            isThreefoldRepetition: jest.fn().mockReturnValue(false),
            isInsufficientMaterial: jest.fn().mockReturnValue(false),
            onStateChange: jest.fn(),
            move: jest.fn(),
            undo: jest.fn(),
            validateMove: jest.fn(),
            getMoves: jest.fn().mockReturnValue([]),
            subscribe: jest.fn().mockReturnValue(jest.fn()),
            emit: jest.fn()
        }
    }));
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _rootStore = require("../../../../shared/store/rootStore");
const _ChessService = require("../../../../shared/services/ChessService");
describe("GameSlice - Nested Store Structure", ()=>{
    beforeEach(()=>{
        // Reset mocks
        jest.clearAllMocks();
        // Reset store to initial state - preserve actions by only updating state properties
        _rootStore.useStore.setState((state)=>{
            state.game.currentFen = "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";
            state.game.currentPgn = "";
            state.game.moveHistory = [];
            state.game.currentMoveIndex = -1;
            state.game.isGameFinished = false;
            state.game.gameResult = null;
        });
    });
    describe("resetGame", ()=>{
        it("should call ChessService reset", ()=>{
            const store = _rootStore.useStore.getState();
            // Modify some state first
            store.game.setGameFinished(true);
            expect(_rootStore.useStore.getState().game.isGameFinished).toBe(true);
            // Reset game - this calls chessService.reset() which should emit an event
            // In a real scenario, the rootStore subscription would sync the state
            store.game.resetGame();
            // Verify that ChessService.reset was called
            expect(_ChessService.chessService.reset).toHaveBeenCalled();
        // In unit tests, we'd need to manually trigger the state sync or mock the event system
        // For now, just test that the service method was called
        });
    });
    describe("initializeGame", ()=>{
        it("should initialize game with FEN", ()=>{
            const store = _rootStore.useStore.getState();
            const testFen = "8/8/8/8/8/8/8/8 w - - 0 1";
            const result = store.game.initializeGame(testFen);
            // The actual implementation would use chessService
            expect(result).toBeDefined();
        });
    });
    describe("setGameFinished", ()=>{
        it("should set game finished to true", ()=>{
            const store = _rootStore.useStore.getState();
            store.game.setGameFinished(true);
            const state = _rootStore.useStore.getState();
            expect(state.game.isGameFinished).toBe(true);
        });
        it("should set game finished to false", ()=>{
            const store = _rootStore.useStore.getState();
            store.game.setGameFinished(false);
            const state = _rootStore.useStore.getState();
            expect(state.game.isGameFinished).toBe(false);
        });
    });
    describe("updatePosition", ()=>{
        it("should update position with FEN and PGN", ()=>{
            const store = _rootStore.useStore.getState();
            const testFen = "8/8/8/8/8/8/8/8 w - - 0 1";
            const testPgn = "1. e4";
            store.game.updatePosition(testFen, testPgn);
            const state = _rootStore.useStore.getState();
            expect(state.game.currentFen).toBe(testFen);
            expect(state.game.currentPgn).toBe(testPgn);
        });
    });
    describe("setMoveHistory", ()=>{
        it("should set move history", ()=>{
            const store = _rootStore.useStore.getState();
            const mockMoves = [
                {
                    san: "e4",
                    from: "e2",
                    to: "e4",
                    color: "w",
                    piece: "p",
                    captured: undefined
                },
                {
                    san: "e5",
                    from: "e7",
                    to: "e5",
                    color: "b",
                    piece: "p",
                    captured: undefined
                }
            ];
            store.game.setMoveHistory(mockMoves);
            const state = _rootStore.useStore.getState();
            expect(state.game.moveHistory).toEqual(mockMoves);
        });
    });
    describe("setCurrentMoveIndex", ()=>{
        it("should set current move index", ()=>{
            const store = _rootStore.useStore.getState();
            store.game.setCurrentMoveIndex(5);
            const state = _rootStore.useStore.getState();
            expect(state.game.currentMoveIndex).toBe(5);
        });
    });
    describe("Integration with nested structure", ()=>{
        it("should work with other slices in the store", ()=>{
            const store = _rootStore.useStore.getState();
            // Verify that other slices exist
            expect(store.tablebase).toBeDefined();
            expect(store.training).toBeDefined();
            expect(store.ui).toBeDefined();
            // Set game data
            store.game.setGameFinished(true);
            // Verify it doesn't affect other slices
            const state = _rootStore.useStore.getState();
            expect(state.game.isGameFinished).toBe(true);
            expect(state.tablebase.analysisStatus).toBeDefined();
            expect(state.training.isPlayerTurn).toBeDefined();
        });
        it("should maintain proper nesting in state updates", ()=>{
            const store = _rootStore.useStore.getState();
            // Make multiple updates
            store.game.setGameFinished(true);
            store.game.setCurrentMoveIndex(3);
            // Check all updates were applied correctly
            const state = _rootStore.useStore.getState();
            expect(state.game.isGameFinished).toBe(true);
            expect(state.game.currentMoveIndex).toBe(3);
            // Verify structure is maintained
            expect(state.game).toHaveProperty("currentFen");
            expect(state.game).toHaveProperty("moveHistory");
            expect(state.game).toHaveProperty("resetGame");
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL3RoZWh1L2Nvb2xQcm9qZWN0cy9FbmRnYW1lVHJhaW5lci10cmFpbmluZy1ib2FyZC1jb21wbGV0ZS9zcmMvdGVzdHMvdW5pdC9zdG9yZS9zbGljZXMvZ2FtZVNsaWNlLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBUZXN0cyBmb3IgR2FtZVNsaWNlIHdpdGggbmVzdGVkIHN0b3JlIHN0cnVjdHVyZVxuICogQG1vZHVsZSB0ZXN0cy91bml0L3N0b3JlL3NsaWNlcy9nYW1lU2xpY2UubmVzdGVkXG4gKi9cblxuaW1wb3J0IHsgdXNlU3RvcmUgfSBmcm9tIFwiQHNoYXJlZC9zdG9yZS9yb290U3RvcmVcIjtcbmltcG9ydCB7IGNoZXNzU2VydmljZSB9IGZyb20gXCJAc2hhcmVkL3NlcnZpY2VzL0NoZXNzU2VydmljZVwiO1xuXG4vLyBNb2NrIENoZXNzU2VydmljZVxuamVzdC5tb2NrKFwiQHNoYXJlZC9zZXJ2aWNlcy9DaGVzc1NlcnZpY2VcIiwgKCkgPT4gKHtcbiAgY2hlc3NTZXJ2aWNlOiB7XG4gICAgcmVzZXQ6IGplc3QuZm4oKSxcbiAgICBpbml0aWFsaXplOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHRydWUpLCAvLyBNb2NrIGluaXRpYWxpemUgbWV0aG9kXG4gICAgbG9hZFBvc2l0aW9uOiBqZXN0LmZuKCksXG4gICAgZ2V0RmVuOiBqZXN0XG4gICAgICAuZm4oKVxuICAgICAgLm1vY2tSZXR1cm5WYWx1ZShcbiAgICAgICAgXCJybmJxa2Juci9wcHBwcHBwcC84LzgvOC84L1BQUFBQUFBQL1JOQlFLQk5SIHcgS1FrcSAtIDAgMVwiLFxuICAgICAgKSxcbiAgICBnZXRQZ246IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoXCJcIiksXG4gICAgZ2V0SGlzdG9yeTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShbXSksXG4gICAgdHVybjogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShcIndcIiksXG4gICAgaXNHYW1lT3ZlcjogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShmYWxzZSksXG4gICAgaXNDaGVjazogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShmYWxzZSksXG4gICAgaXNDaGVja21hdGU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoZmFsc2UpLFxuICAgIGlzRHJhdzogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShmYWxzZSksXG4gICAgaXNTdGFsZW1hdGU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoZmFsc2UpLFxuICAgIGlzVGhyZWVmb2xkUmVwZXRpdGlvbjogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShmYWxzZSksXG4gICAgaXNJbnN1ZmZpY2llbnRNYXRlcmlhbDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShmYWxzZSksXG4gICAgb25TdGF0ZUNoYW5nZTogamVzdC5mbigpLFxuICAgIG1vdmU6IGplc3QuZm4oKSxcbiAgICB1bmRvOiBqZXN0LmZuKCksXG4gICAgdmFsaWRhdGVNb3ZlOiBqZXN0LmZuKCksXG4gICAgZ2V0TW92ZXM6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoW10pLFxuICAgIHN1YnNjcmliZTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShqZXN0LmZuKCkpLCAvLyBNb2NrIHN1YnNjcmliZSB0byByZXR1cm4gdW5zdWJzY3JpYmUgZnVuY3Rpb25cbiAgICBlbWl0OiBqZXN0LmZuKCksXG4gIH0sXG59KSk7XG5cbmRlc2NyaWJlKFwiR2FtZVNsaWNlIC0gTmVzdGVkIFN0b3JlIFN0cnVjdHVyZVwiLCAoKSA9PiB7XG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIC8vIFJlc2V0IG1vY2tzXG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG5cbiAgICAvLyBSZXNldCBzdG9yZSB0byBpbml0aWFsIHN0YXRlIC0gcHJlc2VydmUgYWN0aW9ucyBieSBvbmx5IHVwZGF0aW5nIHN0YXRlIHByb3BlcnRpZXNcbiAgICB1c2VTdG9yZS5zZXRTdGF0ZSgoc3RhdGUpID0+IHtcbiAgICAgIHN0YXRlLmdhbWUuY3VycmVudEZlbiA9XG4gICAgICAgIFwicm5icWtibnIvcHBwcHBwcHAvOC84LzgvOC9QUFBQUFBQUC9STkJRS0JOUiB3IEtRa3EgLSAwIDFcIjtcbiAgICAgIHN0YXRlLmdhbWUuY3VycmVudFBnbiA9IFwiXCI7XG4gICAgICBzdGF0ZS5nYW1lLm1vdmVIaXN0b3J5ID0gW107XG4gICAgICBzdGF0ZS5nYW1lLmN1cnJlbnRNb3ZlSW5kZXggPSAtMTtcbiAgICAgIHN0YXRlLmdhbWUuaXNHYW1lRmluaXNoZWQgPSBmYWxzZTtcbiAgICAgIHN0YXRlLmdhbWUuZ2FtZVJlc3VsdCA9IG51bGw7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwicmVzZXRHYW1lXCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCBjYWxsIENoZXNzU2VydmljZSByZXNldFwiLCAoKSA9PiB7XG4gICAgICBjb25zdCBzdG9yZSA9IHVzZVN0b3JlLmdldFN0YXRlKCk7XG5cbiAgICAgIC8vIE1vZGlmeSBzb21lIHN0YXRlIGZpcnN0XG4gICAgICBzdG9yZS5nYW1lLnNldEdhbWVGaW5pc2hlZCh0cnVlKTtcbiAgICAgIGV4cGVjdCh1c2VTdG9yZS5nZXRTdGF0ZSgpLmdhbWUuaXNHYW1lRmluaXNoZWQpLnRvQmUodHJ1ZSk7XG5cbiAgICAgIC8vIFJlc2V0IGdhbWUgLSB0aGlzIGNhbGxzIGNoZXNzU2VydmljZS5yZXNldCgpIHdoaWNoIHNob3VsZCBlbWl0IGFuIGV2ZW50XG4gICAgICAvLyBJbiBhIHJlYWwgc2NlbmFyaW8sIHRoZSByb290U3RvcmUgc3Vic2NyaXB0aW9uIHdvdWxkIHN5bmMgdGhlIHN0YXRlXG4gICAgICBzdG9yZS5nYW1lLnJlc2V0R2FtZSgpO1xuXG4gICAgICAvLyBWZXJpZnkgdGhhdCBDaGVzc1NlcnZpY2UucmVzZXQgd2FzIGNhbGxlZFxuICAgICAgZXhwZWN0KGNoZXNzU2VydmljZS5yZXNldCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuXG4gICAgICAvLyBJbiB1bml0IHRlc3RzLCB3ZSdkIG5lZWQgdG8gbWFudWFsbHkgdHJpZ2dlciB0aGUgc3RhdGUgc3luYyBvciBtb2NrIHRoZSBldmVudCBzeXN0ZW1cbiAgICAgIC8vIEZvciBub3csIGp1c3QgdGVzdCB0aGF0IHRoZSBzZXJ2aWNlIG1ldGhvZCB3YXMgY2FsbGVkXG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwiaW5pdGlhbGl6ZUdhbWVcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIGluaXRpYWxpemUgZ2FtZSB3aXRoIEZFTlwiLCAoKSA9PiB7XG4gICAgICBjb25zdCBzdG9yZSA9IHVzZVN0b3JlLmdldFN0YXRlKCk7XG4gICAgICBjb25zdCB0ZXN0RmVuID0gXCI4LzgvOC84LzgvOC84LzggdyAtIC0gMCAxXCI7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IHN0b3JlLmdhbWUuaW5pdGlhbGl6ZUdhbWUodGVzdEZlbik7XG5cbiAgICAgIC8vIFRoZSBhY3R1YWwgaW1wbGVtZW50YXRpb24gd291bGQgdXNlIGNoZXNzU2VydmljZVxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJzZXRHYW1lRmluaXNoZWRcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIHNldCBnYW1lIGZpbmlzaGVkIHRvIHRydWVcIiwgKCkgPT4ge1xuICAgICAgY29uc3Qgc3RvcmUgPSB1c2VTdG9yZS5nZXRTdGF0ZSgpO1xuXG4gICAgICBzdG9yZS5nYW1lLnNldEdhbWVGaW5pc2hlZCh0cnVlKTtcblxuICAgICAgY29uc3Qgc3RhdGUgPSB1c2VTdG9yZS5nZXRTdGF0ZSgpO1xuICAgICAgZXhwZWN0KHN0YXRlLmdhbWUuaXNHYW1lRmluaXNoZWQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBzZXQgZ2FtZSBmaW5pc2hlZCB0byBmYWxzZVwiLCAoKSA9PiB7XG4gICAgICBjb25zdCBzdG9yZSA9IHVzZVN0b3JlLmdldFN0YXRlKCk7XG5cbiAgICAgIHN0b3JlLmdhbWUuc2V0R2FtZUZpbmlzaGVkKGZhbHNlKTtcblxuICAgICAgY29uc3Qgc3RhdGUgPSB1c2VTdG9yZS5nZXRTdGF0ZSgpO1xuICAgICAgZXhwZWN0KHN0YXRlLmdhbWUuaXNHYW1lRmluaXNoZWQpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcInVwZGF0ZVBvc2l0aW9uXCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCB1cGRhdGUgcG9zaXRpb24gd2l0aCBGRU4gYW5kIFBHTlwiLCAoKSA9PiB7XG4gICAgICBjb25zdCBzdG9yZSA9IHVzZVN0b3JlLmdldFN0YXRlKCk7XG4gICAgICBjb25zdCB0ZXN0RmVuID0gXCI4LzgvOC84LzgvOC84LzggdyAtIC0gMCAxXCI7XG4gICAgICBjb25zdCB0ZXN0UGduID0gXCIxLiBlNFwiO1xuXG4gICAgICBzdG9yZS5nYW1lLnVwZGF0ZVBvc2l0aW9uKHRlc3RGZW4sIHRlc3RQZ24pO1xuXG4gICAgICBjb25zdCBzdGF0ZSA9IHVzZVN0b3JlLmdldFN0YXRlKCk7XG4gICAgICBleHBlY3Qoc3RhdGUuZ2FtZS5jdXJyZW50RmVuKS50b0JlKHRlc3RGZW4pO1xuICAgICAgZXhwZWN0KHN0YXRlLmdhbWUuY3VycmVudFBnbikudG9CZSh0ZXN0UGduKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJzZXRNb3ZlSGlzdG9yeVwiLCAoKSA9PiB7XG4gICAgaXQoXCJzaG91bGQgc2V0IG1vdmUgaGlzdG9yeVwiLCAoKSA9PiB7XG4gICAgICBjb25zdCBzdG9yZSA9IHVzZVN0b3JlLmdldFN0YXRlKCk7XG4gICAgICBjb25zdCBtb2NrTW92ZXMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICBzYW46IFwiZTRcIixcbiAgICAgICAgICBmcm9tOiBcImUyXCIsXG4gICAgICAgICAgdG86IFwiZTRcIixcbiAgICAgICAgICBjb2xvcjogXCJ3XCIsXG4gICAgICAgICAgcGllY2U6IFwicFwiLFxuICAgICAgICAgIGNhcHR1cmVkOiB1bmRlZmluZWQsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBzYW46IFwiZTVcIixcbiAgICAgICAgICBmcm9tOiBcImU3XCIsXG4gICAgICAgICAgdG86IFwiZTVcIixcbiAgICAgICAgICBjb2xvcjogXCJiXCIsXG4gICAgICAgICAgcGllY2U6IFwicFwiLFxuICAgICAgICAgIGNhcHR1cmVkOiB1bmRlZmluZWQsXG4gICAgICAgIH0sXG4gICAgICBdIGFzIGFueTtcblxuICAgICAgc3RvcmUuZ2FtZS5zZXRNb3ZlSGlzdG9yeShtb2NrTW92ZXMpO1xuXG4gICAgICBjb25zdCBzdGF0ZSA9IHVzZVN0b3JlLmdldFN0YXRlKCk7XG4gICAgICBleHBlY3Qoc3RhdGUuZ2FtZS5tb3ZlSGlzdG9yeSkudG9FcXVhbChtb2NrTW92ZXMpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcInNldEN1cnJlbnRNb3ZlSW5kZXhcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIHNldCBjdXJyZW50IG1vdmUgaW5kZXhcIiwgKCkgPT4ge1xuICAgICAgY29uc3Qgc3RvcmUgPSB1c2VTdG9yZS5nZXRTdGF0ZSgpO1xuXG4gICAgICBzdG9yZS5nYW1lLnNldEN1cnJlbnRNb3ZlSW5kZXgoNSk7XG5cbiAgICAgIGNvbnN0IHN0YXRlID0gdXNlU3RvcmUuZ2V0U3RhdGUoKTtcbiAgICAgIGV4cGVjdChzdGF0ZS5nYW1lLmN1cnJlbnRNb3ZlSW5kZXgpLnRvQmUoNSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwiSW50ZWdyYXRpb24gd2l0aCBuZXN0ZWQgc3RydWN0dXJlXCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCB3b3JrIHdpdGggb3RoZXIgc2xpY2VzIGluIHRoZSBzdG9yZVwiLCAoKSA9PiB7XG4gICAgICBjb25zdCBzdG9yZSA9IHVzZVN0b3JlLmdldFN0YXRlKCk7XG5cbiAgICAgIC8vIFZlcmlmeSB0aGF0IG90aGVyIHNsaWNlcyBleGlzdFxuICAgICAgZXhwZWN0KHN0b3JlLnRhYmxlYmFzZSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChzdG9yZS50cmFpbmluZykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChzdG9yZS51aSkudG9CZURlZmluZWQoKTtcblxuICAgICAgLy8gU2V0IGdhbWUgZGF0YVxuICAgICAgc3RvcmUuZ2FtZS5zZXRHYW1lRmluaXNoZWQodHJ1ZSk7XG5cbiAgICAgIC8vIFZlcmlmeSBpdCBkb2Vzbid0IGFmZmVjdCBvdGhlciBzbGljZXNcbiAgICAgIGNvbnN0IHN0YXRlID0gdXNlU3RvcmUuZ2V0U3RhdGUoKTtcbiAgICAgIGV4cGVjdChzdGF0ZS5nYW1lLmlzR2FtZUZpbmlzaGVkKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHN0YXRlLnRhYmxlYmFzZS5hbmFseXNpc1N0YXR1cykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChzdGF0ZS50cmFpbmluZy5pc1BsYXllclR1cm4pLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBtYWludGFpbiBwcm9wZXIgbmVzdGluZyBpbiBzdGF0ZSB1cGRhdGVzXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHN0b3JlID0gdXNlU3RvcmUuZ2V0U3RhdGUoKTtcblxuICAgICAgLy8gTWFrZSBtdWx0aXBsZSB1cGRhdGVzXG4gICAgICBzdG9yZS5nYW1lLnNldEdhbWVGaW5pc2hlZCh0cnVlKTtcbiAgICAgIHN0b3JlLmdhbWUuc2V0Q3VycmVudE1vdmVJbmRleCgzKTtcblxuICAgICAgLy8gQ2hlY2sgYWxsIHVwZGF0ZXMgd2VyZSBhcHBsaWVkIGNvcnJlY3RseVxuICAgICAgY29uc3Qgc3RhdGUgPSB1c2VTdG9yZS5nZXRTdGF0ZSgpO1xuICAgICAgZXhwZWN0KHN0YXRlLmdhbWUuaXNHYW1lRmluaXNoZWQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3Qoc3RhdGUuZ2FtZS5jdXJyZW50TW92ZUluZGV4KS50b0JlKDMpO1xuXG4gICAgICAvLyBWZXJpZnkgc3RydWN0dXJlIGlzIG1haW50YWluZWRcbiAgICAgIGV4cGVjdChzdGF0ZS5nYW1lKS50b0hhdmVQcm9wZXJ0eShcImN1cnJlbnRGZW5cIik7XG4gICAgICBleHBlY3Qoc3RhdGUuZ2FtZSkudG9IYXZlUHJvcGVydHkoXCJtb3ZlSGlzdG9yeVwiKTtcbiAgICAgIGV4cGVjdChzdGF0ZS5nYW1lKS50b0hhdmVQcm9wZXJ0eShcInJlc2V0R2FtZVwiKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJuYW1lcyI6WyJqZXN0IiwibW9jayIsImNoZXNzU2VydmljZSIsInJlc2V0IiwiZm4iLCJpbml0aWFsaXplIiwibW9ja1JldHVyblZhbHVlIiwibG9hZFBvc2l0aW9uIiwiZ2V0RmVuIiwiZ2V0UGduIiwiZ2V0SGlzdG9yeSIsInR1cm4iLCJpc0dhbWVPdmVyIiwiaXNDaGVjayIsImlzQ2hlY2ttYXRlIiwiaXNEcmF3IiwiaXNTdGFsZW1hdGUiLCJpc1RocmVlZm9sZFJlcGV0aXRpb24iLCJpc0luc3VmZmljaWVudE1hdGVyaWFsIiwib25TdGF0ZUNoYW5nZSIsIm1vdmUiLCJ1bmRvIiwidmFsaWRhdGVNb3ZlIiwiZ2V0TW92ZXMiLCJzdWJzY3JpYmUiLCJlbWl0IiwiZGVzY3JpYmUiLCJiZWZvcmVFYWNoIiwiY2xlYXJBbGxNb2NrcyIsInVzZVN0b3JlIiwic2V0U3RhdGUiLCJzdGF0ZSIsImdhbWUiLCJjdXJyZW50RmVuIiwiY3VycmVudFBnbiIsIm1vdmVIaXN0b3J5IiwiY3VycmVudE1vdmVJbmRleCIsImlzR2FtZUZpbmlzaGVkIiwiZ2FtZVJlc3VsdCIsIml0Iiwic3RvcmUiLCJnZXRTdGF0ZSIsInNldEdhbWVGaW5pc2hlZCIsImV4cGVjdCIsInRvQmUiLCJyZXNldEdhbWUiLCJ0b0hhdmVCZWVuQ2FsbGVkIiwidGVzdEZlbiIsInJlc3VsdCIsImluaXRpYWxpemVHYW1lIiwidG9CZURlZmluZWQiLCJ0ZXN0UGduIiwidXBkYXRlUG9zaXRpb24iLCJtb2NrTW92ZXMiLCJzYW4iLCJmcm9tIiwidG8iLCJjb2xvciIsInBpZWNlIiwiY2FwdHVyZWQiLCJ1bmRlZmluZWQiLCJzZXRNb3ZlSGlzdG9yeSIsInRvRXF1YWwiLCJzZXRDdXJyZW50TW92ZUluZGV4IiwidGFibGViYXNlIiwidHJhaW5pbmciLCJ1aSIsImFuYWx5c2lzU3RhdHVzIiwiaXNQbGF5ZXJUdXJuIiwidG9IYXZlUHJvcGVydHkiXSwibWFwcGluZ3MiOiJBQUFBOzs7Q0FHQztBQUtELG9CQUFvQjtBQUNwQkEsS0FBS0MsSUFBSSxDQUFDLGlDQUFpQyxJQUFPLENBQUE7UUFDaERDLGNBQWM7WUFDWkMsT0FBT0gsS0FBS0ksRUFBRTtZQUNkQyxZQUFZTCxLQUFLSSxFQUFFLEdBQUdFLGVBQWUsQ0FBQztZQUN0Q0MsY0FBY1AsS0FBS0ksRUFBRTtZQUNyQkksUUFBUVIsS0FDTEksRUFBRSxHQUNGRSxlQUFlLENBQ2Q7WUFFSkcsUUFBUVQsS0FBS0ksRUFBRSxHQUFHRSxlQUFlLENBQUM7WUFDbENJLFlBQVlWLEtBQUtJLEVBQUUsR0FBR0UsZUFBZSxDQUFDLEVBQUU7WUFDeENLLE1BQU1YLEtBQUtJLEVBQUUsR0FBR0UsZUFBZSxDQUFDO1lBQ2hDTSxZQUFZWixLQUFLSSxFQUFFLEdBQUdFLGVBQWUsQ0FBQztZQUN0Q08sU0FBU2IsS0FBS0ksRUFBRSxHQUFHRSxlQUFlLENBQUM7WUFDbkNRLGFBQWFkLEtBQUtJLEVBQUUsR0FBR0UsZUFBZSxDQUFDO1lBQ3ZDUyxRQUFRZixLQUFLSSxFQUFFLEdBQUdFLGVBQWUsQ0FBQztZQUNsQ1UsYUFBYWhCLEtBQUtJLEVBQUUsR0FBR0UsZUFBZSxDQUFDO1lBQ3ZDVyx1QkFBdUJqQixLQUFLSSxFQUFFLEdBQUdFLGVBQWUsQ0FBQztZQUNqRFksd0JBQXdCbEIsS0FBS0ksRUFBRSxHQUFHRSxlQUFlLENBQUM7WUFDbERhLGVBQWVuQixLQUFLSSxFQUFFO1lBQ3RCZ0IsTUFBTXBCLEtB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