{"version":3,"sources":["/home/thehu/coolProjects/EndgameTrainer-training-board-complete/src/tests/unit/chess/tablebaseEvaluation.test.ts"],"sourcesContent":["/**\n * @file Unit tests for tablebase-based move quality evaluation\n * @description Tests getMoveQualityDisplay function with various evaluations\n */\n\nimport { describe, test, expect } from \"@jest/globals\";\nimport { getMoveQualityDisplay } from \"../../../shared/utils/chess/evaluation\";\n\ndescribe(\"Tablebase Evaluation - Move Quality Display\", () => {\n  describe(\"Mate Evaluations\", () => {\n    test(\"should_display_mate_in_1_as_excellent\", () => {\n      const result = getMoveQualityDisplay(0, 1, true);\n\n      expect(result.text).toBe(\"#1\");\n      expect(result.className).toBe(\"eval-excellent\");\n      expect(result.color).toBe(\"#10b981\");\n      expect(result.bgColor).toBe(\"#065f46\");\n    });\n\n    test(\"should_display_mate_in_3_as_excellent\", () => {\n      const result = getMoveQualityDisplay(0, 3, true);\n\n      expect(result.text).toBe(\"#3\");\n      expect(result.className).toBe(\"eval-excellent\");\n    });\n\n    test(\"should_display_mate_in_15_as_excellent\", () => {\n      const result = getMoveQualityDisplay(0, 15, true);\n\n      expect(result.text).toBe(\"#15\");\n      expect(result.className).toBe(\"eval-excellent\");\n    });\n\n    test(\"should_display_being_mated_as_neutral\", () => {\n      const result = getMoveQualityDisplay(0, -5, true);\n\n      expect(result.text).toBe(\"#5\");\n      expect(result.className).toBe(\"eval-neutral\");\n      expect(result.color).toBe(\"var(--text-secondary)\");\n      expect(result.bgColor).toBe(\"var(--bg-accent)\");\n    });\n\n    test(\"should_use_absolute_value_for_negative_mate\", () => {\n      const result = getMoveQualityDisplay(0, -1, true);\n\n      expect(result.text).toBe(\"#1\");\n      expect(result.className).toBe(\"eval-neutral\");\n    });\n  });\n\n  describe(\"Positional Evaluations\", () => {\n    test(\"should_display_dominating_position_with_star\", () => {\n      // >= 5.0 pawns advantage\n      const result = getMoveQualityDisplay(5.5, undefined, true);\n\n      expect(result.text).toBe(\"箝申");\n      expect(result.className).toBe(\"eval-excellent\");\n      expect(result.color).toBe(\"#10b981\");\n      expect(result.bgColor).toBe(\"#065f46\");\n    });\n\n    test(\"should_display_excellent_position_with_sparkles\", () => {\n      // >= 2.0 pawns advantage\n      const result = getMoveQualityDisplay(3.0, undefined, true);\n\n      expect(result.text).toBe(\"笨ｨ\");\n      expect(result.className).toBe(\"eval-excellent\");\n    });\n\n    test(\"should_display_good_position_with_ok_hand\", () => {\n      // >= 0.5 pawns advantage\n      const result = getMoveQualityDisplay(1.0, undefined, true);\n\n      expect(result.text).toBe(\"汨圭");\n      expect(result.className).toBe(\"eval-good\");\n      expect(result.color).toBe(\"#3b82f6\");\n      expect(result.bgColor).toBe(\"#1e40af\");\n    });\n\n    test(\"should_display_neutral_position_with_circle\", () => {\n      // Near 0 evaluation\n      const result = getMoveQualityDisplay(0.1, undefined, true);\n\n      expect(result.text).toBe(\"笞ｪ\");\n      expect(result.className).toBe(\"eval-neutral\");\n      expect(result.color).toBe(\"var(--text-secondary)\");\n      expect(result.bgColor).toBe(\"var(--bg-accent)\");\n    });\n  });\n\n  describe(\"Threshold Tests\", () => {\n    test(\"should_handle_exact_5_0_threshold\", () => {\n      const result = getMoveQualityDisplay(5.0, undefined, true);\n      expect(result.text).toBe(\"箝申");\n    });\n\n    test(\"should_handle_just_below_5_0_threshold\", () => {\n      const result = getMoveQualityDisplay(4.99, undefined, true);\n      expect(result.text).toBe(\"笨ｨ\");\n    });\n\n    test(\"should_handle_exact_2_0_threshold\", () => {\n      const result = getMoveQualityDisplay(2.0, undefined, true);\n      expect(result.text).toBe(\"笨ｨ\");\n    });\n\n    test(\"should_handle_just_below_2_0_threshold\", () => {\n      const result = getMoveQualityDisplay(1.99, undefined, true);\n      expect(result.text).toBe(\"汨圭");\n    });\n\n    test(\"should_handle_exact_0_5_threshold\", () => {\n      const result = getMoveQualityDisplay(0.5, undefined, true);\n      expect(result.text).toBe(\"汨圭");\n    });\n\n    test(\"should_handle_just_below_0_5_threshold\", () => {\n      const result = getMoveQualityDisplay(0.49, undefined, true);\n      expect(result.text).toBe(\"笞ｪ\");\n    });\n  });\n\n  describe(\"Absolute Value Handling\", () => {\n    test(\"should_use_absolute_value_for_negative_evaluations\", () => {\n      const negativeResult = getMoveQualityDisplay(-3.0, undefined, true);\n      const positiveResult = getMoveQualityDisplay(3.0, undefined, true);\n\n      expect(negativeResult.text).toBe(positiveResult.text);\n      expect(negativeResult.className).toBe(positiveResult.className);\n    });\n\n    test(\"should_treat_minus_5_same_as_plus_5\", () => {\n      const result = getMoveQualityDisplay(-5.0, undefined, true);\n\n      expect(result.text).toBe(\"箝申");\n      expect(result.className).toBe(\"eval-excellent\");\n    });\n\n    test(\"should_treat_minus_1_same_as_plus_1\", () => {\n      const result = getMoveQualityDisplay(-1.0, undefined, true);\n\n      expect(result.text).toBe(\"汨圭");\n      expect(result.className).toBe(\"eval-good\");\n    });\n  });\n\n  describe(\"Edge Cases\", () => {\n    test(\"should_handle_very_large_evaluations\", () => {\n      const result = getMoveQualityDisplay(100.0, undefined, true);\n\n      expect(result.text).toBe(\"箝申");\n      expect(result.className).toBe(\"eval-excellent\");\n    });\n\n    test(\"should_handle_very_small_evaluations\", () => {\n      const result = getMoveQualityDisplay(0.01, undefined, true);\n\n      expect(result.text).toBe(\"笞ｪ\");\n      expect(result.className).toBe(\"eval-neutral\");\n    });\n\n    test(\"should_handle_zero_evaluation\", () => {\n      const result = getMoveQualityDisplay(0.0, undefined, true);\n\n      expect(result.text).toBe(\"笞ｪ\");\n      expect(result.className).toBe(\"eval-neutral\");\n    });\n\n    test(\"should_handle_zero_mate_as_normal_evaluation\", () => {\n      // Zero mate is undefined behavior, falls through to evaluation\n      const result = getMoveQualityDisplay(1.0, 0, true);\n\n      expect(result.text).toBe(\"汨圭");\n      expect(result.className).toBe(\"eval-good\");\n    });\n\n    test(\"should_handle_NaN_gracefully\", () => {\n      const result = getMoveQualityDisplay(NaN, undefined, true);\n\n      // NaN >= checks will be false, so it falls through to default\n      expect(result.text).toBe(\"笞ｪ\");\n      expect(result.className).toBe(\"eval-neutral\");\n    });\n\n    test(\"should_handle_Infinity\", () => {\n      const result = getMoveQualityDisplay(Infinity, undefined, true);\n\n      expect(result.text).toBe(\"箝申");\n      expect(result.className).toBe(\"eval-excellent\");\n    });\n\n    test(\"should_handle_negative_Infinity\", () => {\n      const result = getMoveQualityDisplay(-Infinity, undefined, true);\n\n      expect(result.text).toBe(\"箝申");\n      expect(result.className).toBe(\"eval-excellent\");\n    });\n  });\n\n  describe(\"Legacy Parameter\", () => {\n    test(\"should_ignore_isPlayerMove_parameter\", () => {\n      const withTrue = getMoveQualityDisplay(3.0, undefined, true);\n      const withFalse = getMoveQualityDisplay(3.0, undefined, false);\n\n      expect(withTrue).toEqual(withFalse);\n    });\n  });\n\n  describe(\"Complete Display Object\", () => {\n    test(\"should_return_all_required_properties\", () => {\n      const result = getMoveQualityDisplay(1.0, undefined, true);\n\n      expect(result).toHaveProperty(\"text\");\n      expect(result).toHaveProperty(\"className\");\n      expect(result).toHaveProperty(\"color\");\n      expect(result).toHaveProperty(\"bgColor\");\n\n      expect(typeof result.text).toBe(\"string\");\n      expect(typeof result.className).toBe(\"string\");\n      expect(typeof result.color).toBe(\"string\");\n      expect(typeof result.bgColor).toBe(\"string\");\n    });\n  });\n});\n"],"names":["describe","test","result","getMoveQualityDisplay","expect","text","toBe","className","color","bgColor","undefined","negativeResult","positiveResult","NaN","Infinity","withTrue","withFalse","toEqual","toHaveProperty"],"mappings":"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"}