9c564783b48ea68fce2f32915ef54cec
/**
 * Test suite to reproduce the Move History navigation bug
 * Bug: When clicking on a move in history, subsequent moves appear to be deleted
 * Expected: All moves should remain visible, only the position should change
 */ "use strict";
// Mock the store hooks
jest.mock("@shared/store/hooks", ()=>({
        useGameStore: jest.fn(),
        useTablebaseStore: jest.fn(),
        useTrainingStore: jest.fn()
    }));
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _jsxruntime = require("react/jsx-runtime");
const _react = /*#__PURE__*/ _interop_require_default(require("react"));
const _react1 = require("@testing-library/react");
const _MovePanelZustand = require("../../../shared/components/training/MovePanelZustand");
const _validatedMoveFactory = require("../../helpers/validatedMoveFactory");
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
const mockUseGameStore = jest.requireMock("@shared/store/hooks").useGameStore;
const mockUseTablebaseStore = jest.requireMock("@shared/store/hooks").useTablebaseStore;
const mockUseTrainingStore = jest.requireMock("@shared/store/hooks").useTrainingStore;
describe("Move History Navigation Bug", ()=>{
    /**
   *
   */ const createMockMoves = ()=>[
            (0, _validatedMoveFactory.createTestValidatedMove)({
                from: "e2",
                to: "e4",
                san: "e4",
                color: "w",
                piece: "p"
            }),
            (0, _validatedMoveFactory.createTestValidatedMove)({
                from: "e7",
                to: "e5",
                san: "e5",
                color: "b",
                piece: "p"
            }),
            (0, _validatedMoveFactory.createTestValidatedMove)({
                from: "g1",
                to: "f3",
                san: "Nf3",
                color: "w",
                piece: "n"
            }),
            (0, _validatedMoveFactory.createTestValidatedMove)({
                from: "b8",
                to: "c6",
                san: "Nc6",
                color: "b",
                piece: "n"
            }),
            (0, _validatedMoveFactory.createTestValidatedMove)({
                from: "f1",
                to: "c4",
                san: "Bc4",
                color: "w",
                piece: "b"
            })
        ];
    beforeEach(()=>{
        // Setup default mock returns
        mockUseTablebaseStore.mockReturnValue([
            {
                evaluations: []
            },
            {}
        ]);
        mockUseTrainingStore.mockReturnValue([
            {
                currentPosition: null
            },
            {}
        ]);
    });
    afterEach(()=>{
        jest.clearAllMocks();
    });
    it("FIX VERIFICATION: Should show ALL moves even when navigating to an earlier move", ()=>{
        const mockMoves = createMockMoves();
        const onMoveClick = jest.fn();
        // Initial state: All 5 moves played, viewing the last move (index 4)
        mockUseGameStore.mockReturnValue([
            {
                moveHistory: mockMoves,
                currentMoveIndex: 4,
                currentFen: "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"
            },
            {}
        ]);
        const { rerender } = (0, _react1.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_MovePanelZustand.MovePanelZustand, {
            onMoveClick: onMoveClick,
            currentMoveIndex: 4
        }));
        // Verify all 5 moves are displayed initially
        expect(_react1.screen.getByText("e4")).toBeInTheDocument();
        expect(_react1.screen.getByText("e5")).toBeInTheDocument();
        expect(_react1.screen.getByText("Nf3")).toBeInTheDocument();
        expect(_react1.screen.getByText("Nc6")).toBeInTheDocument();
        expect(_react1.screen.getByText("Bc4")).toBeInTheDocument();
        // User clicks on move 2 (Nf3) to navigate there
        const nf3Button = _react1.screen.getByText("Nf3");
        _react1.fireEvent.click(nf3Button);
        expect(onMoveClick).toHaveBeenCalledWith(2);
        // Simulate the state update after navigation
        // The bug is that currentMoveIndex changes to 2
        mockUseGameStore.mockReturnValue([
            {
                moveHistory: mockMoves,
                currentMoveIndex: 2,
                currentFen: "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"
            },
            {}
        ]);
        rerender(/*#__PURE__*/ (0, _jsxruntime.jsx)(_MovePanelZustand.MovePanelZustand, {
            onMoveClick: onMoveClick,
            currentMoveIndex: 2
        }));
        // FIX VERIFICATION: After the fix, ALL moves should remain visible
        // when navigating to an earlier move
        console.log("\n=== FIX VERIFICATION ===");
        console.log("After clicking on move 2 (Nf3):");
        console.log("Expected: All 5 moves visible (e4, e5, Nf3, Nc6, Bc4)");
        console.log("With fix: All moves should now be visible!");
        // These assertions verify the fix works:
        expect(_react1.screen.getByText("e4")).toBeInTheDocument();
        expect(_react1.screen.getByText("e5")).toBeInTheDocument();
        expect(_react1.screen.getByText("Nf3")).toBeInTheDocument();
        // FIXED: These moves should now be visible!
        expect(_react1.screen.getByText("Nc6")).toBeInTheDocument(); // Now visible!
        expect(_react1.screen.getByText("Bc4")).toBeInTheDocument(); // Now visible!
    });
    it("EXPECTED BEHAVIOR: Should display all moves with proper highlighting", ()=>{
        const mockMoves = createMockMoves();
        const onMoveClick = jest.fn();
        // This test shows what SHOULD happen
        mockUseGameStore.mockReturnValue([
            {
                moveHistory: mockMoves,
                currentMoveIndex: 2,
                currentFen: "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"
            },
            {}
        ]);
        // If the bug was fixed, this is what we'd see:
        console.log("\n=== EXPECTED BEHAVIOR ===");
        console.log("When viewing move 2:");
        console.log("- All 5 moves should be visible");
        console.log("- Move 3 (Nf3) should be highlighted as current");
        console.log("- Moves 4-5 (Nc6, Bc4) should appear grayed out or different");
        console.log("- User can click any move to jump there");
    });
    it("Verifies the actual data flow", ()=>{
        const mockMoves = createMockMoves();
        // Log the actual data to understand the bug
        console.log("\n=== DATA FLOW ANALYSIS ===");
        console.log("1. Initial state:");
        console.log(`   - moveHistory.length: ${mockMoves.length}`);
        console.log(`   - currentMoveIndex: 4`);
        console.log(`   - All moves: ${mockMoves.map((m)=>m.san).join(", ")}`);
        console.log("\n2. After clicking move 2:");
        console.log(`   - moveHistory.length: ${mockMoves.length} (unchanged)`);
        console.log(`   - currentMoveIndex: 2 (changed)`);
        console.log(`   - All moves still in store: ${mockMoves.map((m)=>m.san).join(", ")}`);
        console.log("\n3. Bug in MovePanelZustand:");
        console.log("   - Line 160-162 slices moveHistory:");
        console.log("     gameState.moveHistory.slice(0, currentMoveIndex + 1)");
        console.log(`   - This creates: slice(0, 3) = first 3 moves only`);
        console.log("   - Result: Moves 4-5 disappear from UI!");
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL3RoZWh1L2Nvb2xQcm9qZWN0cy9FbmRnYW1lVHJhaW5lci10cmFpbmluZy1ib2FyZC1jb21wbGV0ZS9zcmMvdGVzdHMvdW5pdC9jb21wb25lbnRzL01vdmVIaXN0b3J5TmF2aWdhdGlvbkJ1Zy50ZXN0LnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFRlc3Qgc3VpdGUgdG8gcmVwcm9kdWNlIHRoZSBNb3ZlIEhpc3RvcnkgbmF2aWdhdGlvbiBidWdcbiAqIEJ1ZzogV2hlbiBjbGlja2luZyBvbiBhIG1vdmUgaW4gaGlzdG9yeSwgc3Vic2VxdWVudCBtb3ZlcyBhcHBlYXIgdG8gYmUgZGVsZXRlZFxuICogRXhwZWN0ZWQ6IEFsbCBtb3ZlcyBzaG91bGQgcmVtYWluIHZpc2libGUsIG9ubHkgdGhlIHBvc2l0aW9uIHNob3VsZCBjaGFuZ2VcbiAqL1xuXG5pbXBvcnQgUmVhY3QgZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgeyByZW5kZXIsIHNjcmVlbiwgZmlyZUV2ZW50IH0gZnJvbSBcIkB0ZXN0aW5nLWxpYnJhcnkvcmVhY3RcIjtcbmltcG9ydCB7IE1vdmVQYW5lbFp1c3RhbmQgfSBmcm9tIFwiQHNoYXJlZC9jb21wb25lbnRzL3RyYWluaW5nL01vdmVQYW5lbFp1c3RhbmRcIjtcbmltcG9ydCB7IHVzZVN0b3JlIH0gZnJvbSBcIkBzaGFyZWQvc3RvcmUvcm9vdFN0b3JlXCI7XG5pbXBvcnQgeyBjcmVhdGVUZXN0VmFsaWRhdGVkTW92ZSB9IGZyb20gXCJAdGVzdHMvaGVscGVycy92YWxpZGF0ZWRNb3ZlRmFjdG9yeVwiO1xuaW1wb3J0IHR5cGUgeyBWYWxpZGF0ZWRNb3ZlIH0gZnJvbSBcIkBzaGFyZWQvdHlwZXMvY2hlc3NcIjtcblxuLy8gTW9jayB0aGUgc3RvcmUgaG9va3Ncbmplc3QubW9jayhcIkBzaGFyZWQvc3RvcmUvaG9va3NcIiwgKCkgPT4gKHtcbiAgdXNlR2FtZVN0b3JlOiBqZXN0LmZuKCksXG4gIHVzZVRhYmxlYmFzZVN0b3JlOiBqZXN0LmZuKCksXG4gIHVzZVRyYWluaW5nU3RvcmU6IGplc3QuZm4oKSxcbn0pKTtcblxuY29uc3QgbW9ja1VzZUdhbWVTdG9yZSA9IGplc3QucmVxdWlyZU1vY2soXCJAc2hhcmVkL3N0b3JlL2hvb2tzXCIpLnVzZUdhbWVTdG9yZTtcbmNvbnN0IG1vY2tVc2VUYWJsZWJhc2VTdG9yZSA9IGplc3QucmVxdWlyZU1vY2soXG4gIFwiQHNoYXJlZC9zdG9yZS9ob29rc1wiLFxuKS51c2VUYWJsZWJhc2VTdG9yZTtcbmNvbnN0IG1vY2tVc2VUcmFpbmluZ1N0b3JlID0gamVzdC5yZXF1aXJlTW9jayhcbiAgXCJAc2hhcmVkL3N0b3JlL2hvb2tzXCIsXG4pLnVzZVRyYWluaW5nU3RvcmU7XG5cbmRlc2NyaWJlKFwiTW92ZSBIaXN0b3J5IE5hdmlnYXRpb24gQnVnXCIsICgpID0+IHtcbiAgLyoqXG4gICAqXG4gICAqL1xuICBjb25zdCBjcmVhdGVNb2NrTW92ZXMgPSAoKTogVmFsaWRhdGVkTW92ZVtdID0+IFtcbiAgICBjcmVhdGVUZXN0VmFsaWRhdGVkTW92ZSh7XG4gICAgICBmcm9tOiBcImUyXCIsXG4gICAgICB0bzogXCJlNFwiLFxuICAgICAgc2FuOiBcImU0XCIsXG4gICAgICBjb2xvcjogXCJ3XCIsXG4gICAgICBwaWVjZTogXCJwXCIsXG4gICAgfSksXG4gICAgY3JlYXRlVGVzdFZhbGlkYXRlZE1vdmUoe1xuICAgICAgZnJvbTogXCJlN1wiLFxuICAgICAgdG86IFwiZTVcIixcbiAgICAgIHNhbjogXCJlNVwiLFxuICAgICAgY29sb3I6IFwiYlwiLFxuICAgICAgcGllY2U6IFwicFwiLFxuICAgIH0pLFxuICAgIGNyZWF0ZVRlc3RWYWxpZGF0ZWRNb3ZlKHtcbiAgICAgIGZyb206IFwiZzFcIixcbiAgICAgIHRvOiBcImYzXCIsXG4gICAgICBzYW46IFwiTmYzXCIsXG4gICAgICBjb2xvcjogXCJ3XCIsXG4gICAgICBwaWVjZTogXCJuXCIsXG4gICAgfSksXG4gICAgY3JlYXRlVGVzdFZhbGlkYXRlZE1vdmUoe1xuICAgICAgZnJvbTogXCJiOFwiLFxuICAgICAgdG86IFwiYzZcIixcbiAgICAgIHNhbjogXCJOYzZcIixcbiAgICAgIGNvbG9yOiBcImJcIixcbiAgICAgIHBpZWNlOiBcIm5cIixcbiAgICB9KSxcbiAgICBjcmVhdGVUZXN0VmFsaWRhdGVkTW92ZSh7XG4gICAgICBmcm9tOiBcImYxXCIsXG4gICAgICB0bzogXCJjNFwiLFxuICAgICAgc2FuOiBcIkJjNFwiLFxuICAgICAgY29sb3I6IFwid1wiLFxuICAgICAgcGllY2U6IFwiYlwiLFxuICAgIH0pLFxuICBdO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIC8vIFNldHVwIGRlZmF1bHQgbW9jayByZXR1cm5zXG4gICAgbW9ja1VzZVRhYmxlYmFzZVN0b3JlLm1vY2tSZXR1cm5WYWx1ZShbXG4gICAgICB7XG4gICAgICAgIGV2YWx1YXRpb25zOiBbXSxcbiAgICAgIH0sXG4gICAgICB7fSxcbiAgICBdKTtcblxuICAgIG1vY2tVc2VUcmFpbmluZ1N0b3JlLm1vY2tSZXR1cm5WYWx1ZShbXG4gICAgICB7XG4gICAgICAgIGN1cnJlbnRQb3NpdGlvbjogbnVsbCxcbiAgICAgIH0sXG4gICAgICB7fSxcbiAgICBdKTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgaXQoXCJGSVggVkVSSUZJQ0FUSU9OOiBTaG91bGQgc2hvdyBBTEwgbW92ZXMgZXZlbiB3aGVuIG5hdmlnYXRpbmcgdG8gYW4gZWFybGllciBtb3ZlXCIsICgpID0+IHtcbiAgICBjb25zdCBtb2NrTW92ZXMgPSBjcmVhdGVNb2NrTW92ZXMoKTtcbiAgICBjb25zdCBvbk1vdmVDbGljayA9IGplc3QuZm4oKTtcblxuICAgIC8vIEluaXRpYWwgc3RhdGU6IEFsbCA1IG1vdmVzIHBsYXllZCwgdmlld2luZyB0aGUgbGFzdCBtb3ZlIChpbmRleCA0KVxuICAgIG1vY2tVc2VHYW1lU3RvcmUubW9ja1JldHVyblZhbHVlKFtcbiAgICAgIHtcbiAgICAgICAgbW92ZUhpc3Rvcnk6IG1vY2tNb3ZlcyxcbiAgICAgICAgY3VycmVudE1vdmVJbmRleDogNCwgLy8gVmlld2luZyB0aGUgbGFzdCBtb3ZlXG4gICAgICAgIGN1cnJlbnRGZW46IFwicm5icWtibnIvcHBwcHBwcHAvOC84LzgvOC9QUFBQUFBQUC9STkJRS0JOUiB3IEtRa3EgLSAwIDFcIixcbiAgICAgIH0sXG4gICAgICB7fSxcbiAgICBdKTtcblxuICAgIGNvbnN0IHsgcmVyZW5kZXIgfSA9IHJlbmRlcihcbiAgICAgIDxNb3ZlUGFuZWxadXN0YW5kIG9uTW92ZUNsaWNrPXtvbk1vdmVDbGlja30gY3VycmVudE1vdmVJbmRleD17NH0gLz4sXG4gICAgKTtcblxuICAgIC8vIFZlcmlmeSBhbGwgNSBtb3ZlcyBhcmUgZGlzcGxheWVkIGluaXRpYWxseVxuICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXh0KFwiZTRcIikpLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRleHQoXCJlNVwiKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGV4dChcIk5mM1wiKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGV4dChcIk5jNlwiKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGV4dChcIkJjNFwiKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcblxuICAgIC8vIFVzZXIgY2xpY2tzIG9uIG1vdmUgMiAoTmYzKSB0byBuYXZpZ2F0ZSB0aGVyZVxuICAgIGNvbnN0IG5mM0J1dHRvbiA9IHNjcmVlbi5nZXRCeVRleHQoXCJOZjNcIik7XG4gICAgZmlyZUV2ZW50LmNsaWNrKG5mM0J1dHRvbik7XG4gICAgZXhwZWN0KG9uTW92ZUNsaWNrKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgyKTtcblxuICAgIC8vIFNpbXVsYXRlIHRoZSBzdGF0ZSB1cGRhdGUgYWZ0ZXIgbmF2aWdhdGlvblxuICAgIC8vIFRoZSBidWcgaXMgdGhhdCBjdXJyZW50TW92ZUluZGV4IGNoYW5nZXMgdG8gMlxuICAgIG1vY2tVc2VHYW1lU3RvcmUubW9ja1JldHVyblZhbHVlKFtcbiAgICAgIHtcbiAgICAgICAgbW92ZUhpc3Rvcnk6IG1vY2tNb3ZlcywgLy8gQWxsIG1vdmVzIHN0aWxsIGluIGhpc3RvcnlcbiAgICAgICAgY3VycmVudE1vdmVJbmRleDogMiwgLy8gTm93IHZpZXdpbmcgbW92ZSAyXG4gICAgICAgIGN1cnJlbnRGZW46IFwicm5icWtibnIvcHBwcHBwcHAvOC84LzgvOC9QUFBQUFBQUC9STkJRS0JOUiB3IEtRa3EgLSAwIDFcIixcbiAgICAgIH0sXG4gICAgICB7fSxcbiAgICBdKTtcblxuICAgIHJlcmVuZGVyKFxuICAgICAgPE1vdmVQYW5lbFp1c3RhbmQgb25Nb3ZlQ2xpY2s9e29uTW92ZUNsaWNrfSBjdXJyZW50TW92ZUluZGV4PXsyfSAvPixcbiAgICApO1xuXG4gICAgLy8gRklYIFZFUklGSUNBVElPTjogQWZ0ZXIgdGhlIGZpeCwgQUxMIG1vdmVzIHNob3VsZCByZW1haW4gdmlzaWJsZVxuICAgIC8vIHdoZW4gbmF2aWdhdGluZyB0byBhbiBlYXJsaWVyIG1vdmVcblxuICAgIGNvbnNvbGUubG9nKFwiXFxuPT09IEZJWCBWRVJJRklDQVRJT04gPT09XCIpO1xuICAgIGNvbnNvbGUubG9nKFwiQWZ0ZXIgY2xpY2tpbmcgb24gbW92ZSAyIChOZjMpOlwiKTtcbiAgICBjb25zb2xlLmxvZyhcIkV4cGVjdGVkOiBBbGwgNSBtb3ZlcyB2aXNpYmxlIChlNCwgZTUsIE5mMywgTmM2LCBCYzQpXCIpO1xuICAgIGNvbnNvbGUubG9nKFwiV2l0aCBmaXg6IEFsbCBtb3ZlcyBzaG91bGQgbm93IGJlIHZpc2libGUhXCIpO1xuXG4gICAgLy8gVGhlc2UgYXNzZXJ0aW9ucyB2ZXJpZnkgdGhlIGZpeCB3b3JrczpcbiAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGV4dChcImU0XCIpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXh0KFwiZTVcIikpLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRleHQoXCJOZjNcIikpLnRvQmVJblRoZURvY3VtZW50KCk7XG5cbiAgICAvLyBGSVhFRDogVGhlc2UgbW92ZXMgc2hvdWxkIG5vdyBiZSB2aXNpYmxlIVxuICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXh0KFwiTmM2XCIpKS50b0JlSW5UaGVEb2N1bWVudCgpOyAvLyBOb3cgdmlzaWJsZSFcbiAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGV4dChcIkJjNFwiKSkudG9CZUluVGhlRG9jdW1lbnQoKTsgLy8gTm93IHZpc2libGUhXG4gIH0pO1xuXG4gIGl0KFwiRVhQRUNURUQgQkVIQVZJT1I6IFNob3VsZCBkaXNwbGF5IGFsbCBtb3ZlcyB3aXRoIHByb3BlciBoaWdobGlnaHRpbmdcIiwgKCkgPT4ge1xuICAgIGNvbnN0IG1vY2tNb3ZlcyA9IGNyZWF0ZU1vY2tNb3ZlcygpO1xuICAgIGNvbnN0IG9uTW92ZUNsaWNrID0gamVzdC5mbigpO1xuXG4gICAgLy8gVGhpcyB0ZXN0IHNob3dzIHdoYXQgU0hPVUxEIGhhcHBlblxuICAgIG1vY2tVc2VHYW1lU3RvcmUubW9ja1JldHVyblZhbHVlKFtcbiAgICAgIHtcbiAgICAgICAgbW92ZUhpc3Rvcnk6IG1vY2tNb3ZlcyxcbiAgICAgICAgY3VycmVudE1vdmVJbmRleDogMiwgLy8gVmlld2luZyBtb3ZlIDIsIGJ1dCBhbGwgbW92ZXMgaW4gaGlzdG9yeVxuICAgICAgICBjdXJyZW50RmVuOiBcInJuYnFrYm5yL3BwcHBwcHBwLzgvOC84LzgvUFBQUFBQUFAvUk5CUUtCTlIgdyBLUWtxIC0gMCAxXCIsXG4gICAgICB9LFxuICAgICAge30sXG4gICAgXSk7XG5cbiAgICAvLyBJZiB0aGUgYnVnIHdhcyBmaXhlZCwgdGhpcyBpcyB3aGF0IHdlJ2Qgc2VlOlxuICAgIGNvbnNvbGUubG9nKFwiXFxuPT09IEVYUEVDVEVEIEJFSEFWSU9SID09PVwiKTtcbiAgICBjb25zb2xlLmxvZyhcIldoZW4gdmlld2luZyBtb3ZlIDI6XCIpO1xuICAgIGNvbnNvbGUubG9nKFwiLSBBbGwgNSBtb3ZlcyBzaG91bGQgYmUgdmlzaWJsZVwiKTtcbiAgICBjb25zb2xlLmxvZyhcIi0gTW92ZSAzIChOZjMpIHNob3VsZCBiZSBoaWdobGlnaHRlZCBhcyBjdXJyZW50XCIpO1xuICAgIGNvbnNvbGUubG9nKFwiLSBNb3ZlcyA0LTUgKE5jNiwgQmM0KSBzaG91bGQgYXBwZWFyIGdyYXllZCBvdXQgb3IgZGlmZmVyZW50XCIpO1xuICAgIGNvbnNvbGUubG9nKFwiLSBVc2VyIGNhbiBjbGljayBhbnkgbW92ZSB0byBqdW1wIHRoZXJlXCIpO1xuICB9KTtcblxuICBpdChcIlZlcmlmaWVzIHRoZSBhY3R1YWwgZGF0YSBmbG93XCIsICgpID0+IHtcbiAgICBjb25zdCBtb2NrTW92ZXMgPSBjcmVhdGVNb2NrTW92ZXMoKTtcblxuICAgIC8vIExvZyB0aGUgYWN0dWFsIGRhdGEgdG8gdW5kZXJzdGFuZCB0aGUgYnVnXG4gICAgY29uc29sZS5sb2coXCJcXG49PT0gREFUQSBGTE9XIEFOQUxZU0lTID09PVwiKTtcbiAgICBjb25zb2xlLmxvZyhcIjEuIEluaXRpYWwgc3RhdGU6XCIpO1xuICAgIGNvbnNvbGUubG9nKGAgICAtIG1vdmVIaXN0b3J5Lmxlbmd0aDogJHttb2NrTW92ZXMubGVuZ3RofWApO1xuICAgIGNvbnNvbGUubG9nKGAgICAtIGN1cnJlbnRNb3ZlSW5kZXg6IDRgKTtcbiAgICBjb25zb2xlLmxvZyhgICAgLSBBbGwgbW92ZXM6ICR7bW9ja01vdmVzLm1hcCgobSkgPT4gbS5zYW4pLmpvaW4oXCIsIFwiKX1gKTtcblxuICAgIGNvbnNvbGUubG9nKFwiXFxuMi4gQWZ0ZXIgY2xpY2tpbmcgbW92ZSAyOlwiKTtcbiAgICBjb25zb2xlLmxvZyhgICAgLSBtb3ZlSGlzdG9yeS5sZW5ndGg6ICR7bW9ja01vdmVzLmxlbmd0aH0gKHVuY2hhbmdlZClgKTtcbiAgICBjb25zb2xlLmxvZyhgICAgLSBjdXJyZW50TW92ZUluZGV4OiAyIChjaGFuZ2VkKWApO1xuICAgIGNvbnNvbGUubG9nKFxuICAgICAgYCAgIC0gQWxsIG1vdmVzIHN0aWxsIGluIHN0b3JlOiAke21vY2tNb3Zlcy5tYXAoKG0pID0+IG0uc2FuKS5qb2luKFwiLCBcIil9YCxcbiAgICApO1xuXG4gICAgY29uc29sZS5sb2coXCJcXG4zLiBCdWcgaW4gTW92ZVBhbmVsWnVzdGFuZDpcIik7XG4gICAgY29uc29sZS5sb2coXCIgICAtIExpbmUgMTYwLTE2MiBzbGljZXMgbW92ZUhpc3Rvcnk6XCIpO1xuICAgIGNvbnNvbGUubG9nKFwiICAgICBnYW1lU3RhdGUubW92ZUhpc3Rvcnkuc2xpY2UoMCwgY3VycmVudE1vdmVJbmRleCArIDEpXCIpO1xuICAgIGNvbnNvbGUubG9nKGAgICAtIFRoaXMgY3JlYXRlczogc2xpY2UoMCwgMykgPSBmaXJzdCAzIG1vdmVzIG9ubHlgKTtcbiAgICBjb25zb2xlLmxvZyhcIiAgIC0gUmVzdWx0OiBNb3ZlcyA0LTUgZGlzYXBwZWFyIGZyb20gVUkhXCIpO1xuICB9KTtcbn0pO1xuIl0sIm5hbWVzIjpbImplc3QiLCJtb2NrIiwidXNlR2FtZVN0b3JlIiwiZm4iLCJ1c2VUYWJsZWJhc2VTdG9yZSIsInVzZVRyYWluaW5nU3RvcmUiLCJtb2NrVXNlR2FtZVN0b3JlIiwicmVxdWlyZU1vY2siLCJtb2NrVXNlVGFibGViYXNlU3RvcmUiLCJtb2NrVXNlVHJhaW5pbmdTdG9yZSIsImRlc2NyaWJlIiwiY3JlYXRlTW9ja01vdmVzIiwiY3JlYXRlVGVzdFZhbGlkYXRlZE1vdmUiLCJmcm9tIiwidG8iLCJzYW4iLCJjb2xvciIsInBpZWNlIiwiYmVmb3JlRWFjaCIsIm1vY2tSZXR1cm5WYWx1ZSIsImV2YWx1YXRpb25zIiwiY3VycmVudFBvc2l0aW9uIiwiYWZ0ZXJFYWNoIiwiY2xlYXJBbGxNb2NrcyIsIml0IiwibW9ja01vdmVzIiwib25Nb3ZlQ2xpY2siLCJtb3ZlSGlzdG9yeSIsImN1cnJlbnRNb3ZlSW5kZXgiLCJjdXJyZW50RmVuIiwicmVyZW5kZXIiLCJyZW5kZXIiLCJNb3ZlUGFuZWxadXN0YW5kIiwiZXhwZWN0Iiwic2NyZWVuIiwiZ2V0QnlUZXh0IiwidG9CZUluVGhlRG9jdW1lbnQiLCJuZjNCdXR0b24iLCJmaXJlRXZlbnQiLCJjbGljayIsInRvSGF2ZUJlZW5DYWxsZWRXaXRoIiwiY29uc29sZSIsImxvZyIsImxlbmd0aCIsIm1hcCIsIm0iLCJqb2luIl0sIm1hcHBpbmdzIjoiQUFBQTs7OztDQUlDO0FBU0QsdUJBQXVCO0FBQ3ZCQSxLQUFLQyxJQUFJLENBQUMsdUJBQXVCLElBQU8sQ0FBQTtRQUN0Q0MsY0FBY0YsS0FBS0csRUFBRTtRQUNyQkMsbUJBQW1CSixLQUFLRyxFQUFFO1FBQzFCRSxrQkFBa0JMLEtBQUtHLEVBQUU7SUFDM0IsQ0FBQTs7Ozs7OERBWmtCO3dCQUN3QjtrQ0FDVDtzQ0FFTzs7Ozs7O0FBVXhDLE1BQU1HLG1CQUFtQk4sS0FBS08sV0FBVyxDQUFDLHVCQUF1QkwsWUFBWTtBQUM3RSxNQUFNTSx3QkFBd0JSLEtBQUtPLFdBQVcsQ0FDNUMsdUJBQ0FILGlCQUFpQjtBQUNuQixNQUFNSyx1QkFBdUJULEtBQUtPLFdBQVcsQ0FDM0MsdUJBQ0FGLGdCQUFnQjtBQUVsQkssU0FBUywrQkFBK0I7SUFDdEM7O0dBRUMsR0FDRCxNQUFNQyxrQkFBa0IsSUFBdUI7WUFDN0NDLElBQUFBLDZDQUF1QixFQUFDO2dCQUN0QkMsTUFBTTtnQkFDTkMsSUFBSTtnQkFDSkMsS0FBSztnQkFDTEMsT0FBTztnQkFDUEMsT0FBTztZQUNUO1lBQ0FMLElBQUFBLDZDQUF1QixFQUFDO2dCQUN0QkMsTUFBTTtnQkFDTkMsSUFBSTtnQkFDSkMsS0FBSztnQkFDTEMsT0FBTztnQkFDUEMsT0FBTztZQUNUO1lBQ0FMLElBQUFBLDZDQUF1QixFQUFD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