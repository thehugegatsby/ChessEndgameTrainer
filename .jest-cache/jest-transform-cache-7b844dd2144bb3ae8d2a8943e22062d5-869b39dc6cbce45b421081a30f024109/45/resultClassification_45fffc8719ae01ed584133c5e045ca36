8a18325b99457e37d82ea41b1766e6c1
/**
 * @file Tablebase result classification utilities
 * @module utils/tablebase/resultClassification
 *
 * @description
 * Core utilities for classifying and organizing tablebase moves based on DTZ
 * (Distance to Zero) values. Provides a comprehensive suite of functions for
 * categorizing moves into win/draw/loss groups, sorting by quality, and
 * generating UI styling for the Lichess-like tablebase interface.
 *
 * @remarks
 * Key features:
 * - DTZ-based move classification (win/draw/loss)
 * - Move grouping and sorting algorithms
 * - Visual styling utilities (colors, icons, bar widths)
 * - Formatting functions for user-friendly display
 * - Support for both DTZ and WDL evaluation methods
 *
 * The module ensures consistent move categorization throughout the application
 * and provides optimized sorting algorithms for each move category.
 */ /**
 * Move result type classification
 * @typedef {'win' | 'draw' | 'loss'} MoveResultType
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get calculateBarWidth () {
        return calculateBarWidth;
    },
    get classifyMovesByDTZ () {
        return classifyMovesByDTZ;
    },
    get formatDtzDisplay () {
        return formatDtzDisplay;
    },
    get getColorClass () {
        return getColorClass;
    },
    get getEvaluationBarColor () {
        return getEvaluationBarColor;
    },
    get getMoveResultType () {
        return getMoveResultType;
    },
    get getMoveResultTypeFromMove () {
        return getMoveResultTypeFromMove;
    },
    get getMoveResultTypeFromWdl () {
        return getMoveResultTypeFromWdl;
    },
    get getResultIcon () {
        return getResultIcon;
    },
    get getResultTypeTitle () {
        return getResultTypeTitle;
    },
    get groupMovesByResult () {
        return groupMovesByResult;
    },
    get sortMovesByResult () {
        return sortMovesByResult;
    }
});
const getMoveResultType = (dtz)=>{
    if (dtz > 0) return "win";
    if (dtz === 0) return "draw";
    return "loss";
};
const getMoveResultTypeFromMove = (move)=>{
    // Use the category field if available (more reliable)
    if (move.category) {
        return move.category;
    }
    // Fallback to DTZ-based classification
    return getMoveResultType(move.dtz);
};
const getMoveResultTypeFromWdl = (wdl)=>{
    if (wdl > 0) return "win";
    if (wdl === 0) return "draw";
    return "loss";
};
const groupMovesByResult = (moves)=>{
    const grouped = {
        win: [],
        draw: [],
        loss: []
    };
    for (const move of moves){
        const resultType = getMoveResultTypeFromMove(move);
        grouped[resultType].push(move);
    }
    return grouped;
};
const sortMovesByResult = (moves)=>{
    return [
        ...moves
    ].sort((a, b)=>{
        const aType = getMoveResultTypeFromMove(a);
        const bType = getMoveResultTypeFromMove(b);
        // First sort by result type priority: win > draw > loss
        if (aType !== bType) {
            const typeOrder = {
                win: 0,
                draw: 1,
                loss: 2
            };
            return typeOrder[aType] - typeOrder[bType];
        }
        // Within same result type, sort by DTZ value
        if (aType === "win") {
            // Winning moves: ascending DTZ (faster wins first)
            return a.dtz - b.dtz;
        } else if (aType === "draw") {
            // Drawing moves: alphabetical by move notation
            return a.san.localeCompare(b.san);
        } else {
            // Losing moves: descending DTZ (slower losses first)
            return b.dtz - a.dtz;
        }
    });
};
const classifyMovesByDTZ = (moves)=>{
    const grouped = groupMovesByResult(moves);
    return {
        winningMoves: sortMovesByResult(grouped.win),
        drawingMoves: sortMovesByResult(grouped.draw),
        losingMoves: sortMovesByResult(grouped.loss),
        totalMoves: moves.length
    };
};
const getColorClass = (resultType)=>{
    switch(resultType){
        case "win":
            return "text-green-700 bg-green-100 border-green-300";
        case "draw":
            return "text-yellow-700 bg-yellow-100 border-yellow-300";
        case "loss":
            return "text-red-700 bg-red-100 border-red-300";
        default:
            return "text-gray-700 bg-gray-100 border-gray-300";
    }
};
const getEvaluationBarColor = (resultType)=>{
    switch(resultType){
        case "win":
            return "bg-green-500";
        case "draw":
            return "bg-yellow-500";
        case "loss":
            return "bg-red-500";
        default:
            return "bg-gray-500";
    }
};
const getResultIcon = (resultType)=>{
    switch(resultType){
        case "win":
            return "✓";
        case "draw":
            return "=";
        case "loss":
            return "✗";
        default:
            return "?";
    }
};
const calculateBarWidth = (dtz, maxDtz)=>{
    if (maxDtz === 0) return 50; // Default width for draws
    const absDtz = Math.abs(dtz);
    const absMaxDtz = Math.abs(maxDtz);
    if (absMaxDtz === 0) return 50;
    // Calculate width: minimum 20%, maximum 100%
    const baseWidth = absDtz / absMaxDtz * 80 + 20;
    return Math.min(100, Math.max(20, baseWidth));
};
const formatDtzDisplay = (dtz)=>{
    if (dtz === 0) return "Draw";
    if (dtz > 0) return `Win in ${dtz}`;
    return `Loss in ${Math.abs(dtz)}`;
};
const getResultTypeTitle = (resultType)=>{
    switch(resultType){
        case "win":
            return "Winning Moves";
        case "draw":
            return "Drawing Moves";
        case "loss":
            return "Losing Moves";
        default:
            return "Unknown Moves";
    }
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL3RoZWh1L2Nvb2xQcm9qZWN0cy9FbmRnYW1lVHJhaW5lci10cmFpbmluZy1ib2FyZC1jb21wbGV0ZS9zcmMvc2hhcmVkL3V0aWxzL3RhYmxlYmFzZS9yZXN1bHRDbGFzc2lmaWNhdGlvbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIFRhYmxlYmFzZSByZXN1bHQgY2xhc3NpZmljYXRpb24gdXRpbGl0aWVzXG4gKiBAbW9kdWxlIHV0aWxzL3RhYmxlYmFzZS9yZXN1bHRDbGFzc2lmaWNhdGlvblxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogQ29yZSB1dGlsaXRpZXMgZm9yIGNsYXNzaWZ5aW5nIGFuZCBvcmdhbml6aW5nIHRhYmxlYmFzZSBtb3ZlcyBiYXNlZCBvbiBEVFpcbiAqIChEaXN0YW5jZSB0byBaZXJvKSB2YWx1ZXMuIFByb3ZpZGVzIGEgY29tcHJlaGVuc2l2ZSBzdWl0ZSBvZiBmdW5jdGlvbnMgZm9yXG4gKiBjYXRlZ29yaXppbmcgbW92ZXMgaW50byB3aW4vZHJhdy9sb3NzIGdyb3Vwcywgc29ydGluZyBieSBxdWFsaXR5LCBhbmRcbiAqIGdlbmVyYXRpbmcgVUkgc3R5bGluZyBmb3IgdGhlIExpY2hlc3MtbGlrZSB0YWJsZWJhc2UgaW50ZXJmYWNlLlxuICpcbiAqIEByZW1hcmtzXG4gKiBLZXkgZmVhdHVyZXM6XG4gKiAtIERUWi1iYXNlZCBtb3ZlIGNsYXNzaWZpY2F0aW9uICh3aW4vZHJhdy9sb3NzKVxuICogLSBNb3ZlIGdyb3VwaW5nIGFuZCBzb3J0aW5nIGFsZ29yaXRobXNcbiAqIC0gVmlzdWFsIHN0eWxpbmcgdXRpbGl0aWVzIChjb2xvcnMsIGljb25zLCBiYXIgd2lkdGhzKVxuICogLSBGb3JtYXR0aW5nIGZ1bmN0aW9ucyBmb3IgdXNlci1mcmllbmRseSBkaXNwbGF5XG4gKiAtIFN1cHBvcnQgZm9yIGJvdGggRFRaIGFuZCBXREwgZXZhbHVhdGlvbiBtZXRob2RzXG4gKlxuICogVGhlIG1vZHVsZSBlbnN1cmVzIGNvbnNpc3RlbnQgbW92ZSBjYXRlZ29yaXphdGlvbiB0aHJvdWdob3V0IHRoZSBhcHBsaWNhdGlvblxuICogYW5kIHByb3ZpZGVzIG9wdGltaXplZCBzb3J0aW5nIGFsZ29yaXRobXMgZm9yIGVhY2ggbW92ZSBjYXRlZ29yeS5cbiAqL1xuXG4vKipcbiAqIE1vdmUgcmVzdWx0IHR5cGUgY2xhc3NpZmljYXRpb25cbiAqIEB0eXBlZGVmIHsnd2luJyB8ICdkcmF3JyB8ICdsb3NzJ30gTW92ZVJlc3VsdFR5cGVcbiAqL1xuZXhwb3J0IHR5cGUgTW92ZVJlc3VsdFR5cGUgPSBcIndpblwiIHwgXCJkcmF3XCIgfCBcImxvc3NcIjtcblxuLyoqXG4gKiBUYWJsZWJhc2UgbW92ZSBkYXRhIHN0cnVjdHVyZVxuICpcbiAqIEBpbnRlcmZhY2UgVGFibGViYXNlTW92ZVxuICogQGRlc2NyaXB0aW9uXG4gKiBDb21wbGV0ZSBtb3ZlIGluZm9ybWF0aW9uIGZyb20gdGFibGViYXNlIEFQSSBpbmNsdWRpbmcgZXZhbHVhdGlvbiBtZXRyaWNzXG4gKiBhbmQgY2F0ZWdvcml6YXRpb24gZm9yIFVJIGRpc3BsYXkuXG4gKlxuICogQHByb3BlcnR5IHtzdHJpbmd9IG1vdmUgLSBNb3ZlIGluIFVDSSBub3RhdGlvbiAoZS5nLiwgXCJlMmU0XCIpXG4gKiBAcHJvcGVydHkge3N0cmluZ30gc2FuIC0gTW92ZSBpbiBTdGFuZGFyZCBBbGdlYnJhaWMgTm90YXRpb24gKGUuZy4sIFwiZTRcIilcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBkdHogLSBEaXN0YW5jZSB0byBaZXJvIChtb3ZlcyB0byBnYW1lIGVuZClcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBkdG0gLSBEaXN0YW5jZSB0byBNYXRlIChtb3ZlcyB0byBjaGVja21hdGUpXG4gKiBAcHJvcGVydHkge251bWJlcn0gd2RsIC0gV2luL0RyYXcvTG9zcyB2YWx1ZSAoLTEsIDAsIDEpXG4gKiBAcHJvcGVydHkgeyd3aW4nIHwgJ2RyYXcnIHwgJ2xvc3MnfSBjYXRlZ29yeSAtIFByZS1jYWxjdWxhdGVkIHJlc3VsdCBjYXRlZ29yeVxuICovXG5leHBvcnQgaW50ZXJmYWNlIFRhYmxlYmFzZU1vdmUge1xuICBtb3ZlOiBzdHJpbmc7XG4gIHNhbjogc3RyaW5nO1xuICBkdHo6IG51bWJlcjtcbiAgZHRtOiBudW1iZXI7XG4gIHdkbDogbnVtYmVyO1xuICBjYXRlZ29yeTogXCJ3aW5cIiB8IFwiZHJhd1wiIHwgXCJsb3NzXCI7XG59XG5cbi8qKlxuICogTW92ZXMgZ3JvdXBlZCBieSByZXN1bHQgdHlwZVxuICpcbiAqIEBpbnRlcmZhY2UgR3JvdXBlZE1vdmVzXG4gKiBAZGVzY3JpcHRpb25cbiAqIENvbnRhaW5lciBmb3Igb3JnYW5pemluZyBtb3ZlcyBpbnRvIHJlc3VsdCBjYXRlZ29yaWVzIGZvciBlZmZpY2llbnRcbiAqIHJlbmRlcmluZyBhbmQgYW5hbHlzaXMuXG4gKlxuICogQHByb3BlcnR5IHtUYWJsZWJhc2VNb3ZlW119IHdpbiAtIEFycmF5IG9mIHdpbm5pbmcgbW92ZXNcbiAqIEBwcm9wZXJ0eSB7VGFibGViYXNlTW92ZVtdfSBkcmF3IC0gQXJyYXkgb2YgZHJhd2luZyBtb3Zlc1xuICogQHByb3BlcnR5IHtUYWJsZWJhc2VNb3ZlW119IGxvc3MgLSBBcnJheSBvZiBsb3NpbmcgbW92ZXNcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBHcm91cGVkTW92ZXMge1xuICB3aW46IFRhYmxlYmFzZU1vdmVbXTtcbiAgZHJhdzogVGFibGViYXNlTW92ZVtdO1xuICBsb3NzOiBUYWJsZWJhc2VNb3ZlW107XG59XG5cbi8qKlxuICogQ2F0ZWdvcml6ZWQgYW5kIHNvcnRlZCBtb3ZlcyB3aXRoIHN0YXRpc3RpY3NcbiAqXG4gKiBAaW50ZXJmYWNlIENhdGVnb3JpemVkTW92ZXNcbiAqIEBkZXNjcmlwdGlvblxuICogRmluYWwgY2F0ZWdvcml6YXRpb24gcmVzdWx0IHdpdGggc29ydGVkIG1vdmVzIGFuZCBhZ2dyZWdhdGUgc3RhdGlzdGljcy5cbiAqIFVzZWQgYXMgdGhlIHByaW1hcnkgZGF0YSBzdHJ1Y3R1cmUgZm9yIFVJIGNvbXBvbmVudHMuXG4gKlxuICogQHByb3BlcnR5IHtUYWJsZWJhc2VNb3ZlW119IHdpbm5pbmdNb3ZlcyAtIFNvcnRlZCBhcnJheSBvZiB3aW5uaW5nIG1vdmVzXG4gKiBAcHJvcGVydHkge1RhYmxlYmFzZU1vdmVbXX0gZHJhd2luZ01vdmVzIC0gU29ydGVkIGFycmF5IG9mIGRyYXdpbmcgbW92ZXNcbiAqIEBwcm9wZXJ0eSB7VGFibGViYXNlTW92ZVtdfSBsb3NpbmdNb3ZlcyAtIFNvcnRlZCBhcnJheSBvZiBsb3NpbmcgbW92ZXNcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB0b3RhbE1vdmVzIC0gVG90YWwgY291bnQgb2YgYWxsIG1vdmVzXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQ2F0ZWdvcml6ZWRNb3ZlcyB7XG4gIHdpbm5pbmdNb3ZlczogVGFibGViYXNlTW92ZVtdO1xuICBkcmF3aW5nTW92ZXM6IFRhYmxlYmFzZU1vdmVbXTtcbiAgbG9zaW5nTW92ZXM6IFRhYmxlYmFzZU1vdmVbXTtcbiAgdG90YWxNb3ZlczogbnVtYmVyO1xufVxuXG4vKipcbiAqIERldGVybWluZXMgdGhlIHJlc3VsdCB0eXBlIG9mIGEgbW92ZSBiYXNlZCBvbiBpdHMgRFRaIHZhbHVlXG4gKlxuICogQGZ1bmN0aW9uIGdldE1vdmVSZXN1bHRUeXBlXG4gKiBAcGFyYW0ge251bWJlcn0gZHR6IC0gRGlzdGFuY2UgdG8gWmVybyB2YWx1ZSBmcm9tIHRhYmxlYmFzZVxuICogQHJldHVybnMge01vdmVSZXN1bHRUeXBlfSBNb3ZlIHJlc3VsdCB0eXBlOiAnd2luJywgJ2RyYXcnLCBvciAnbG9zcydcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIENvcmUgY2xhc3NpZmljYXRpb24gZnVuY3Rpb24gdXNpbmcgRFRaIHZhbHVlczpcbiAqIC0gUG9zaXRpdmUgRFRaOiBXaW5uaW5nIG1vdmUgKHBsYXllciBhY2hpZXZlcyBmYXZvcmFibGUgb3V0Y29tZSlcbiAqIC0gWmVybyBEVFo6IERyYXdpbmcgbW92ZSAoZ2FtZSByZW1haW5zIGJhbGFuY2VkKVxuICogLSBOZWdhdGl2ZSBEVFo6IExvc2luZyBtb3ZlIChvcHBvbmVudCBhY2hpZXZlcyBmYXZvcmFibGUgb3V0Y29tZSlcbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgdHlwZXNjcmlwdFxuICogZ2V0TW92ZVJlc3VsdFR5cGUoMTUpOyAgLy8gJ3dpbidcbiAqIGdldE1vdmVSZXN1bHRUeXBlKDApOyAgIC8vICdkcmF3J1xuICogZ2V0TW92ZVJlc3VsdFR5cGUoLTIwKTsgLy8gJ2xvc3MnXG4gKiBgYGBcbiAqL1xuZXhwb3J0IGNvbnN0IGdldE1vdmVSZXN1bHRUeXBlID0gKGR0ejogbnVtYmVyKTogTW92ZVJlc3VsdFR5cGUgPT4ge1xuICBpZiAoZHR6ID4gMCkgcmV0dXJuIFwid2luXCI7XG4gIGlmIChkdHogPT09IDApIHJldHVybiBcImRyYXdcIjtcbiAgcmV0dXJuIFwibG9zc1wiO1xufTtcblxuLyoqXG4gKiBEZXRlcm1pbmVzIHRoZSByZXN1bHQgdHlwZSBvZiBhIG1vdmUgYmFzZWQgb24gaXRzIFRhYmxlYmFzZU1vdmUgZGF0YVxuICpcbiAqIEBmdW5jdGlvbiBnZXRNb3ZlUmVzdWx0VHlwZUZyb21Nb3ZlXG4gKiBAcGFyYW0ge1RhYmxlYmFzZU1vdmV9IG1vdmUgLSBUYWJsZWJhc2VNb3ZlIG9iamVjdFxuICogQHJldHVybnMge01vdmVSZXN1bHRUeXBlfSBNb3ZlIHJlc3VsdCB0eXBlOiAnd2luJywgJ2RyYXcnLCBvciAnbG9zcydcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIEVuaGFuY2VkIGNsYXNzaWZpY2F0aW9uIHRoYXQgcHJpb3JpdGl6ZXMgdGhlIHByZS1jYWxjdWxhdGVkIGNhdGVnb3J5IGZpZWxkXG4gKiBpZiBhdmFpbGFibGUgKG1vcmUgcmVsaWFibGUgZnJvbSBBUEkpLCBvdGhlcndpc2UgZmFsbHMgYmFjayB0byBEVFotYmFzZWRcbiAqIGNsYXNzaWZpY2F0aW9uLiBUaGlzIHR3by10aWVyIGFwcHJvYWNoIGVuc3VyZXMgYWNjdXJhY3kgZXZlbiB3aXRoXG4gKiBpbmNvbXBsZXRlIEFQSSByZXNwb25zZXMuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYHR5cGVzY3JpcHRcbiAqIGNvbnN0IG1vdmUgPSB7IHNhbjogJ0tlMicsIGR0ejogMTAsIGNhdGVnb3J5OiAnd2luJywgLi4uIH07XG4gKiBnZXRNb3ZlUmVzdWx0VHlwZUZyb21Nb3ZlKG1vdmUpOyAvLyAnd2luJyAodXNlcyBjYXRlZ29yeSlcbiAqIGBgYFxuICovXG5leHBvcnQgY29uc3QgZ2V0TW92ZVJlc3VsdFR5cGVGcm9tTW92ZSA9IChcbiAgbW92ZTogVGFibGViYXNlTW92ZSxcbik6IE1vdmVSZXN1bHRUeXBlID0+IHtcbiAgLy8gVXNlIHRoZSBjYXRlZ29yeSBmaWVsZCBpZiBhdmFpbGFibGUgKG1vcmUgcmVsaWFibGUpXG4gIGlmIChtb3ZlLmNhdGVnb3J5KSB7XG4gICAgcmV0dXJuIG1vdmUuY2F0ZWdvcnk7XG4gIH1cblxuICAvLyBGYWxsYmFjayB0byBEVFotYmFzZWQgY2xhc3NpZmljYXRpb25cbiAgcmV0dXJuIGdldE1vdmVSZXN1bHRUeXBlKG1vdmUuZHR6KTtcbn07XG5cbi8qKlxuICogRGV0ZXJtaW5lcyB0aGUgcmVzdWx0IHR5cGUgYmFzZWQgb24gV0RMIHZhbHVlIChhbHRlcm5hdGl2ZSBtZXRob2QpXG4gKlxuICogQGZ1bmN0aW9uIGdldE1vdmVSZXN1bHRUeXBlRnJvbVdkbFxuICogQHBhcmFtIHtudW1iZXJ9IHdkbCAtIFdpbi9EcmF3L0xvc3MgdmFsdWUgZnJvbSB0YWJsZWJhc2VcbiAqIEByZXR1cm5zIHtNb3ZlUmVzdWx0VHlwZX0gTW92ZSByZXN1bHQgdHlwZTogJ3dpbicsICdkcmF3Jywgb3IgJ2xvc3MnXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBBbHRlcm5hdGl2ZSBjbGFzc2lmaWNhdGlvbiB1c2luZyBXREwgKFdpbi9EcmF3L0xvc3MpIHZhbHVlczpcbiAqIC0gUG9zaXRpdmUgV0RMICgxKTogV2luIGZvciB0aGUgcGxheWVyIHRvIG1vdmVcbiAqIC0gWmVybyBXREwgKDApOiBEcmF3IHdpdGggYmVzdCBwbGF5XG4gKiAtIE5lZ2F0aXZlIFdETCAoLTEpOiBMb3NzIGZvciB0aGUgcGxheWVyIHRvIG1vdmVcbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgdHlwZXNjcmlwdFxuICogZ2V0TW92ZVJlc3VsdFR5cGVGcm9tV2RsKDEpOyAgIC8vICd3aW4nXG4gKiBnZXRNb3ZlUmVzdWx0VHlwZUZyb21XZGwoMCk7ICAgLy8gJ2RyYXcnXG4gKiBnZXRNb3ZlUmVzdWx0VHlwZUZyb21XZGwoLTEpOyAgLy8gJ2xvc3MnXG4gKiBgYGBcbiAqL1xuZXhwb3J0IGNvbnN0IGdldE1vdmVSZXN1bHRUeXBlRnJvbVdkbCA9ICh3ZGw6IG51bWJlcik6IE1vdmVSZXN1bHRUeXBlID0+IHtcbiAgaWYgKHdkbCA+IDApIHJldHVybiBcIndpblwiO1xuICBpZiAod2RsID09PSAwKSByZXR1cm4gXCJkcmF3XCI7XG4gIHJldHVybiBcImxvc3NcIjtcbn07XG5cbi8qKlxuICogR3JvdXBzIG1vdmVzIGJ5IHRoZWlyIHJlc3VsdCB0eXBlIGZvciBvcmdhbml6ZWQgZGlzcGxheVxuICpcbiAqIEBmdW5jdGlvbiBncm91cE1vdmVzQnlSZXN1bHRcbiAqIEBwYXJhbSB7VGFibGViYXNlTW92ZVtdfSBtb3ZlcyAtIEFycmF5IG9mIHRhYmxlYmFzZSBtb3ZlcyB0byBncm91cFxuICogQHJldHVybnMge0dyb3VwZWRNb3Zlc30gTW92ZXMgb3JnYW5pemVkIGludG8gd2luL2RyYXcvbG9zcyBjYXRlZ29yaWVzXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBFZmZpY2llbnRseSBjYXRlZ29yaXplcyBhbiBhcnJheSBvZiBtb3ZlcyBpbnRvIHRocmVlIGdyb3VwcyBiYXNlZCBvblxuICogdGhlaXIgcmVzdWx0IHR5cGUuIFVzZXMgdGhlIHJlbGlhYmxlIGdldE1vdmVSZXN1bHRUeXBlRnJvbU1vdmUgZnVuY3Rpb25cbiAqIHRvIGVuc3VyZSBhY2N1cmF0ZSBjYXRlZ29yaXphdGlvbiBldmVuIHdpdGggbWl4ZWQgZGF0YSBzb3VyY2VzLlxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGB0eXBlc2NyaXB0XG4gKiBjb25zdCBtb3ZlcyA9IFtcbiAqICAgeyBzYW46ICdLZTInLCBkdHo6IDEwLCBjYXRlZ29yeTogJ3dpbicsIC4uLiB9LFxuICogICB7IHNhbjogJ0tkMicsIGR0ejogMCwgY2F0ZWdvcnk6ICdkcmF3JywgLi4uIH0sXG4gKiAgIHsgc2FuOiAnS2MyJywgZHR6OiAtMTUsIGNhdGVnb3J5OiAnbG9zcycsIC4uLiB9XG4gKiBdO1xuICogY29uc3QgZ3JvdXBlZCA9IGdyb3VwTW92ZXNCeVJlc3VsdChtb3Zlcyk7XG4gKiAvLyBncm91cGVkLndpbiA9IFt7IHNhbjogJ0tlMicsIC4uLiB9XVxuICogLy8gZ3JvdXBlZC5kcmF3ID0gW3sgc2FuOiAnS2QyJywgLi4uIH1dXG4gKiAvLyBncm91cGVkLmxvc3MgPSBbeyBzYW46ICdLYzInLCAuLi4gfV1cbiAqIGBgYFxuICovXG5leHBvcnQgY29uc3QgZ3JvdXBNb3Zlc0J5UmVzdWx0ID0gKG1vdmVzOiBUYWJsZWJhc2VNb3ZlW10pOiBHcm91cGVkTW92ZXMgPT4ge1xuICBjb25zdCBncm91cGVkOiBHcm91cGVkTW92ZXMgPSB7XG4gICAgd2luOiBbXSxcbiAgICBkcmF3OiBbXSxcbiAgICBsb3NzOiBbXSxcbiAgfTtcblxuICBmb3IgKGNvbnN0IG1vdmUgb2YgbW92ZXMpIHtcbiAgICBjb25zdCByZXN1bHRUeXBlID0gZ2V0TW92ZVJlc3VsdFR5cGVGcm9tTW92ZShtb3ZlKTtcbiAgICBncm91cGVkW3Jlc3VsdFR5cGVdLnB1c2gobW92ZSk7XG4gIH1cblxuICByZXR1cm4gZ3JvdXBlZDtcbn07XG5cbi8qKlxuICogU29ydHMgbW92ZXMgd2l0aGluIGVhY2ggcmVzdWx0IGNhdGVnb3J5IGJ5IERUWiB2YWx1ZVxuICpcbiAqIEBmdW5jdGlvbiBzb3J0TW92ZXNCeVJlc3VsdFxuICogQHBhcmFtIHtUYWJsZWJhc2VNb3ZlW119IG1vdmVzIC0gQXJyYXkgb2YgdGFibGViYXNlIG1vdmVzIHRvIHNvcnRcbiAqIEByZXR1cm5zIHtUYWJsZWJhc2VNb3ZlW119IFNvcnRlZCBhcnJheSBtYWludGFpbmluZyByZXN1bHQgdHlwZSBncm91cGluZ1xuICpcbiAqIEBkZXNjcmlwdGlvblxuICogQXBwbGllcyBpbnRlbGxpZ2VudCBzb3J0aW5nIGJhc2VkIG9uIHJlc3VsdCB0eXBlOlxuICogLSBXaW5uaW5nIG1vdmVzOiBBc2NlbmRpbmcgRFRaIChmYXN0ZXN0IHdpbnMgZmlyc3QpIC0gaGVscHMgZmluZCBxdWlja2VzdCBwYXRoIHRvIHZpY3RvcnlcbiAqIC0gRHJhd2luZyBtb3ZlczogQWxwaGFiZXRpY2FsIGJ5IFNBTiBub3RhdGlvbiAtIHByb3ZpZGVzIGNvbnNpc3RlbnQgb3JkZXJpbmdcbiAqIC0gTG9zaW5nIG1vdmVzOiBEZXNjZW5kaW5nIERUWiAoc2xvd2VzdCBsb3NzZXMgZmlyc3QpIC0gcHJpb3JpdGl6ZXMgc3R1YmJvcm4gZGVmZW5zZVxuICpcbiAqIFJlc3VsdCB0eXBlcyBhcmUgb3JkZXJlZDogd2lucyDihpIgZHJhd3Mg4oaSIGxvc3Nlc1xuICpcbiAqIEBleGFtcGxlXG4gKiBgYGB0eXBlc2NyaXB0XG4gKiBjb25zdCBtb3ZlcyA9IFtcbiAqICAgeyBzYW46ICdLYjEnLCBkdHo6IC0xMCwgY2F0ZWdvcnk6ICdsb3NzJywgLi4uIH0sXG4gKiAgIHsgc2FuOiAnS2ExJywgZHR6OiA1LCBjYXRlZ29yeTogJ3dpbicsIC4uLiB9LFxuICogICB7IHNhbjogJ0tjMScsIGR0ejogMTUsIGNhdGVnb3J5OiAnd2luJywgLi4uIH1cbiAqIF07XG4gKiBjb25zdCBzb3J0ZWQgPSBzb3J0TW92ZXNCeVJlc3VsdChtb3Zlcyk7XG4gKiAvLyBSZXN1bHQ6IEthMSAod2luLCBkdHo9NSksIEtjMSAod2luLCBkdHo9MTUpLCBLYjEgKGxvc3MsIGR0ej0tMTApXG4gKiBgYGBcbiAqXG4gKiBAcmVtYXJrc1xuICogVGhlIHNvcnRpbmcgc3RyYXRlZ3kgb3B0aW1pemVzIGZvciBwcmFjdGljYWwgcGxheTpcbiAqIC0gUGxheWVycyB3YW50IHRoZSBmYXN0ZXN0IHdpbnNcbiAqIC0gSW4gbG9zaW5nIHBvc2l0aW9ucywgdGhleSB3YW50IHRoZSBtb3N0IHJlc2lsaWVudCBkZWZlbnNlXG4gKiAtIERyYXdpbmcgbW92ZXMgYXJlIHNvcnRlZCBhbHBoYWJldGljYWxseSBmb3IgcHJlZGljdGFiaWxpdHlcbiAqL1xuZXhwb3J0IGNvbnN0IHNvcnRNb3Zlc0J5UmVzdWx0ID0gKG1vdmVzOiBUYWJsZWJhc2VNb3ZlW10pOiBUYWJsZWJhc2VNb3ZlW10gPT4ge1xuICByZXR1cm4gWy4uLm1vdmVzXS5zb3J0KChhLCBiKSA9PiB7XG4gICAgY29uc3QgYVR5cGUgPSBnZXRNb3ZlUmVzdWx0VHlwZUZyb21Nb3ZlKGEpO1xuICAgIGNvbnN0IGJUeXBlID0gZ2V0TW92ZVJlc3VsdFR5cGVGcm9tTW92ZShiKTtcblxuICAgIC8vIEZpcnN0IHNvcnQgYnkgcmVzdWx0IHR5cGUgcHJpb3JpdHk6IHdpbiA+IGRyYXcgPiBsb3NzXG4gICAgaWYgKGFUeXBlICE9PSBiVHlwZSkge1xuICAgICAgY29uc3QgdHlwZU9yZGVyID0geyB3aW46IDAsIGRyYXc6IDEsIGxvc3M6IDIgfTtcbiAgICAgIHJldHVybiB0eXBlT3JkZXJbYVR5cGVdIC0gdHlwZU9yZGVyW2JUeXBlXTtcbiAgICB9XG5cbiAgICAvLyBXaXRoaW4gc2FtZSByZXN1bHQgdHlwZSwgc29ydCBieSBEVFogdmFsdWVcbiAgICBpZiAoYVR5cGUgPT09IFwid2luXCIpIHtcbiAgICAgIC8vIFdpbm5pbmcgbW92ZXM6IGFzY2VuZGluZyBEVFogKGZhc3RlciB3aW5zIGZpcnN0KVxuICAgICAgcmV0dXJuIGEuZHR6IC0gYi5kdHo7XG4gICAgfSBlbHNlIGlmIChhVHlwZSA9PT0gXCJkcmF3XCIpIHtcbiAgICAgIC8vIERyYXdpbmcgbW92ZXM6IGFscGhhYmV0aWNhbCBieSBtb3ZlIG5vdGF0aW9uXG4gICAgICByZXR1cm4gYS5zYW4ubG9jYWxlQ29tcGFyZShiLnNhbik7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIExvc2luZyBtb3ZlczogZGVzY2VuZGluZyBEVFogKHNsb3dlciBsb3NzZXMgZmlyc3QpXG4gICAgICByZXR1cm4gYi5kdHogLSBhLmR0ejtcbiAgICB9XG4gIH0pO1xufTtcblxuLyoqXG4gKiBDbGFzc2lmaWVzIG1vdmVzIGJ5IERUWiB2YWx1ZXMgd2l0aCBkZXRhaWxlZCBjYXRlZ29yaXphdGlvblxuICpcbiAqIEBmdW5jdGlvbiBjbGFzc2lmeU1vdmVzQnlEVFpcbiAqIEBwYXJhbSB7VGFibGViYXNlTW92ZVtdfSBtb3ZlcyAtIEFycmF5IG9mIHRhYmxlYmFzZSBtb3ZlcyB0byBjbGFzc2lmeVxuICogQHJldHVybnMge0NhdGVnb3JpemVkTW92ZXN9IEZ1bGx5IGNhdGVnb3JpemVkIGFuZCBzb3J0ZWQgbW92ZXMgd2l0aCBzdGF0aXN0aWNzXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBIaWdoLWxldmVsIGZ1bmN0aW9uIHRoYXQgY29tYmluZXMgZ3JvdXBpbmcgYW5kIHNvcnRpbmcgdG8gcHJvZHVjZSBhXG4gKiBjb21wbGV0ZSBjbGFzc2lmaWNhdGlvbiBzdWl0YWJsZSBmb3IgVUkgY29uc3VtcHRpb24uIFRoaXMgaXMgdGhlIHByaW1hcnlcbiAqIGVudHJ5IHBvaW50IGZvciBtb3ZlIG9yZ2FuaXphdGlvbiBpbiB0aGUgdGFibGViYXNlIGludGVyZmFjZS5cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgdHlwZXNjcmlwdFxuICogaW1wb3J0IHsgZ2V0TG9nZ2VyIH0gZnJvbSAnQHNoYXJlZC9zZXJ2aWNlcy9sb2dnaW5nL0xvZ2dlcic7XG4gKiBjb25zdCBsb2dnZXIgPSBnZXRMb2dnZXIoKTtcbiAqIGNvbnN0IG1vdmVzID0gZ2V0VGFibGViYXNlTW92ZXMocG9zaXRpb24pO1xuICogY29uc3QgY2xhc3NpZmllZCA9IGNsYXNzaWZ5TW92ZXNCeURUWihtb3Zlcyk7XG4gKlxuICogbG9nZ2VyLmluZm8oYFRvdGFsIG1vdmVzOiAke2NsYXNzaWZpZWQudG90YWxNb3Zlc31gKTtcbiAqIGxvZ2dlci5pbmZvKGBXaW5uaW5nOiAke2NsYXNzaWZpZWQud2lubmluZ01vdmVzLmxlbmd0aH1gKTtcbiAqIGxvZ2dlci5pbmZvKGBEcmF3aW5nOiAke2NsYXNzaWZpZWQuZHJhd2luZ01vdmVzLmxlbmd0aH1gKTtcbiAqIGxvZ2dlci5pbmZvKGBMb3Npbmc6ICR7Y2xhc3NpZmllZC5sb3NpbmdNb3Zlcy5sZW5ndGh9YCk7XG4gKiBgYGBcbiAqXG4gKiBAcmVtYXJrc1xuICogVGhlIGZ1bmN0aW9uIGVuc3VyZXM6XG4gKiAtIEFsbCBtb3ZlcyBhcmUgY2F0ZWdvcml6ZWQgaW50byBleGFjdGx5IG9uZSBncm91cFxuICogLSBFYWNoIGdyb3VwIGlzIG9wdGltYWxseSBzb3J0ZWQgZm9yIGdhbWVwbGF5XG4gKiAtIFRvdGFsIG1vdmUgY291bnQgaXMgcHJlc2VydmVkIGZvciB2YWxpZGF0aW9uXG4gKi9cbmV4cG9ydCBjb25zdCBjbGFzc2lmeU1vdmVzQnlEVFogPSAoXG4gIG1vdmVzOiBUYWJsZWJhc2VNb3ZlW10sXG4pOiBDYXRlZ29yaXplZE1vdmVzID0+IHtcbiAgY29uc3QgZ3JvdXBlZCA9IGdyb3VwTW92ZXNCeVJlc3VsdChtb3Zlcyk7XG5cbiAgcmV0dXJuIHtcbiAgICB3aW5uaW5nTW92ZXM6IHNvcnRNb3Zlc0J5UmVzdWx0KGdyb3VwZWQud2luKSxcbiAgICBkcmF3aW5nTW92ZXM6IHNvcnRNb3Zlc0J5UmVzdWx0KGdyb3VwZWQuZHJhdyksXG4gICAgbG9zaW5nTW92ZXM6IHNvcnRNb3Zlc0J5UmVzdWx0KGdyb3VwZWQubG9zcyksXG4gICAgdG90YWxNb3ZlczogbW92ZXMubGVuZ3RoLFxuICB9O1xufTtcblxuLyoqXG4gKiBHZXRzIHRoZSBjb2xvciBjbGFzcyBmb3IgYSBtb3ZlIGJhc2VkIG9uIGl0cyByZXN1bHQgdHlwZVxuICpcbiAqIEBmdW5jdGlvbiBnZXRDb2xvckNsYXNzXG4gKiBAcGFyYW0ge01vdmVSZXN1bHRUeXBlfSByZXN1bHRUeXBlIC0gVGhlIG1vdmUgcmVzdWx0IHR5cGVcbiAqIEByZXR1cm5zIHtzdHJpbmd9IFRhaWx3aW5kIENTUyBjbGFzc2VzIGZvciBjb21wbGV0ZSBzdHlsaW5nXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBQcm92aWRlcyBjb21wcmVoZW5zaXZlIHN0eWxpbmcgY2xhc3NlcyBpbmNsdWRpbmcgdGV4dCBjb2xvciwgYmFja2dyb3VuZCxcbiAqIGFuZCBib3JkZXIgZm9yIGNvbnNpc3RlbnQgdmlzdWFsIHJlcHJlc2VudGF0aW9uIGFjcm9zcyB0aGUgVUkuXG4gKiBDb2xvcnMgZm9sbG93IGNoZXNzIGNvbnZlbnRpb246IGdyZWVuPWdvb2QsIHllbGxvdz1uZXV0cmFsLCByZWQ9YmFkLlxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGB0eXBlc2NyaXB0XG4gKiBnZXRDb2xvckNsYXNzKCd3aW4nKTtcbiAqIC8vIFJldHVybnM6ICd0ZXh0LWdyZWVuLTcwMCBiZy1ncmVlbi0xMDAgYm9yZGVyLWdyZWVuLTMwMCdcbiAqIGBgYFxuICpcbiAqIEByZW1hcmtzXG4gKiBSZXR1cm5zIGNvbWJpbmVkIGNsYXNzZXMgZm9yOlxuICogLSBUZXh0IGNvbG9yIChkYXJrZXIgc2hhZGUgZm9yIGNvbnRyYXN0KVxuICogLSBCYWNrZ3JvdW5kIGNvbG9yIChsaWdodCB0aW50KVxuICogLSBCb3JkZXIgY29sb3IgKG1lZGl1bSBzaGFkZSlcbiAqL1xuZXhwb3J0IGNvbnN0IGdldENvbG9yQ2xhc3MgPSAocmVzdWx0VHlwZTogTW92ZVJlc3VsdFR5cGUpOiBzdHJpbmcgPT4ge1xuICBzd2l0Y2ggKHJlc3VsdFR5cGUpIHtcbiAgICBjYXNlIFwid2luXCI6XG4gICAgICByZXR1cm4gXCJ0ZXh0LWdyZWVuLTcwMCBiZy1ncmVlbi0xMDAgYm9yZGVyLWdyZWVuLTMwMFwiO1xuICAgIGNhc2UgXCJkcmF3XCI6XG4gICAgICByZXR1cm4gXCJ0ZXh0LXllbGxvdy03MDAgYmcteWVsbG93LTEwMCBib3JkZXIteWVsbG93LTMwMFwiO1xuICAgIGNhc2UgXCJsb3NzXCI6XG4gICAgICByZXR1cm4gXCJ0ZXh0LXJlZC03MDAgYmctcmVkLTEwMCBib3JkZXItcmVkLTMwMFwiO1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gXCJ0ZXh0LWdyYXktNzAwIGJnLWdyYXktMTAwIGJvcmRlci1ncmF5LTMwMFwiO1xuICB9XG59O1xuXG4vKipcbiAqIEdldHMgdGhlIGJhY2tncm91bmQgY29sb3IgY2xhc3MgZm9yIGV2YWx1YXRpb24gYmFyc1xuICpcbiAqIEBmdW5jdGlvbiBnZXRFdmFsdWF0aW9uQmFyQ29sb3JcbiAqIEBwYXJhbSB7TW92ZVJlc3VsdFR5cGV9IHJlc3VsdFR5cGUgLSBUaGUgbW92ZSByZXN1bHQgdHlwZVxuICogQHJldHVybnMge3N0cmluZ30gVGFpbHdpbmQgQ1NTIGNsYXNzIGZvciBiYXIgYmFja2dyb3VuZFxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogUHJvdmlkZXMgc29saWQgYmFja2dyb3VuZCBjb2xvcnMgZm9yIGV2YWx1YXRpb24gYmFyIHZpc3VhbGl6YXRpb25zLlxuICogVXNlcyBtb3JlIHNhdHVyYXRlZCBjb2xvcnMgdGhhbiBnZXRDb2xvckNsYXNzIGZvciBiZXR0ZXIgdmlzdWFsIGltcGFjdFxuICogaW4gcHJvZ3Jlc3MgYmFyIGNvbnRleHRzLlxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGB0eXBlc2NyaXB0XG4gKiA8ZGl2IGNsYXNzTmFtZT17Z2V0RXZhbHVhdGlvbkJhckNvbG9yKCd3aW4nKX0gc3R5bGU9e3t3aWR0aDogJzc1JSd9fSAvPlxuICogLy8gQ3JlYXRlcyBhIGdyZWVuIGJhciBhdCA3NSUgd2lkdGhcbiAqIGBgYFxuICovXG5leHBvcnQgY29uc3QgZ2V0RXZhbHVhdGlvbkJhckNvbG9yID0gKHJlc3VsdFR5cGU6IE1vdmVSZXN1bHRUeXBlKTogc3RyaW5nID0+IHtcbiAgc3dpdGNoIChyZXN1bHRUeXBlKSB7XG4gICAgY2FzZSBcIndpblwiOlxuICAgICAgcmV0dXJuIFwiYmctZ3JlZW4tNTAwXCI7XG4gICAgY2FzZSBcImRyYXdcIjpcbiAgICAgIHJldHVybiBcImJnLXllbGxvdy01MDBcIjtcbiAgICBjYXNlIFwibG9zc1wiOlxuICAgICAgcmV0dXJuIFwiYmctcmVkLTUwMFwiO1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gXCJiZy1ncmF5LTUwMFwiO1xuICB9XG59O1xuXG4vKipcbiAqIEdldHMgdGhlIGljb24gZm9yIGEgbW92ZSByZXN1bHQgdHlwZVxuICpcbiAqIEBmdW5jdGlvbiBnZXRSZXN1bHRJY29uXG4gKiBAcGFyYW0ge01vdmVSZXN1bHRUeXBlfSByZXN1bHRUeXBlIC0gVGhlIG1vdmUgcmVzdWx0IHR5cGVcbiAqIEByZXR1cm5zIHtzdHJpbmd9IFVuaWNvZGUgaWNvbiBjaGFyYWN0ZXJcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIFJldHVybnMgc2ltcGxlLCB1bml2ZXJzYWxseSByZWNvZ25pemVkIHN5bWJvbHMgZm9yIGVhY2ggcmVzdWx0IHR5cGUuXG4gKiBUaGVzZSBpY29ucyB3b3JrIGFjcm9zcyBhbGwgcGxhdGZvcm1zIHdpdGhvdXQgcmVxdWlyaW5nIGljb24gZm9udHMuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYHR5cGVzY3JpcHRcbiAqIGdldFJlc3VsdEljb24oJ3dpbicpOyAgIC8vICfinJMnIChjaGVja21hcmspXG4gKiBnZXRSZXN1bHRJY29uKCdkcmF3Jyk7ICAvLyAnPScgKGVxdWFscylcbiAqIGdldFJlc3VsdEljb24oJ2xvc3MnKTsgIC8vICfinJcnIChjcm9zcylcbiAqIGBgYFxuICpcbiAqIEByZW1hcmtzXG4gKiBJY29ucyBjaG9zZW4gZm9yIGNsYXJpdHk6XG4gKiAtIOKckyAoVSsyNzEzKTogVW5pdmVyc2FsIHN5bWJvbCBmb3Igc3VjY2Vzcy93aW5cbiAqIC0gPSAoVSswMDNEKTogTWF0aGVtYXRpY2FsIHN5bWJvbCBmb3IgZXF1YWxpdHkvZHJhd1xuICogLSDinJcgKFUrMjcxNyk6IENsZWFyIHN5bWJvbCBmb3IgZmFpbHVyZS9sb3NzXG4gKiAtID8gKFUrMDAzRik6IFF1ZXN0aW9uIG1hcmsgZm9yIHVua25vd24gc3RhdGVzXG4gKi9cbmV4cG9ydCBjb25zdCBnZXRSZXN1bHRJY29uID0gKHJlc3VsdFR5cGU6IE1vdmVSZXN1bHRUeXBlKTogc3RyaW5nID0+IHtcbiAgc3dpdGNoIChyZXN1bHRUeXBlKSB7XG4gICAgY2FzZSBcIndpblwiOlxuICAgICAgcmV0dXJuIFwi4pyTXCI7XG4gICAgY2FzZSBcImRyYXdcIjpcbiAgICAgIHJldHVybiBcIj1cIjtcbiAgICBjYXNlIFwibG9zc1wiOlxuICAgICAgcmV0dXJuIFwi4pyXXCI7XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBcIj9cIjtcbiAgfVxufTtcblxuLyoqXG4gKiBDYWxjdWxhdGVzIHRoZSBldmFsdWF0aW9uIGJhciB3aWR0aCBiYXNlZCBvbiBEVFogdmFsdWVcbiAqXG4gKiBAZnVuY3Rpb24gY2FsY3VsYXRlQmFyV2lkdGhcbiAqIEBwYXJhbSB7bnVtYmVyfSBkdHogLSBEaXN0YW5jZSB0byBaZXJvIHZhbHVlIGZvciB0aGUgbW92ZVxuICogQHBhcmFtIHtudW1iZXJ9IG1heER0eiAtIE1heGltdW0gRFRaIHZhbHVlIGluIHRoZSBjdXJyZW50IHNldCBmb3Igbm9ybWFsaXphdGlvblxuICogQHJldHVybnMge251bWJlcn0gV2lkdGggcGVyY2VudGFnZSAoMjAtMTAwKVxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogTm9ybWFsaXplcyBEVFogdmFsdWVzIHRvIGNyZWF0ZSBwcm9wb3J0aW9uYWwgYmFyIHdpZHRocyBmb3IgdmlzdWFsXG4gKiBjb21wYXJpc29uLiBFbnN1cmVzIG1pbmltdW0gdmlzaWJpbGl0eSAoMjAlKSB3aGlsZSBtYWludGFpbmluZyByZWxhdGl2ZVxuICogc2NhbGUuIFRoaXMgY3JlYXRlcyBhbiBpbnR1aXRpdmUgdmlzdWFsIGhpZXJhcmNoeSB3aGVyZSBsb25nZXIgYmFyc1xuICogaW5kaWNhdGUgbW92ZXMgdGhhdCB0YWtlIG1vcmUgdGltZSB0byByZWFjaCB0aGUgb3V0Y29tZS5cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgdHlwZXNjcmlwdFxuICogLy8gV2l0aCBtYXggRFRaIG9mIDUwXG4gKiBjYWxjdWxhdGVCYXJXaWR0aCg1MCwgNTApOyAgLy8gMTAwIChtYXhpbXVtIHdpZHRoKVxuICogY2FsY3VsYXRlQmFyV2lkdGgoMjUsIDUwKTsgIC8vIDYwIChwcm9wb3J0aW9uYWwpXG4gKiBjYWxjdWxhdGVCYXJXaWR0aCgwLCA1MCk7ICAgLy8gNTAgKGRlZmF1bHQgZm9yIGRyYXdzKVxuICogY2FsY3VsYXRlQmFyV2lkdGgoNSwgNTApOyAgIC8vIDI4IChtaW5pbXVtIHZpc2liaWxpdHkpXG4gKiBgYGBcbiAqXG4gKiBAcmVtYXJrc1xuICogQWxnb3JpdGhtIGRldGFpbHM6XG4gKiAtIE1pbmltdW0gd2lkdGg6IDIwJSAoZW5zdXJlcyBhbGwgbW92ZXMgYXJlIHZpc2libGUpXG4gKiAtIE1heGltdW0gd2lkdGg6IDEwMCUgKGZvciB0aGUgbG9uZ2VzdCBEVFopXG4gKiAtIExpbmVhciBzY2FsaW5nIGJldHdlZW4gbWluIGFuZCBtYXhcbiAqIC0gU3BlY2lhbCBoYW5kbGluZyBmb3IgemVybyB2YWx1ZXMgKGRyYXdzKVxuICovXG5leHBvcnQgY29uc3QgY2FsY3VsYXRlQmFyV2lkdGggPSAoZHR6OiBudW1iZXIsIG1heER0ejogbnVtYmVyKTogbnVtYmVyID0+IHtcbiAgaWYgKG1heER0eiA9PT0gMCkgcmV0dXJuIDUwOyAvLyBEZWZhdWx0IHdpZHRoIGZvciBkcmF3c1xuXG4gIGNvbnN0IGFic0R0eiA9IE1hdGguYWJzKGR0eik7XG4gIGNvbnN0IGFic01heER0eiA9IE1hdGguYWJzKG1heER0eik7XG5cbiAgaWYgKGFic01heER0eiA9PT0gMCkgcmV0dXJuIDUwO1xuXG4gIC8vIENhbGN1bGF0ZSB3aWR0aDogbWluaW11bSAyMCUsIG1heGltdW0gMTAwJVxuICBjb25zdCBiYXNlV2lkdGggPSAoYWJzRHR6IC8gYWJzTWF4RHR6KSAqIDgwICsgMjA7XG4gIHJldHVybiBNYXRoLm1pbigxMDAsIE1hdGgubWF4KDIwLCBiYXNlV2lkdGgpKTtcbn07XG5cbi8qKlxuICogRm9ybWF0cyBEVFogdmFsdWUgZm9yIGRpc3BsYXlcbiAqXG4gKiBAZnVuY3Rpb24gZm9ybWF0RHR6RGlzcGxheVxuICogQHBhcmFtIHtudW1iZXJ9IGR0eiAtIERpc3RhbmNlIHRvIFplcm8gdmFsdWVcbiAqIEByZXR1cm5zIHtzdHJpbmd9IEh1bWFuLXJlYWRhYmxlIG91dGNvbWUgZGVzY3JpcHRpb25cbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIENvbnZlcnRzIHJhdyBEVFogbnVtYmVycyBpbnRvIHVzZXItZnJpZW5kbHkgZGVzY3JpcHRpb25zIHRoYXQgY2xlYXJseVxuICogY29tbXVuaWNhdGUgdGhlIGdhbWUgb3V0Y29tZSBhbmQgbW92ZXMgcmVxdWlyZWQuIFVzZXMgY2hlc3MgdGVybWlub2xvZ3lcbiAqIGZhbWlsaWFyIHRvIHBsYXllcnMuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYHR5cGVzY3JpcHRcbiAqIGZvcm1hdER0ekRpc3BsYXkoMCk7ICAgIC8vIFwiRHJhd1wiXG4gKiBmb3JtYXREdHpEaXNwbGF5KDE1KTsgICAvLyBcIldpbiBpbiAxNVwiXG4gKiBmb3JtYXREdHpEaXNwbGF5KC0yMCk7ICAvLyBcIkxvc3MgaW4gMjBcIlxuICogYGBgXG4gKlxuICogQHJlbWFya3NcbiAqIFRoZSBcImluIFhcIiBmb3JtYXQgZm9sbG93cyBzdGFuZGFyZCBjaGVzcyBub3RhdGlvbiB3aGVyZSB0aGUgbnVtYmVyXG4gKiByZXByZXNlbnRzIGhhbGYtbW92ZXMgKHBseSkgdG8gdGhlIG91dGNvbWUgd2l0aCBiZXN0IHBsYXkgZnJvbSBib3RoIHNpZGVzLlxuICovXG5leHBvcnQgY29uc3QgZm9ybWF0RHR6RGlzcGxheSA9IChkdHo6IG51bWJlcik6IHN0cmluZyA9PiB7XG4gIGlmIChkdHogPT09IDApIHJldHVybiBcIkRyYXdcIjtcbiAgaWYgKGR0eiA+IDApIHJldHVybiBgV2luIGluICR7ZHR6fWA7XG4gIHJldHVybiBgTG9zcyBpbiAke01hdGguYWJzKGR0eil9YDtcbn07XG5cbi8qKlxuICogR2V0cyB0aGUgcmVzdWx0IHR5cGUgdGl0bGUgZm9yIGdyb3VwIGhlYWRlcnNcbiAqXG4gKiBAZnVuY3Rpb24gZ2V0UmVzdWx0VHlwZVRpdGxlXG4gKiBAcGFyYW0ge01vdmVSZXN1bHRUeXBlfSByZXN1bHRUeXBlIC0gVGhlIG1vdmUgcmVzdWx0IHR5cGVcbiAqIEByZXR1cm5zIHtzdHJpbmd9IFBsdXJhbGl6ZWQsIGh1bWFuLXJlYWRhYmxlIHRpdGxlXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBQcm92aWRlcyBjb25zaXN0ZW50IGdyb3VwIGhlYWRlcnMgZm9yIHRoZSBVSS4gUmV0dXJucyBwbHVyYWxpemVkXG4gKiB0aXRsZXMgc3VpdGFibGUgZm9yIHNlY3Rpb24gaGVhZGVycyBpbiB0aGUgbW92ZSBncm91cGluZyBpbnRlcmZhY2UuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYHR5cGVzY3JpcHRcbiAqIGdldFJlc3VsdFR5cGVUaXRsZSgnd2luJyk7ICAgLy8gXCJXaW5uaW5nIE1vdmVzXCJcbiAqIGdldFJlc3VsdFR5cGVUaXRsZSgnZHJhdycpOyAgLy8gXCJEcmF3aW5nIE1vdmVzXCJcbiAqIGdldFJlc3VsdFR5cGVUaXRsZSgnbG9zcycpOyAgLy8gXCJMb3NpbmcgTW92ZXNcIlxuICogYGBgXG4gKlxuICogQHJlbWFya3NcbiAqIFRpdGxlcyBhcmUgaW50ZW50aW9uYWxseSBwbHVyYWxpemVkIGFzIHRoZXkgcmVwcmVzZW50IGdyb3VwcyBvZiBtb3Zlcy5cbiAqIFRoZSBcIlVua25vd24gTW92ZXNcIiBmYWxsYmFjayBoYW5kbGVzIGVkZ2UgY2FzZXMgZ3JhY2VmdWxseS5cbiAqL1xuZXhwb3J0IGNvbnN0IGdldFJlc3VsdFR5cGVUaXRsZSA9IChyZXN1bHRUeXBlOiBNb3ZlUmVzdWx0VHlwZSk6IHN0cmluZyA9PiB7XG4gIHN3aXRjaCAocmVzdWx0VHlwZSkge1xuICAgIGNhc2UgXCJ3aW5cIjpcbiAgICAgIHJldHVybiBcIldpbm5pbmcgTW92ZXNcIjtcbiAgICBjYXNlIFwiZHJhd1wiOlxuICAgICAgcmV0dXJuIFwiRHJhd2luZyBNb3Zlc1wiO1xuICAgIGNhc2UgXCJsb3NzXCI6XG4gICAgICByZXR1cm4gXCJMb3NpbmcgTW92ZXNcIjtcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIFwiVW5rbm93biBNb3Zlc1wiO1xuICB9XG59O1xuIl0sIm5hbWVzIjpbImNhbGN1bGF0ZUJhcldpZHRoIiwiY2xhc3NpZnlNb3Zlc0J5RFRaIiwiZm9ybWF0RHR6RGlzcGxheSIsImdldENvbG9yQ2xhc3MiLCJnZXRFdmFsdWF0aW9uQmFyQ29sb3IiLCJnZXRNb3ZlUmVzdWx0VHlwZSIsImdldE1vdmVSZXN1bHRUeXBlRnJvbU1vdmUiLCJnZXRNb3ZlUmVzdWx0VHlwZUZyb21XZGwiLCJnZXRSZXN1bHRJY29uIiwiZ2V0UmVzdWx0VHlwZVRpdGxlIiwiZ3JvdXBNb3Zlc0J5UmVzdWx0Iiwic29ydE1vdmVzQnlSZXN1bHQiLCJkdHoiLCJtb3ZlIiwiY2F0ZWdvcnkiLCJ3ZGwiLCJtb3ZlcyIsImdyb3VwZWQiLCJ3aW4iLCJkcmF3IiwibG9zcyIsInJlc3VsdFR5cGUiLCJwdXNoIiwic29ydCIsImEiLCJiIiwiYVR5cGUiLCJiVHlwZSIsInR5cGVPcmRlciIsInNhbiIsImxvY2FsZUNvbXBhcmUiLCJ3aW5uaW5nTW92ZXMiLCJkcmF3aW5nTW92ZXMiLCJsb3NpbmdNb3ZlcyIsInRvdGFsTW92ZXMiLCJsZW5ndGgiLCJtYXhEdHoiLCJhYnNEdHoiLCJNYXRoIiwiYWJzIiwiYWJzTWF4RHR6IiwiYmFzZVdpZHRoIiwibWluIiwibWF4Il0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Q0FvQkMsR0FFRDs7O0NBR0M7Ozs7Ozs7Ozs7O1FBeWFZQTtlQUFBQTs7UUFySkFDO2VB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