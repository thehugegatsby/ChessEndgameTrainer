d59918f011087e2102fbb772029ba71c
/**
 * @file Tablebase analysis display panel
 * @module components/tablebase/TablebasePanel
 *
 * @description
 * Professional tablebase analysis panel with grouped move display,
 * color-coded evaluation bars, and interactive move selection.
 * Provides a Lichess-style interface for exploring tablebase evaluations.
 *
 * @remarks
 * Key features:
 * - Automatic move grouping by outcome (win/draw/loss)
 * - Visual DTZ (Distance to Zero) indicators
 * - Color-coded evaluation bars
 * - Expandable/collapsible move groups
 * - Loading and error state handling
 * - Responsive layout with compact mode
 *
 * The component integrates with the tablebase evaluation system
 * and provides visual feedback for optimal move selection.
 */ "use client";
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get CompactTablebasePanel () {
        return CompactTablebasePanel;
    },
    get TablebasePanel () {
        return TablebasePanel;
    },
    get TablebasePanelWithErrorBoundary () {
        return TablebasePanel;
    }
});
const _jsxruntime = require("react/jsx-runtime");
const _react = /*#__PURE__*/ _interop_require_wildcard(require("react"));
const _MoveResultGroup = require("./MoveResultGroup");
const _resultClassification = require("../../utils/tablebase/resultClassification");
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
const TablebasePanel = ({ tablebaseData, onMoveSelect, selectedMove, loading = false, error, compact = false, className = "" })=>{
    /**
   * Transforms tablebase API data to internal move format
   *
   * @description
   * Converts the raw tablebase data structure into a normalized
   * format suitable for display and interaction. Handles missing
   * data gracefully by returning an empty array.
   *
   * @remarks
   * The transformation preserves all tablebase metrics:
   * - move: UCI notation (e.g., "e2e4")
   * - san: Standard Algebraic Notation (e.g., "e4")
   * - dtz: Distance to Zero (moves to conversion)
   * - dtm: Distance to Mate (if applicable)
   * - wdl: Win/Draw/Loss value
   * - category: Outcome classification
   */ const moves = (0, _react.useMemo)(()=>{
        if (!tablebaseData.topMoves || tablebaseData.topMoves.length === 0) {
            return [];
        }
        return tablebaseData.topMoves.map((move)=>({
                move: move.move,
                san: move.san,
                dtz: move.dtz,
                dtm: move.dtm,
                wdl: move.wdl,
                category: move.category
            }));
    }, [
        tablebaseData.topMoves
    ]);
    /**
   * Categorizes moves by outcome for grouped display
   *
   * @description
   * Uses the classification utility to group moves into
   * winning, drawing, and losing categories based on their
   * WDL (Win/Draw/Loss) values.
   *
   * @remarks
   * This categorization enables the UI to display moves
   * in semantically meaningful groups with appropriate
   * visual styling and prioritization.
   */ const categorizedMoves = (0, _react.useMemo)(()=>{
        return (0, _resultClassification.classifyMovesByDTZ)(moves);
    }, [
        moves
    ]);
    // Error state
    if (error) {
        return /*#__PURE__*/ (0, _jsxruntime.jsxs)("div", {
            className: `tablebase-panel ${className}`,
            children: [
                /*#__PURE__*/ (0, _jsxruntime.jsx)("div", {
                    className: "text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",
                    children: "Tablebase"
                }),
                /*#__PURE__*/ (0, _jsxruntime.jsx)("div", {
                    className: "text-sm text-red-600 dark:text-red-400 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg",
                    children: "Analyse konnte nicht geladen werden"
                })
            ]
        });
    }
    // Loading state
    if (loading) {
        return /*#__PURE__*/ (0, _jsxruntime.jsxs)("div", {
            className: `tablebase-panel ${className}`,
            children: [
                /*#__PURE__*/ (0, _jsxruntime.jsx)("div", {
                    className: "text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",
                    children: "Tablebase"
                }),
                /*#__PURE__*/ (0, _jsxruntime.jsx)("div", {
                    className: "text-center py-4",
                    children: /*#__PURE__*/ (0, _jsxruntime.jsx)("div", {
                        className: "text-sm text-gray-500 dark:text-gray-400",
                        children: "Lade Analyse..."
                    })
                })
            ]
        });
    }
    // No tablebase data
    if (!tablebaseData.isTablebasePosition) {
        return /*#__PURE__*/ (0, _jsxruntime.jsxs)("div", {
            className: `tablebase-panel ${className}`,
            children: [
                /*#__PURE__*/ (0, _jsxruntime.jsx)("div", {
                    className: "text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",
                    children: "Tablebase"
                }),
                /*#__PURE__*/ (0, _jsxruntime.jsx)("div", {
                    className: "text-sm text-amber-600 dark:text-amber-400 p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg",
                    children: "Keine Tablebase-Daten verfÃ¼gbar"
                })
            ]
        });
    }
    // No moves available
    if (moves.length === 0) {
        return /*#__PURE__*/ (0, _jsxruntime.jsxs)("div", {
            className: `tablebase-panel ${className}`,
            "data-testid": "tablebase-panel-empty",
            children: [
                /*#__PURE__*/ (0, _jsxruntime.jsx)("div", {
                    className: "text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",
                    children: "Tablebase"
                }),
                /*#__PURE__*/ (0, _jsxruntime.jsx)("div", {
                    className: "text-sm text-green-600 dark:text-green-400 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg",
                    children: "Warte auf Tablebase-Analyse..."
                })
            ]
        });
    }
    return /*#__PURE__*/ (0, _jsxruntime.jsxs)("div", {
        className: `tablebase-panel ${className}`,
        "data-testid": "tablebase-panel",
        children: [
            /*#__PURE__*/ (0, _jsxruntime.jsxs)("div", {
                className: "flex items-center justify-between mb-4",
                children: [
                    /*#__PURE__*/ (0, _jsxruntime.jsx)("div", {
                        className: "text-sm font-medium text-gray-700 dark:text-gray-300",
                        children: "Tablebase"
                    }),
                    /*#__PURE__*/ (0, _jsxruntime.jsxs)("div", {
                        className: "text-xs text-gray-500 dark:text-gray-400",
                        children: [
                            categorizedMoves.totalMoves,
                            " moves"
                        ]
                    })
                ]
            }),
            /*#__PURE__*/ (0, _jsxruntime.jsxs)("div", {
                className: "space-y-2",
                children: [
                    categorizedMoves.winningMoves.length > 0 && /*#__PURE__*/ (0, _jsxruntime.jsx)(_MoveResultGroup.MoveResultGroup, {
                        moves: categorizedMoves.winningMoves,
                        resultType: "win",
                        onMoveSelect: onMoveSelect,
                        selectedMove: selectedMove,
                        initiallyExpanded: true,
                        compact: compact
                    }),
                    categorizedMoves.drawingMoves.length > 0 && /*#__PURE__*/ (0, _jsxruntime.jsx)(_MoveResultGroup.MoveResultGroup, {
                        moves: categorizedMoves.drawingMoves,
                        resultType: "draw",
                        onMoveSelect: onMoveSelect,
                        selectedMove: selectedMove,
                        initiallyExpanded: true,
                        compact: compact
                    }),
                    categorizedMoves.losingMoves.length > 0 && /*#__PURE__*/ (0, _jsxruntime.jsx)(_MoveResultGroup.MoveResultGroup, {
                        moves: categorizedMoves.losingMoves,
                        resultType: "loss",
                        onMoveSelect: onMoveSelect,
                        selectedMove: selectedMove,
                        initiallyExpanded: false,
                        compact: compact
                    })
                ]
            })
        ]
    });
};
const CompactTablebasePanel = (props)=>{
    return /*#__PURE__*/ (0, _jsxruntime.jsx)(TablebasePanel, {
        ...props,
        compact: true,
        className: `compact-tablebase-panel ${props.className || ""}`
    });
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL3RoZWh1L2Nvb2xQcm9qZWN0cy9FbmRnYW1lVHJhaW5lci10cmFpbmluZy1ib2FyZC1jb21wbGV0ZS9zcmMvc2hhcmVkL2NvbXBvbmVudHMvdGFibGViYXNlL1RhYmxlYmFzZVBhbmVsLnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIFRhYmxlYmFzZSBhbmFseXNpcyBkaXNwbGF5IHBhbmVsXG4gKiBAbW9kdWxlIGNvbXBvbmVudHMvdGFibGViYXNlL1RhYmxlYmFzZVBhbmVsXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBQcm9mZXNzaW9uYWwgdGFibGViYXNlIGFuYWx5c2lzIHBhbmVsIHdpdGggZ3JvdXBlZCBtb3ZlIGRpc3BsYXksXG4gKiBjb2xvci1jb2RlZCBldmFsdWF0aW9uIGJhcnMsIGFuZCBpbnRlcmFjdGl2ZSBtb3ZlIHNlbGVjdGlvbi5cbiAqIFByb3ZpZGVzIGEgTGljaGVzcy1zdHlsZSBpbnRlcmZhY2UgZm9yIGV4cGxvcmluZyB0YWJsZWJhc2UgZXZhbHVhdGlvbnMuXG4gKlxuICogQHJlbWFya3NcbiAqIEtleSBmZWF0dXJlczpcbiAqIC0gQXV0b21hdGljIG1vdmUgZ3JvdXBpbmcgYnkgb3V0Y29tZSAod2luL2RyYXcvbG9zcylcbiAqIC0gVmlzdWFsIERUWiAoRGlzdGFuY2UgdG8gWmVybykgaW5kaWNhdG9yc1xuICogLSBDb2xvci1jb2RlZCBldmFsdWF0aW9uIGJhcnNcbiAqIC0gRXhwYW5kYWJsZS9jb2xsYXBzaWJsZSBtb3ZlIGdyb3Vwc1xuICogLSBMb2FkaW5nIGFuZCBlcnJvciBzdGF0ZSBoYW5kbGluZ1xuICogLSBSZXNwb25zaXZlIGxheW91dCB3aXRoIGNvbXBhY3QgbW9kZVxuICpcbiAqIFRoZSBjb21wb25lbnQgaW50ZWdyYXRlcyB3aXRoIHRoZSB0YWJsZWJhc2UgZXZhbHVhdGlvbiBzeXN0ZW1cbiAqIGFuZCBwcm92aWRlcyB2aXN1YWwgZmVlZGJhY2sgZm9yIG9wdGltYWwgbW92ZSBzZWxlY3Rpb24uXG4gKi9cblxuXCJ1c2UgY2xpZW50XCI7XG5cbmltcG9ydCBSZWFjdCwgeyB1c2VNZW1vIH0gZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgeyBNb3ZlUmVzdWx0R3JvdXAgfSBmcm9tIFwiLi9Nb3ZlUmVzdWx0R3JvdXBcIjtcbmltcG9ydCB7XG4gIHR5cGUgVGFibGViYXNlTW92ZSxcbiAgY2xhc3NpZnlNb3Zlc0J5RFRaLFxufSBmcm9tIFwiQHNoYXJlZC91dGlscy90YWJsZWJhc2UvcmVzdWx0Q2xhc3NpZmljYXRpb25cIjtcbmltcG9ydCB7IHR5cGUgVGFibGViYXNlRGF0YSB9IGZyb20gXCJAc2hhcmVkL3R5cGVzL2V2YWx1YXRpb25cIjtcblxuLyoqXG4gKiBQcm9wcyBmb3IgdGhlIFRhYmxlYmFzZVBhbmVsIGNvbXBvbmVudFxuICpcbiAqIEBpbnRlcmZhY2UgVGFibGViYXNlUGFuZWxQcm9wc1xuICpcbiAqIEBkZXNjcmlwdGlvblxuICogQ29uZmlndXJhdGlvbiBvcHRpb25zIGZvciB0aGUgdGFibGViYXNlIGFuYWx5c2lzIHBhbmVsLFxuICogaW5jbHVkaW5nIGRhdGEgc291cmNlLCBpbnRlcmFjdGlvbiBjYWxsYmFja3MsIGFuZCBkaXNwbGF5IG9wdGlvbnMuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgVGFibGViYXNlUGFuZWxQcm9wcyB7XG4gIC8qKiBUYWJsZWJhc2UgZGF0YSBmcm9tIHRoZSBldmFsdWF0aW9uIHN5c3RlbSAqL1xuICB0YWJsZWJhc2VEYXRhOiBUYWJsZWJhc2VEYXRhO1xuICAvKiogQ2FsbGJhY2sgd2hlbiBhIG1vdmUgaXMgc2VsZWN0ZWQgKi9cbiAgb25Nb3ZlU2VsZWN0OiAobW92ZTogc3RyaW5nKSA9PiB2b2lkO1xuICAvKiogQ3VycmVudGx5IHNlbGVjdGVkIG1vdmUgKi9cbiAgc2VsZWN0ZWRNb3ZlPzogc3RyaW5nO1xuICAvKiogV2hldGhlciB0aGUgcGFuZWwgaXMgaW4gYSBsb2FkaW5nIHN0YXRlICovXG4gIGxvYWRpbmc/OiBib29sZWFuO1xuICAvKiogRXJyb3IgbWVzc2FnZSB0byBkaXNwbGF5ICovXG4gIGVycm9yPzogc3RyaW5nO1xuICAvKiogV2hldGhlciB0byBzaG93IGNvbXBhY3QgbGF5b3V0ICovXG4gIGNvbXBhY3Q/OiBib29sZWFuO1xuICAvKiogQWRkaXRpb25hbCBDU1MgY2xhc3NlcyAqL1xuICBjbGFzc05hbWU/OiBzdHJpbmc7XG59XG5cbi8qKlxuICogVGFibGViYXNlIGFuYWx5c2lzIGRpc3BsYXkgcGFuZWxcbiAqXG4gKiBAY29tcG9uZW50XG4gKiBAZGVzY3JpcHRpb25cbiAqIERpc3BsYXlzIHRhYmxlYmFzZSBldmFsdWF0aW9uIHJlc3VsdHMgaW4gYW4gb3JnYW5pemVkLCBpbnRlcmFjdGl2ZSBmb3JtYXQuXG4gKiBHcm91cHMgbW92ZXMgYnkgb3V0Y29tZSBhbmQgcHJvdmlkZXMgdmlzdWFsIGluZGljYXRvcnMgZm9yIG1vdmUgcXVhbGl0eS5cbiAqXG4gKiBAcmVtYXJrc1xuICogVGhlIGNvbXBvbmVudCBhdXRvbWF0aWNhbGx5IGNhdGVnb3JpemVzIG1vdmVzIGludG8gdGhyZWUgZ3JvdXBzOlxuICogLSBXaW5uaW5nIG1vdmVzIChwb3NpdGl2ZSBXREwpXG4gKiAtIERyYXdpbmcgbW92ZXMgKHplcm8gV0RMKVxuICogLSBMb3NpbmcgbW92ZXMgKG5lZ2F0aXZlIFdETClcbiAqXG4gKiBFYWNoIGdyb3VwIGNhbiBiZSBleHBhbmRlZC9jb2xsYXBzZWQgYW5kIHNob3dzIERUWiBpbmZvcm1hdGlvblxuICogd2hlbiBhdmFpbGFibGUuIFRoZSBwYW5lbCBoYW5kbGVzIHZhcmlvdXMgc3RhdGVzIGluY2x1ZGluZyBsb2FkaW5nLFxuICogbm8gZGF0YSwgYW5kIG5vIG1vdmVzIGF2YWlsYWJsZS5cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgdHN4XG4gKiAvLyBCYXNpYyB1c2FnZVxuICogPFRhYmxlYmFzZVBhbmVsXG4gKiAgIHRhYmxlYmFzZURhdGE9e2V2YWx1YXRpb24udGFibGViYXNlfVxuICogICBvbk1vdmVTZWxlY3Q9eyhtb3ZlKSA9PiBtYWtlTW92ZShtb3ZlKX1cbiAqICAgc2VsZWN0ZWRNb3ZlPXtjdXJyZW50TW92ZX1cbiAqIC8+XG4gKlxuICogLy8gV2l0aCBsb2FkaW5nIHN0YXRlIGFuZCBjb21wYWN0IG1vZGVcbiAqIDxUYWJsZWJhc2VQYW5lbFxuICogICB0YWJsZWJhc2VEYXRhPXtkYXRhfVxuICogICBvbk1vdmVTZWxlY3Q9e2hhbmRsZU1vdmV9XG4gKiAgIGxvYWRpbmc9e2lzQW5hbHl6aW5nfVxuICogICBjb21wYWN0PXt0cnVlfVxuICogICBjbGFzc05hbWU9XCJtdC00XCJcbiAqIC8+XG4gKiBgYGBcbiAqXG4gKiBAcGFyYW0ge1RhYmxlYmFzZVBhbmVsUHJvcHN9IHByb3BzIC0gQ29tcG9uZW50IGNvbmZpZ3VyYXRpb25cbiAqIEByZXR1cm5zIHtKU1guRWxlbWVudH0gUmVuZGVyZWQgdGFibGViYXNlIHBhbmVsXG4gKi9cbmV4cG9ydCBjb25zdCBUYWJsZWJhc2VQYW5lbDogUmVhY3QuRkM8VGFibGViYXNlUGFuZWxQcm9wcz4gPSAoe1xuICB0YWJsZWJhc2VEYXRhLFxuICBvbk1vdmVTZWxlY3QsXG4gIHNlbGVjdGVkTW92ZSxcbiAgbG9hZGluZyA9IGZhbHNlLFxuICBlcnJvcixcbiAgY29tcGFjdCA9IGZhbHNlLFxuICBjbGFzc05hbWUgPSBcIlwiLFxufSkgPT4ge1xuICAvKipcbiAgICogVHJhbnNmb3JtcyB0YWJsZWJhc2UgQVBJIGRhdGEgdG8gaW50ZXJuYWwgbW92ZSBmb3JtYXRcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIENvbnZlcnRzIHRoZSByYXcgdGFibGViYXNlIGRhdGEgc3RydWN0dXJlIGludG8gYSBub3JtYWxpemVkXG4gICAqIGZvcm1hdCBzdWl0YWJsZSBmb3IgZGlzcGxheSBhbmQgaW50ZXJhY3Rpb24uIEhhbmRsZXMgbWlzc2luZ1xuICAgKiBkYXRhIGdyYWNlZnVsbHkgYnkgcmV0dXJuaW5nIGFuIGVtcHR5IGFycmF5LlxuICAgKlxuICAgKiBAcmVtYXJrc1xuICAgKiBUaGUgdHJhbnNmb3JtYXRpb24gcHJlc2VydmVzIGFsbCB0YWJsZWJhc2UgbWV0cmljczpcbiAgICogLSBtb3ZlOiBVQ0kgbm90YXRpb24gKGUuZy4sIFwiZTJlNFwiKVxuICAgKiAtIHNhbjogU3RhbmRhcmQgQWxnZWJyYWljIE5vdGF0aW9uIChlLmcuLCBcImU0XCIpXG4gICAqIC0gZHR6OiBEaXN0YW5jZSB0byBaZXJvIChtb3ZlcyB0byBjb252ZXJzaW9uKVxuICAgKiAtIGR0bTogRGlzdGFuY2UgdG8gTWF0ZSAoaWYgYXBwbGljYWJsZSlcbiAgICogLSB3ZGw6IFdpbi9EcmF3L0xvc3MgdmFsdWVcbiAgICogLSBjYXRlZ29yeTogT3V0Y29tZSBjbGFzc2lmaWNhdGlvblxuICAgKi9cbiAgY29uc3QgbW92ZXM6IFRhYmxlYmFzZU1vdmVbXSA9IHVzZU1lbW8oKCkgPT4ge1xuICAgIGlmICghdGFibGViYXNlRGF0YS50b3BNb3ZlcyB8fCB0YWJsZWJhc2VEYXRhLnRvcE1vdmVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIHJldHVybiB0YWJsZWJhc2VEYXRhLnRvcE1vdmVzLm1hcCgobW92ZSkgPT4gKHtcbiAgICAgIG1vdmU6IG1vdmUubW92ZSxcbiAgICAgIHNhbjogbW92ZS5zYW4sXG4gICAgICBkdHo6IG1vdmUuZHR6LFxuICAgICAgZHRtOiBtb3ZlLmR0bSxcbiAgICAgIHdkbDogbW92ZS53ZGwsXG4gICAgICBjYXRlZ29yeTogbW92ZS5jYXRlZ29yeSxcbiAgICB9KSk7XG4gIH0sIFt0YWJsZWJhc2VEYXRhLnRvcE1vdmVzXSk7XG5cbiAgLyoqXG4gICAqIENhdGVnb3JpemVzIG1vdmVzIGJ5IG91dGNvbWUgZm9yIGdyb3VwZWQgZGlzcGxheVxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogVXNlcyB0aGUgY2xhc3NpZmljYXRpb24gdXRpbGl0eSB0byBncm91cCBtb3ZlcyBpbnRvXG4gICAqIHdpbm5pbmcsIGRyYXdpbmcsIGFuZCBsb3NpbmcgY2F0ZWdvcmllcyBiYXNlZCBvbiB0aGVpclxuICAgKiBXREwgKFdpbi9EcmF3L0xvc3MpIHZhbHVlcy5cbiAgICpcbiAgICogQHJlbWFya3NcbiAgICogVGhpcyBjYXRlZ29yaXphdGlvbiBlbmFibGVzIHRoZSBVSSB0byBkaXNwbGF5IG1vdmVzXG4gICAqIGluIHNlbWFudGljYWxseSBtZWFuaW5nZnVsIGdyb3VwcyB3aXRoIGFwcHJvcHJpYXRlXG4gICAqIHZpc3VhbCBzdHlsaW5nIGFuZCBwcmlvcml0aXphdGlvbi5cbiAgICovXG4gIGNvbnN0IGNhdGVnb3JpemVkTW92ZXMgPSB1c2VNZW1vKCgpID0+IHtcbiAgICByZXR1cm4gY2xhc3NpZnlNb3Zlc0J5RFRaKG1vdmVzKTtcbiAgfSwgW21vdmVzXSk7XG5cbiAgLy8gRXJyb3Igc3RhdGVcbiAgaWYgKGVycm9yKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXYgY2xhc3NOYW1lPXtgdGFibGViYXNlLXBhbmVsICR7Y2xhc3NOYW1lfWB9PlxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInRleHQtc20gZm9udC1tZWRpdW0gdGV4dC1ncmF5LTcwMCBkYXJrOnRleHQtZ3JheS0zMDAgbWItM1wiPlxuICAgICAgICAgIFRhYmxlYmFzZVxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJ0ZXh0LXNtIHRleHQtcmVkLTYwMCBkYXJrOnRleHQtcmVkLTQwMCBwLTMgYmctcmVkLTUwIGRhcms6YmctcmVkLTkwMC8yMCByb3VuZGVkLWxnXCI+XG4gICAgICAgICAgQW5hbHlzZSBrb25udGUgbmljaHQgZ2VsYWRlbiB3ZXJkZW5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG5cbiAgLy8gTG9hZGluZyBzdGF0ZVxuICBpZiAobG9hZGluZykge1xuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IGNsYXNzTmFtZT17YHRhYmxlYmFzZS1wYW5lbCAke2NsYXNzTmFtZX1gfT5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJ0ZXh0LXNtIGZvbnQtbWVkaXVtIHRleHQtZ3JheS03MDAgZGFyazp0ZXh0LWdyYXktMzAwIG1iLTNcIj5cbiAgICAgICAgICBUYWJsZWJhc2VcbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwidGV4dC1jZW50ZXIgcHktNFwiPlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwidGV4dC1zbSB0ZXh0LWdyYXktNTAwIGRhcms6dGV4dC1ncmF5LTQwMFwiPlxuICAgICAgICAgICAgTGFkZSBBbmFseXNlLi4uXG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxuXG4gIC8vIE5vIHRhYmxlYmFzZSBkYXRhXG4gIGlmICghdGFibGViYXNlRGF0YS5pc1RhYmxlYmFzZVBvc2l0aW9uKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXYgY2xhc3NOYW1lPXtgdGFibGViYXNlLXBhbmVsICR7Y2xhc3NOYW1lfWB9PlxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInRleHQtc20gZm9udC1tZWRpdW0gdGV4dC1ncmF5LTcwMCBkYXJrOnRleHQtZ3JheS0zMDAgbWItM1wiPlxuICAgICAgICAgIFRhYmxlYmFzZVxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJ0ZXh0LXNtIHRleHQtYW1iZXItNjAwIGRhcms6dGV4dC1hbWJlci00MDAgcC0zIGJnLWFtYmVyLTUwIGRhcms6YmctYW1iZXItOTAwLzIwIHJvdW5kZWQtbGdcIj5cbiAgICAgICAgICBLZWluZSBUYWJsZWJhc2UtRGF0ZW4gdmVyZsO8Z2JhclxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cblxuICAvLyBObyBtb3ZlcyBhdmFpbGFibGVcbiAgaWYgKG1vdmVzLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IGNsYXNzTmFtZT17YHRhYmxlYmFzZS1wYW5lbCAke2NsYXNzTmFtZX1gfSBkYXRhLXRlc3RpZD1cInRhYmxlYmFzZS1wYW5lbC1lbXB0eVwiPlxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInRleHQtc20gZm9udC1tZWRpdW0gdGV4dC1ncmF5LTcwMCBkYXJrOnRleHQtZ3JheS0zMDAgbWItM1wiPlxuICAgICAgICAgIFRhYmxlYmFzZVxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJ0ZXh0LXNtIHRleHQtZ3JlZW4tNjAwIGRhcms6dGV4dC1ncmVlbi00MDAgcC0zIGJnLWdyZWVuLTUwIGRhcms6YmctZ3JlZW4tOTAwLzIwIHJvdW5kZWQtbGdcIj5cbiAgICAgICAgICBXYXJ0ZSBhdWYgVGFibGViYXNlLUFuYWx5c2UuLi5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG5cbiAgcmV0dXJuIChcbiAgICA8ZGl2XG4gICAgICBjbGFzc05hbWU9e2B0YWJsZWJhc2UtcGFuZWwgJHtjbGFzc05hbWV9YH1cbiAgICAgIGRhdGEtdGVzdGlkPVwidGFibGViYXNlLXBhbmVsXCJcbiAgICA+XG4gICAgICB7LyogSGVhZGVyICovfVxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWJldHdlZW4gbWItNFwiPlxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInRleHQtc20gZm9udC1tZWRpdW0gdGV4dC1ncmF5LTcwMCBkYXJrOnRleHQtZ3JheS0zMDBcIj5cbiAgICAgICAgICBUYWJsZWJhc2VcbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwidGV4dC14cyB0ZXh0LWdyYXktNTAwIGRhcms6dGV4dC1ncmF5LTQwMFwiPlxuICAgICAgICAgIHtjYXRlZ29yaXplZE1vdmVzLnRvdGFsTW92ZXN9IG1vdmVzXG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG5cbiAgICAgIHsvKiBNb3ZlIEdyb3VwcyAqL31cbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwic3BhY2UteS0yXCI+XG4gICAgICAgIHsvKiBXaW5uaW5nIE1vdmVzICovfVxuICAgICAgICB7Y2F0ZWdvcml6ZWRNb3Zlcy53aW5uaW5nTW92ZXMubGVuZ3RoID4gMCAmJiAoXG4gICAgICAgICAgPE1vdmVSZXN1bHRHcm91cFxuICAgICAgICAgICAgbW92ZXM9e2NhdGVnb3JpemVkTW92ZXMud2lubmluZ01vdmVzfVxuICAgICAgICAgICAgcmVzdWx0VHlwZT1cIndpblwiXG4gICAgICAgICAgICBvbk1vdmVTZWxlY3Q9e29uTW92ZVNlbGVjdH1cbiAgICAgICAgICAgIHNlbGVjdGVkTW92ZT17c2VsZWN0ZWRNb3ZlfVxuICAgICAgICAgICAgaW5pdGlhbGx5RXhwYW5kZWQ9e3RydWV9XG4gICAgICAgICAgICBjb21wYWN0PXtjb21wYWN0fVxuICAgICAgICAgIC8+XG4gICAgICAgICl9XG5cbiAgICAgICAgey8qIERyYXdpbmcgTW92ZXMgKi99XG4gICAgICAgIHtjYXRlZ29yaXplZE1vdmVzLmRyYXdpbmdNb3Zlcy5sZW5ndGggPiAwICYmIChcbiAgICAgICAgICA8TW92ZVJlc3VsdEdyb3VwXG4gICAgICAgICAgICBtb3Zlcz17Y2F0ZWdvcml6ZWRNb3Zlcy5kcmF3aW5nTW92ZXN9XG4gICAgICAgICAgICByZXN1bHRUeXBlPVwiZHJhd1wiXG4gICAgICAgICAgICBvbk1vdmVTZWxlY3Q9e29uTW92ZVNlbGVjdH1cbiAgICAgICAgICAgIHNlbGVjdGVkTW92ZT17c2VsZWN0ZWRNb3ZlfVxuICAgICAgICAgICAgaW5pdGlhbGx5RXhwYW5kZWQ9e3RydWV9XG4gICAgICAgICAgICBjb21wYWN0PXtjb21wYWN0fVxuICAgICAgICAgIC8+XG4gICAgICAgICl9XG5cbiAgICAgICAgey8qIExvc2luZyBNb3ZlcyAqL31cbiAgICAgICAge2NhdGVnb3JpemVkTW92ZXMubG9zaW5nTW92ZXMubGVuZ3RoID4gMCAmJiAoXG4gICAgICAgICAgPE1vdmVSZXN1bHRHcm91cFxuICAgICAgICAgICAgbW92ZXM9e2NhdGVnb3JpemVkTW92ZXMubG9zaW5nTW92ZXN9XG4gICAgICAgICAgICByZXN1bHRUeXBlPVwibG9zc1wiXG4gICAgICAgICAgICBvbk1vdmVTZWxlY3Q9e29uTW92ZVNlbGVjdH1cbiAgICAgICAgICAgIHNlbGVjdGVkTW92ZT17c2VsZWN0ZWRNb3ZlfVxuICAgICAgICAgICAgaW5pdGlhbGx5RXhwYW5kZWQ9e2ZhbHNlfVxuICAgICAgICAgICAgY29tcGFjdD17Y29tcGFjdH1cbiAgICAgICAgICAvPlxuICAgICAgICApfVxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICk7XG59O1xuXG4vKipcbiAqIENvbXBhY3QgdmVyc2lvbiBvZiBUYWJsZWJhc2VQYW5lbCBmb3IgZGVuc2UgbGF5b3V0c1xuICovXG5leHBvcnQgY29uc3QgQ29tcGFjdFRhYmxlYmFzZVBhbmVsOiBSZWFjdC5GQzxUYWJsZWJhc2VQYW5lbFByb3BzPiA9IChwcm9wcykgPT4ge1xuICByZXR1cm4gKFxuICAgIDxUYWJsZWJhc2VQYW5lbFxuICAgICAgey4uLnByb3BzfVxuICAgICAgY29tcGFjdD17dHJ1ZX1cbiAgICAgIGNsYXNzTmFtZT17YGNvbXBhY3QtdGFibGViYXNlLXBhbmVsICR7cHJvcHMuY2xhc3NOYW1lIHx8IFwiXCJ9YH1cbiAgICAvPlxuICApO1xufTtcblxuLyoqXG4gKiBFcnJvciBib3VuZGFyeSB3cmFwcGVyIGZvciBUYWJsZWJhc2VQYW5lbFxuICovXG5leHBvcnQgeyBUYWJsZWJhc2VQYW5lbCBhcyBUYWJsZWJhc2VQYW5lbFdpdGhFcnJvckJvdW5kYXJ5IH07XG4iXSwibmFtZXMiOlsiQ29tcGFjdFRhYmxlYmFzZVBhbmVsIiwiVGFibGViYXNlUGFuZWwiLCJUYWJsZWJhc2VQYW5lbFdpdGhFcnJvckJvdW5kYXJ5IiwidGFibGViYXNlRGF0YSIsIm9uTW92ZVNlbGVjdCIsInNlbGVjdGVkTW92ZSIsImxvYWRpbmciLCJlcnJvciIsImNvbXBhY3QiLCJjbGFzc05hbWUiLCJtb3ZlcyIsInVzZU1lbW8iLCJ0b3BNb3ZlcyIsImxlbmd0aCIsIm1hcCIsIm1vdmUiLCJzYW4iLCJkdHoiLCJkdG0iLCJ3ZGwiLCJjYXRlZ29yeSIsImNhdGVnb3JpemVkTW92ZXMiLCJjbGFzc2lmeU1vdmVzQnlEVFoiLCJkaXYiLCJpc1RhYmxlYmFzZVBvc2l0aW9uIiwiZGF0YS10ZXN0aWQiLCJ0b3RhbE1vdmVzIiwid2lubmluZ01vdmVzIiwiTW92ZVJlc3VsdEdyb3VwIiwicmVzdWx0VHlwZSIsImluaXRpYWxseUV4cGFuZGVkIiwiZHJhd2luZ01vdmVzIiwibG9zaW5nTW92ZXMiLCJwcm9wcyJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0NBb0JDLEdBRUQ7Ozs7Ozs7Ozs7OztRQTRQYUE7ZUFBQUE7O1FBaExBQztlQUFBQTs7UUE2TGNDO2VBQWxCRDs7OzsrREF2UXNCO2lDQUNDO3NDQUl6Qjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBcUVBLE1BQU1BLGlCQUFnRCxDQUFDLEVBQzVERSxhQUFhLEVBQ2JDLFlBQVksRUFDWkMsWUFBWSxFQUNaQyxVQUFVLEtBQUssRUFDZkMsS0FBSyxFQUNMQyxVQUFVLEtBQUssRUFDZkMsWUFBWSxFQUFFLEVBQ2Y7SUFDQzs7Ozs7Ozs7Ozs7Ozs7OztHQWdCQyxHQUNELE1BQU1DLFFBQXlCQyxJQUFBQSxjQUFPLEVBQUM7UUFDckMsSUFBSSxDQUFDUixjQUFjUyxRQUFRLElBQUlULGNBQWNTLFFBQVEsQ0FBQ0MsTUFBTSxLQUFLLEdBQUc7WUFDbEUsT0FBTyxFQUFFO1FBQ1g7UUFFQSxPQUFPVixjQUFjUyxRQUFRLENBQUNFLEdBQUcsQ0FBQyxDQUFDQyxPQUFVLENBQUE7Z0JBQzNDQSxNQUFNQSxLQUFLQSxJQUFJO2dCQUNmQyxLQUFLRCxLQUFLQyxHQUFHO2dCQUNiQyxLQUFLRixLQUFLRSxHQUFHO2dCQUNiQyxLQUFLSCxLQUFLRyxHQUFHO2dCQUNiQyxLQUFLSixLQUFLSSxHQUFHO2dCQUNiQyxVQUFVTCxLQUFLSyxRQUFRO1lBQ3pCLENBQUE7SUFDRixHQUFHO1FBQUNqQixjQUFjUyxRQUFRO0tBQUM7SUFFM0I7Ozs7Ozs7Ozs7OztHQVlDLEdBQ0QsTUFBTVMsbUJBQW1CVixJQUFBQSxjQUFPLEVBQUM7UUFDL0IsT0FBT1csSUFBQUEsd0NBQWtCLEVBQUNaO0lBQzVCLEdBQUc7UUFBQ0E7S0FBTTtJQUVWLGNBQWM7SUFDZCxJQUFJSCxPQUFPO1FBQ1QscUJBQ0Usc0JBQUNnQjtZQUFJZCxXQUFXLENBQUMsZ0JBQWdCLEVBQUVBLFdBQVc7OzhCQUM1QyxxQkFBQ2M7b0JBQUlkLFdBQVU7OEJBQTREOzs4QkFHM0UscUJBQUNjO29CQUFJZCxXQUFVOzhCQUFxRjs7OztJQUsxRztJQUVBLGdCQUFnQjtJQUNoQixJQUFJSCxTQUFTO1FBQ1gscUJBQ0Usc0JBQUNpQjtZQUFJZCxXQUFXLENBQUMsZ0JBQWdCLEVBQUVBLFdBQVc7OzhCQUM1QyxxQkFBQ2M7b0JBQUlkLFdBQVU7OEJBQTREOzs4QkFHM0UscUJBQUNjO29CQUFJZCxXQUFVOzhCQUNiLGNBQUEscUJBQUNjO3dCQUFJZCxXQUFVO2tDQUEyQzs7Ozs7SUFNbEU7SUFFQSxvQkFBb0I7SUFDcEIsSUFBSSxDQUFDTixjQUFjcUIsbUJBQW1CLEVBQUU7UUFDdEMscUJBQ0Usc0JBQUNEO1lBQUlkLFdBQVcsQ0FBQyxnQkFBZ0IsRUFBRUEsV0FBVzs7OEJBQzVDLHFCQUFDYztvQkFBSWQsV0FBVTs4QkFBNEQ7OzhCQUczRSxxQkFBQ2M7b0JBQUlkLFdBQVU7OEJBQTZGOzs7O0lBS2xIO0lBRUEscUJBQXFCO0lBQ3JCLElBQUlDLE1BQU1HLE1BQU0sS0FBSyxHQUFHO1FBQ3RCLHFCQUNFLHNCQUFDVTtZQUFJZCxXQUFXLENBQUMsZ0JBQWdCLEVBQUVBLFdBQVc7WUFBRWdCLGVBQVk7OzhCQUMxRCxxQkFBQ0Y7b0JBQUlkLFdBQVU7OEJBQTREOzs4QkFHM0UscUJBQUNjO29CQUFJZCxXQUFVOzhCQUE2Rjs7OztJQUtsSDtJQUVBLHFCQUNFLHNCQUFDYztRQUNDZCxXQUFXLENBQUMsZ0JBQWdCLEVBQUVBLFdBQVc7UUFDekNnQixlQUFZOzswQkFHWixzQkFBQ0Y7Z0JBQUlkLFdBQVU7O2tDQUNiLHFCQUFDYzt3QkFBSWQsV0FBVTtrQ0FBdUQ7O2tDQUd0RSxzQkFBQ2M7d0JBQUlkLFdBQVU7OzRCQUNaWSxpQkFBaUJLLFVBQVU7NEJBQUM7Ozs7OzBCQUtqQyxzQkFBQ0g7Z0JBQUlkLFdBQVU7O29CQUVaWSxpQkFBaUJNLFlBQVksQ0FBQ2QsTUFBTSxHQUFHLG1CQUN0QyxxQkFBQ2UsZ0NBQWU7d0JBQ2RsQixPQUFPVyxpQkFBaUJNLFlBQVk7d0JBQ3BDRSxZQUFXO3dCQUNYekIsY0FBY0E7d0JBQ2RDLGNBQWNBO3dCQUNkeUIsbUJBQW1CO3dCQUNuQnRCLFNBQVNBOztvQkFLWmEsaUJBQWlCVSxZQUFZLENBQUNsQixNQUFNLEdBQUcsbUJBQ3RDLHFCQUFDZSxnQ0FBZTt3QkFDZGxCLE9BQU9XLGlCQUFpQlUsWUFBWTt3QkFDcENGLFlBQVc7d0JBQ1h6QixjQUFjQTt3QkFDZEMsY0FBY0E7d0JBQ2R5QixtQkFBbUI7d0JBQ25CdEIsU0FBU0E7O29CQUtaYSxpQkFBaUJXLFdBQVcsQ0FBQ25CLE1BQU0sR0FBRyxtQkFDckMscUJBQUNlLGdDQUFlO3dCQUNkbEIsT0FBT1csaUJBQWlCVyxXQUFXO3dCQUNuQ0gsWUFBVzt3QkFDWHpCLGNBQWNBO3dCQUNkQyxjQUFjQTt3QkFDZHlCLG1CQUFtQjt3QkFDbkJ0QixTQUFTQTs7Ozs7O0FBTXJCO0FBS08sTUFBTVIsd0JBQXVELENBQUNpQztJQUNuRSxxQkFDRSxxQkFBQ2hDO1FBQ0UsR0FBR2dDLEtBQUs7UUFDVHpCLFNBQVM7UUFDVEMsV0FBVyxDQUFDLHdCQUF3QixFQUFFd0IsTUFBTXhCLFNBQVMsSUFBSSxJQUFJOztBQUduRSJ9