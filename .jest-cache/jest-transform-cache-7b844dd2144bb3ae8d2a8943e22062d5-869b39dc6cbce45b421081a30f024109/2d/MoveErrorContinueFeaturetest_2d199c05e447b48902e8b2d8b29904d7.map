{"version":3,"sources":["/home/thehu/coolProjects/EndgameTrainer-training-board-complete/src/tests/unit/components/training/MoveErrorContinueFeature.test.tsx"],"sourcesContent":["/**\n * Test suite for the new \"Weiterspielen\" (continue playing) feature\n * Verifies that after clicking \"Weiterspielen\", the opponent makes a move\n */\n\nimport React from \"react\";\nimport { render, screen, fireEvent, waitFor } from \"@testing-library/react\";\nimport { MoveErrorDialog } from \"@shared/components/ui/MoveErrorDialog\";\nimport { scheduleOpponentTurn } from \"@shared/store/orchestrators/handlePlayerMove\";\n\n// Mock the scheduleOpponentTurn function to verify it's called\njest.mock(\"@shared/store/orchestrators/handlePlayerMove\", () => ({\n  scheduleOpponentTurn: jest.fn(),\n  cancelScheduledOpponentTurn: jest.fn(),\n}));\n\nconst mockScheduleOpponentTurn = scheduleOpponentTurn as jest.MockedFunction<\n  typeof scheduleOpponentTurn\n>;\n\ndescribe(\"MoveErrorDialog - Continue Playing Feature\", () => {\n  const defaultProps = {\n    isOpen: true,\n    wdlBefore: 2,\n    wdlAfter: 0,\n    bestMove: \"Kf6\",\n    onClose: jest.fn(),\n    onTakeBack: jest.fn(),\n  };\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it(\"should show 'Weiterspielen' button instead of 'Verstanden'\", () => {\n    render(<MoveErrorDialog {...defaultProps} />);\n\n    // Verify the new button text\n    expect(\n      screen.getByRole(\"button\", { name: \"Weiterspielen\" }),\n    ).toBeInTheDocument();\n    expect(\n      screen.queryByRole(\"button\", { name: \"Verstanden\" }),\n    ).not.toBeInTheDocument();\n  });\n\n  it(\"should call onClose when Weiterspielen button is clicked\", () => {\n    render(<MoveErrorDialog {...defaultProps} />);\n\n    const weiterSpielenButton = screen.getByRole(\"button\", {\n      name: \"Weiterspielen\",\n    });\n    fireEvent.click(weiterSpielenButton);\n\n    expect(defaultProps.onClose).toHaveBeenCalledTimes(1);\n  });\n\n  it(\"should display appropriate error message\", () => {\n    render(<MoveErrorDialog {...defaultProps} />);\n\n    // Should show win-ruining message for wdlBefore=2, wdlAfter=0\n    expect(\n      screen.getByText(\"Dieser Zug verdirbt den Gewinn!\"),\n    ).toBeInTheDocument();\n    expect(screen.getByText(\"Bester Zug war:\")).toBeInTheDocument();\n    expect(screen.getByText(\"Kf6\")).toBeInTheDocument();\n  });\n\n  it(\"should display both action buttons\", () => {\n    render(<MoveErrorDialog {...defaultProps} />);\n\n    // Should have both Weiterspielen and Zur端cknehmen buttons\n    expect(\n      screen.getByRole(\"button\", { name: \"Weiterspielen\" }),\n    ).toBeInTheDocument();\n    expect(\n      screen.getByRole(\"button\", { name: \"Zur端cknehmen\" }),\n    ).toBeInTheDocument();\n  });\n\n  it(\"should show different messages for different WDL changes\", () => {\n    const { rerender } = render(\n      <MoveErrorDialog {...defaultProps} wdlBefore={0} wdlAfter={-2} />,\n    );\n    expect(\n      screen.getByText(\"Dieser Zug f端hrt zum Verlust!\"),\n    ).toBeInTheDocument();\n\n    rerender(<MoveErrorDialog {...defaultProps} wdlBefore={1} wdlAfter={-1} />);\n    expect(\n      screen.getByText(\"Dieser Zug verschlechtert die Stellung!\"),\n    ).toBeInTheDocument();\n\n    rerender(<MoveErrorDialog {...defaultProps} wdlBefore={0} wdlAfter={0} />);\n    expect(screen.getByText(\"Dieser Zug ist ein Fehler!\")).toBeInTheDocument();\n  });\n\n  describe(\"Integration with TrainingBoard (mocked scenario)\", () => {\n    it(\"verifies the expected behavior flow\", () => {\n      // This test documents the expected behavior:\n      // 1. User makes suboptimal move\n      // 2. Error dialog shows with \"Weiterspielen\" and \"Zur端cknehmen\" options\n      // 3. User clicks \"Weiterspielen\"\n      // 4. Dialog closes via onClose callback\n      // 5. TrainingBoard's handleMoveErrorContinue function should:\n      //    - Close the dialog (trainingActions.setMoveErrorDialog(null))\n      //    - Schedule opponent turn (scheduleOpponentTurn(storeApi))\n\n      render(<MoveErrorDialog {...defaultProps} />);\n\n      // Verify the dialog is showing the error state correctly\n      expect(screen.getByText(\"Fehler erkannt!\")).toBeInTheDocument();\n      expect(\n        screen.getByText(\"Dieser Zug verdirbt den Gewinn!\"),\n      ).toBeInTheDocument();\n      expect(screen.getByText(\"Bester Zug war:\")).toBeInTheDocument();\n      expect(screen.getByText(\"Kf6\")).toBeInTheDocument();\n\n      // Click Weiterspielen\n      const weiterSpielenButton = screen.getByRole(\"button\", {\n        name: \"Weiterspielen\",\n      });\n      fireEvent.click(weiterSpielenButton);\n\n      // Verify onClose was called (this will trigger handleMoveErrorContinue in TrainingBoard)\n      expect(defaultProps.onClose).toHaveBeenCalledTimes(1);\n\n      // Note: The actual scheduleOpponentTurn call happens in TrainingBoard's\n      // handleMoveErrorContinue function, not directly in the dialog\n      console.log(\"\\n=== EXPECTED BEHAVIOR ===\");\n      console.log(\"1. User clicks 'Weiterspielen'\");\n      console.log(\"2. Dialog closes (onClose called)\");\n      console.log(\"3. TrainingBoard.handleMoveErrorContinue executes:\");\n      console.log(\"   - trainingActions.setMoveErrorDialog(null)\");\n      console.log(\"   - scheduleOpponentTurn(storeApi)\");\n      console.log(\"4. Opponent makes next move automatically\");\n    });\n  });\n});\n"],"names":["jest","mock","scheduleOpponentTurn","fn","cancelScheduledOpponentTurn","mockScheduleOpponentTurn","describe","defaultProps","isOpen","wdlBefore","wdlAfter","bestMove","onClose","onTakeBack","beforeEach","clearAllMocks","it","render","MoveErrorDialog","expect","screen","getByRole","name","toBeInTheDocument","queryByRole","not","weiterSpielenButton","fireEvent","click","toHaveBeenCalledTimes","getByText","rerender","console","log"],"mappings":"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"}