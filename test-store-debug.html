<!DOCTYPE html>
<html>
<head>
    <title>Store Debug Test</title>
</head>
<body>
    <h1>Store Debug Test</h1>
    <div id="output"></div>
    
    <script>
        // This script can be used to test the store synchronization issue
        // Copy and paste into browser console during E2E test
        
        function logToPage(message) {
            const output = document.getElementById('output');
            if (output) {
                output.innerHTML += '<div>' + JSON.stringify(message) + '</div>';
            }
            console.log(message);
        }
        
        function testMoveSync() {
            logToPage('=== Testing Move Synchronization ===');
            
            // Check if we can access the store directly
            if (typeof window.__STORE__ !== 'undefined') {
                logToPage('Store available via window.__STORE__');
                
                // Subscribe to store changes
                const unsubscribe = window.__STORE__.subscribe((state) => {
                    logToPage('Store changed - moveHistory length: ' + state.training.moveHistory.length);
                });
                
                // Test making a move
                if (typeof window.e2e_makeMove === 'function') {
                    logToPage('Making test move...');
                    window.e2e_makeMove('e2-e4').then(result => {
                        logToPage('Move result: ' + JSON.stringify(result));
                        
                        // Check store state after move
                        const state = window.__STORE__.getState();
                        logToPage('Post-move store state - moveHistory length: ' + state.training.moveHistory.length);
                        
                        // Check DOM
                        const movePanel = document.querySelector('[data-testid="move-list"], [data-testid="move-panel"]');
                        if (movePanel) {
                            logToPage('Move panel data-move-count: ' + movePanel.getAttribute('data-move-count'));
                        }
                        
                        unsubscribe();
                    });
                } else {
                    logToPage('e2e_makeMove not available');
                }
            } else {
                logToPage('Store not available via window.__STORE__');
            }
        }
        
        // Auto-run when loaded into test environment
        if (typeof window !== 'undefined' && window.location.href.includes('localhost:3002')) {
            setTimeout(testMoveSync, 1000);
        }
    </script>
</body>
</html>